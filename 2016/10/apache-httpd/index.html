<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Apache httpd配置集锦 | Cylon's Collection</title>
<meta name=keywords content="httpd,apache httpd,httpd 配置"><meta name=description content="httpd下载地址：Historical releases
安装httpd bash 1 2 3 4 5 6 7 $ ls ABOUT_APACHE buildconf	emacs-style INSTALL	LICENSE	os	srclib acinclude.m4 CHANGES	httpd.dep InstallBin.dsp Makefile.in README support Apache.dsw config.layout httpd.dsp LAYOUT Makefile.win README.platforms test build configure httpd.mak libhttpd.dep modules README-win32.txt VERSIONING BuildAll.dsp configure.in httpd.spec libhttpd.dsp NOTICE ROADMAP BuildBin.dsp docs include libhttpd.mak NWGNUmakefile server httpd 编译参数 参数选项 注释说明 ./configure 配置源代码树 –prefix=/usr/local/apache2 体系无关文件的顶级安装目录PREFIX，也就Apache的安装目录。 –enable-module=so [-enable-deflate] 打开so模块，so模块是用来提DSO支持的apache核心模块 –enable-deflate=shared [-enable-expires] 支持网页压缩 –enable-expires=shared [-enable-rewrite] 支持缓存过期控制 –enable-rewrite=shared 支持URL重写 –enable-cache 支持缓存 –enable-file-cache 支持文件缓存 –enable-mem-cache 支持记忆缓存 –enable-disk-cache 支持磁盘缓存 –enable-static-support 支持静态连接(默认为动态连接) –enable-static-htpasswd 使用静态连接编译htpasswd–管理用于基本认证的用户文件 –enable-static-htdigest 使用静态连接编译htdigest–管理用于摘要认证的用户文件 –enable-static-rotatelogs 使用静态连接编译rotatelogs–滚动Apache日志的管道日志程序 –enable-static-logresolve 使用静态连接编译logresolve–解析Apache日志中的IP地址为主机名 –enable-static-htdbm 使用静态连接编译htdbm–操作DBM密码数据库 –enable-static-ab 使用静态连接编译ab–Apache服务器性能测试工具 –enable-static-checkgid 使用静态连接编译checkgid –disable-cgid 禁止用一个外部CGI守护进程执行CGI脚本 –disable-cgi 禁止编译CGI版本的PHP –disable-userdir 禁止用户从自己的主目录中提供页面 –with-mpm=worker 让apache以worker方式运行 –enable-authn-dbm=shared 对动态数据库进行操作。Rewrite时需要。 以下是分门别类的更多参数注解，与上面的会有重复 用于apr的configure脚本的选项： 可选特性 &ndash;enable-experimental-libtool 启用试验性质的自定义libtool &ndash;disable-libtool-lock 取消锁定(可能导致并行编译崩溃) &ndash;enable-debug 启用调试编译，仅供开发人员使用。 &ndash;enable-maintainer-mode 打开调试和编译时警告，仅供开发人员使用。 &ndash;enable-profile 打开编译profiling(GCC) &ndash;enable-pool-debug[=yes|no|verbose|verbose-alloc|lifetime|owner|all] 打开pools调试 &ndash;enable-malloc-debug 打开BeOS平台上的malloc_debug &ndash;disable-lfs 在32-bit平台上禁用大文件支持(large file support) &ndash;enable-nonportable-atomics 若只打算在486以上的CPU上运行Apache，那么使用该选项可以启用更加高效的基于互斥执行 的原子操作。 &ndash;enable-threads 启用线程支持在线程型的MPM上必须打开它 &ndash;disable-threads 禁用线程支持，如果不使用线程化的MPM，可以关闭它以减少系统开销。 &ndash;disable-dso 禁用DSO支持 &ndash;enable-other-child 启用可靠子进程支持 &ndash;disable-ipv6 禁用IPv6支持 **可选的额外程序包** &ndash;with-gnu-ld 指定C编译器使用GNU ld &ndash;with-pic 只使PIC/non-PIC对象[默认为两者都使用] &ndash;with-tags[=TAGS] 包含额外的配置 &ndash;with-installbuilddir=DIR 指定APR编译文件的存放位置(默认值为：’${datadir}/build’) &ndash;without-libtool 禁止使用libtool连接库文件 &ndash;with-efence[=DIR] 指定Electric Fence的安装目录 &ndash;with-sendfile 强制使用sendfile(译者注：Linux2."><meta name=author content="cylon"><link rel=canonical href=https://www.oomkill.com/2016/10/apache-httpd/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://www.oomkill.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.oomkill.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.oomkill.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.oomkill.com/favicon.ico><link rel=mask-icon href=https://www.oomkill.com/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://www.oomkill.com/2016/10/apache-httpd/><noscript><style>#theme-toggle,#top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link crossorigin=anonymous href=/assets/css/pe.min.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/pe.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/all.min.css><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/v4-shims.min.css><script defer src=https://cdn.staticfile.net/jquery/3.5.1/jquery.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/fancybox/3.5.7/jquery.fancybox.min.css><script defer src=https://cdn.staticfile.net/fancybox/3.5.7/jquery.fancybox.min.js></script><script id=MathJax-script async src=https://cdn.staticfile.net/mathjax/3.2.2/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["$$","$$"]],inlineMath:[["\\$","\\$"]]}}</script><meta property="og:title" content="Apache httpd配置集锦"><meta property="og:description" content="httpd下载地址：Historical releases
安装httpd bash 1 2 3 4 5 6 7 $ ls ABOUT_APACHE buildconf	emacs-style INSTALL	LICENSE	os	srclib acinclude.m4 CHANGES	httpd.dep InstallBin.dsp Makefile.in README support Apache.dsw config.layout httpd.dsp LAYOUT Makefile.win README.platforms test build configure httpd.mak libhttpd.dep modules README-win32.txt VERSIONING BuildAll.dsp configure.in httpd.spec libhttpd.dsp NOTICE ROADMAP BuildBin.dsp docs include libhttpd.mak NWGNUmakefile server httpd 编译参数 参数选项 注释说明 ./configure 配置源代码树 –prefix=/usr/local/apache2 体系无关文件的顶级安装目录PREFIX，也就Apache的安装目录。 –enable-module=so [-enable-deflate] 打开so模块，so模块是用来提DSO支持的apache核心模块 –enable-deflate=shared [-enable-expires] 支持网页压缩 –enable-expires=shared [-enable-rewrite] 支持缓存过期控制 –enable-rewrite=shared 支持URL重写 –enable-cache 支持缓存 –enable-file-cache 支持文件缓存 –enable-mem-cache 支持记忆缓存 –enable-disk-cache 支持磁盘缓存 –enable-static-support 支持静态连接(默认为动态连接) –enable-static-htpasswd 使用静态连接编译htpasswd–管理用于基本认证的用户文件 –enable-static-htdigest 使用静态连接编译htdigest–管理用于摘要认证的用户文件 –enable-static-rotatelogs 使用静态连接编译rotatelogs–滚动Apache日志的管道日志程序 –enable-static-logresolve 使用静态连接编译logresolve–解析Apache日志中的IP地址为主机名 –enable-static-htdbm 使用静态连接编译htdbm–操作DBM密码数据库 –enable-static-ab 使用静态连接编译ab–Apache服务器性能测试工具 –enable-static-checkgid 使用静态连接编译checkgid –disable-cgid 禁止用一个外部CGI守护进程执行CGI脚本 –disable-cgi 禁止编译CGI版本的PHP –disable-userdir 禁止用户从自己的主目录中提供页面 –with-mpm=worker 让apache以worker方式运行 –enable-authn-dbm=shared 对动态数据库进行操作。Rewrite时需要。 以下是分门别类的更多参数注解，与上面的会有重复 用于apr的configure脚本的选项： 可选特性 &ndash;enable-experimental-libtool 启用试验性质的自定义libtool &ndash;disable-libtool-lock 取消锁定(可能导致并行编译崩溃) &ndash;enable-debug 启用调试编译，仅供开发人员使用。 &ndash;enable-maintainer-mode 打开调试和编译时警告，仅供开发人员使用。 &ndash;enable-profile 打开编译profiling(GCC) &ndash;enable-pool-debug[=yes|no|verbose|verbose-alloc|lifetime|owner|all] 打开pools调试 &ndash;enable-malloc-debug 打开BeOS平台上的malloc_debug &ndash;disable-lfs 在32-bit平台上禁用大文件支持(large file support) &ndash;enable-nonportable-atomics 若只打算在486以上的CPU上运行Apache，那么使用该选项可以启用更加高效的基于互斥执行 的原子操作。 &ndash;enable-threads 启用线程支持在线程型的MPM上必须打开它 &ndash;disable-threads 禁用线程支持，如果不使用线程化的MPM，可以关闭它以减少系统开销。 &ndash;disable-dso 禁用DSO支持 &ndash;enable-other-child 启用可靠子进程支持 &ndash;disable-ipv6 禁用IPv6支持 **可选的额外程序包** &ndash;with-gnu-ld 指定C编译器使用GNU ld &ndash;with-pic 只使PIC/non-PIC对象[默认为两者都使用] &ndash;with-tags[=TAGS] 包含额外的配置 &ndash;with-installbuilddir=DIR 指定APR编译文件的存放位置(默认值为：’${datadir}/build’) &ndash;without-libtool 禁止使用libtool连接库文件 &ndash;with-efence[=DIR] 指定Electric Fence的安装目录 &ndash;with-sendfile 强制使用sendfile(译者注：Linux2."><meta property="og:type" content="article"><meta property="og:url" content="https://www.oomkill.com/2016/10/apache-httpd/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-10-16T00:00:00+00:00"><meta property="article:modified_time" content="2022-12-02T23:00:36+08:00"><meta property="og:site_name" content="Cylon's Collection"><meta name=twitter:card content="summary"><meta name=twitter:title content="Apache httpd配置集锦"><meta name=twitter:description content="httpd下载地址：Historical releases
安装httpd bash 1 2 3 4 5 6 7 $ ls ABOUT_APACHE buildconf	emacs-style INSTALL	LICENSE	os	srclib acinclude.m4 CHANGES	httpd.dep InstallBin.dsp Makefile.in README support Apache.dsw config.layout httpd.dsp LAYOUT Makefile.win README.platforms test build configure httpd.mak libhttpd.dep modules README-win32.txt VERSIONING BuildAll.dsp configure.in httpd.spec libhttpd.dsp NOTICE ROADMAP BuildBin.dsp docs include libhttpd.mak NWGNUmakefile server httpd 编译参数 参数选项 注释说明 ./configure 配置源代码树 –prefix=/usr/local/apache2 体系无关文件的顶级安装目录PREFIX，也就Apache的安装目录。 –enable-module=so [-enable-deflate] 打开so模块，so模块是用来提DSO支持的apache核心模块 –enable-deflate=shared [-enable-expires] 支持网页压缩 –enable-expires=shared [-enable-rewrite] 支持缓存过期控制 –enable-rewrite=shared 支持URL重写 –enable-cache 支持缓存 –enable-file-cache 支持文件缓存 –enable-mem-cache 支持记忆缓存 –enable-disk-cache 支持磁盘缓存 –enable-static-support 支持静态连接(默认为动态连接) –enable-static-htpasswd 使用静态连接编译htpasswd–管理用于基本认证的用户文件 –enable-static-htdigest 使用静态连接编译htdigest–管理用于摘要认证的用户文件 –enable-static-rotatelogs 使用静态连接编译rotatelogs–滚动Apache日志的管道日志程序 –enable-static-logresolve 使用静态连接编译logresolve–解析Apache日志中的IP地址为主机名 –enable-static-htdbm 使用静态连接编译htdbm–操作DBM密码数据库 –enable-static-ab 使用静态连接编译ab–Apache服务器性能测试工具 –enable-static-checkgid 使用静态连接编译checkgid –disable-cgid 禁止用一个外部CGI守护进程执行CGI脚本 –disable-cgi 禁止编译CGI版本的PHP –disable-userdir 禁止用户从自己的主目录中提供页面 –with-mpm=worker 让apache以worker方式运行 –enable-authn-dbm=shared 对动态数据库进行操作。Rewrite时需要。 以下是分门别类的更多参数注解，与上面的会有重复 用于apr的configure脚本的选项： 可选特性 &ndash;enable-experimental-libtool 启用试验性质的自定义libtool &ndash;disable-libtool-lock 取消锁定(可能导致并行编译崩溃) &ndash;enable-debug 启用调试编译，仅供开发人员使用。 &ndash;enable-maintainer-mode 打开调试和编译时警告，仅供开发人员使用。 &ndash;enable-profile 打开编译profiling(GCC) &ndash;enable-pool-debug[=yes|no|verbose|verbose-alloc|lifetime|owner|all] 打开pools调试 &ndash;enable-malloc-debug 打开BeOS平台上的malloc_debug &ndash;disable-lfs 在32-bit平台上禁用大文件支持(large file support) &ndash;enable-nonportable-atomics 若只打算在486以上的CPU上运行Apache，那么使用该选项可以启用更加高效的基于互斥执行 的原子操作。 &ndash;enable-threads 启用线程支持在线程型的MPM上必须打开它 &ndash;disable-threads 禁用线程支持，如果不使用线程化的MPM，可以关闭它以减少系统开销。 &ndash;disable-dso 禁用DSO支持 &ndash;enable-other-child 启用可靠子进程支持 &ndash;disable-ipv6 禁用IPv6支持 **可选的额外程序包** &ndash;with-gnu-ld 指定C编译器使用GNU ld &ndash;with-pic 只使PIC/non-PIC对象[默认为两者都使用] &ndash;with-tags[=TAGS] 包含额外的配置 &ndash;with-installbuilddir=DIR 指定APR编译文件的存放位置(默认值为：’${datadir}/build’) &ndash;without-libtool 禁止使用libtool连接库文件 &ndash;with-efence[=DIR] 指定Electric Fence的安装目录 &ndash;with-sendfile 强制使用sendfile(译者注：Linux2."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.oomkill.com/posts/"},{"@type":"ListItem","position":2,"name":"Apache httpd配置集锦","item":"https://www.oomkill.com/2016/10/apache-httpd/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Apache httpd配置集锦","name":"Apache httpd配置集锦","description":"httpd下载地址：Historical releases\n安装httpd bash 1 2 3 4 5 6 7 $ ls ABOUT_APACHE buildconf\temacs-style INSTALL\tLICENSE\tos\tsrclib acinclude.m4 CHANGES\thttpd.dep InstallBin.dsp Makefile.in README support Apache.dsw config.layout httpd.dsp LAYOUT Makefile.win README.platforms test build configure httpd.mak libhttpd.dep modules README-win32.txt VERSIONING BuildAll.dsp configure.in httpd.spec libhttpd.dsp NOTICE ROADMAP BuildBin.dsp docs include libhttpd.mak NWGNUmakefile server httpd 编译参数 参数选项 注释说明 ./configure 配置源代码树 –prefix=/usr/local/apache2 体系无关文件的顶级安装目录PREFIX，也就Apache的安装目录。 –enable-module=so [-enable-deflate] 打开so模块，so模块是用来提DSO支持的apache核心模块 –enable-deflate=shared [-enable-expires] 支持网页压缩 –enable-expires=shared [-enable-rewrite] 支持缓存过期控制 –enable-rewrite=shared 支持URL重写 –enable-cache 支持缓存 –enable-file-cache 支持文件缓存 –enable-mem-cache 支持记忆缓存 –enable-disk-cache 支持磁盘缓存 –enable-static-support 支持静态连接(默认为动态连接) –enable-static-htpasswd 使用静态连接编译htpasswd–管理用于基本认证的用户文件 –enable-static-htdigest 使用静态连接编译htdigest–管理用于摘要认证的用户文件 –enable-static-rotatelogs 使用静态连接编译rotatelogs–滚动Apache日志的管道日志程序 –enable-static-logresolve 使用静态连接编译logresolve–解析Apache日志中的IP地址为主机名 –enable-static-htdbm 使用静态连接编译htdbm–操作DBM密码数据库 –enable-static-ab 使用静态连接编译ab–Apache服务器性能测试工具 –enable-static-checkgid 使用静态连接编译checkgid –disable-cgid 禁止用一个外部CGI守护进程执行CGI脚本 –disable-cgi 禁止编译CGI版本的PHP –disable-userdir 禁止用户从自己的主目录中提供页面 –with-mpm=worker 让apache以worker方式运行 –enable-authn-dbm=shared 对动态数据库进行操作。Rewrite时需要。 以下是分门别类的更多参数注解，与上面的会有重复 用于apr的configure脚本的选项： 可选特性 \u0026ndash;enable-experimental-libtool 启用试验性质的自定义libtool \u0026ndash;disable-libtool-lock 取消锁定(可能导致并行编译崩溃) \u0026ndash;enable-debug 启用调试编译，仅供开发人员使用。 \u0026ndash;enable-maintainer-mode 打开调试和编译时警告，仅供开发人员使用。 \u0026ndash;enable-profile 打开编译profiling(GCC) \u0026ndash;enable-pool-debug[=yes|no|verbose|verbose-alloc|lifetime|owner|all] 打开pools调试 \u0026ndash;enable-malloc-debug 打开BeOS平台上的malloc_debug \u0026ndash;disable-lfs 在32-bit平台上禁用大文件支持(large file support) \u0026ndash;enable-nonportable-atomics 若只打算在486以上的CPU上运行Apache，那么使用该选项可以启用更加高效的基于互斥执行 的原子操作。 \u0026ndash;enable-threads 启用线程支持在线程型的MPM上必须打开它 \u0026ndash;disable-threads 禁用线程支持，如果不使用线程化的MPM，可以关闭它以减少系统开销。 \u0026ndash;disable-dso 禁用DSO支持 \u0026ndash;enable-other-child 启用可靠子进程支持 \u0026ndash;disable-ipv6 禁用IPv6支持 **可选的额外程序包** \u0026ndash;with-gnu-ld 指定C编译器使用GNU ld \u0026ndash;with-pic 只使PIC/non-PIC对象[默认为两者都使用] \u0026ndash;with-tags[=TAGS] 包含额外的配置 \u0026ndash;with-installbuilddir=DIR 指定APR编译文件的存放位置(默认值为：’${datadir}/build’) \u0026ndash;without-libtool 禁止使用libtool连接库文件 \u0026ndash;with-efence[=DIR] 指定Electric Fence的安装目录 \u0026ndash;with-sendfile 强制使用sendfile(译者注：Linux2.","keywords":["httpd","apache httpd","httpd 配置"],"articleBody":"httpd下载地址：Historical releases\n安装httpd bash 1 2 3 4 5 6 7 $ ls ABOUT_APACHE buildconf\temacs-style INSTALL\tLICENSE\tos\tsrclib acinclude.m4 CHANGES\thttpd.dep InstallBin.dsp Makefile.in README support Apache.dsw config.layout httpd.dsp LAYOUT Makefile.win README.platforms test build configure httpd.mak libhttpd.dep modules README-win32.txt VERSIONING BuildAll.dsp configure.in httpd.spec libhttpd.dsp NOTICE ROADMAP BuildBin.dsp docs include libhttpd.mak NWGNUmakefile server httpd 编译参数 参数选项 注释说明 ./configure 配置源代码树 –prefix=/usr/local/apache2 体系无关文件的顶级安装目录PREFIX，也就Apache的安装目录。 –enable-module=so [-enable-deflate] 打开so模块，so模块是用来提DSO支持的apache核心模块 –enable-deflate=shared [-enable-expires] 支持网页压缩 –enable-expires=shared [-enable-rewrite] 支持缓存过期控制 –enable-rewrite=shared 支持URL重写 –enable-cache 支持缓存 –enable-file-cache 支持文件缓存 –enable-mem-cache 支持记忆缓存 –enable-disk-cache 支持磁盘缓存 –enable-static-support 支持静态连接(默认为动态连接) –enable-static-htpasswd 使用静态连接编译htpasswd–管理用于基本认证的用户文件 –enable-static-htdigest 使用静态连接编译htdigest–管理用于摘要认证的用户文件 –enable-static-rotatelogs 使用静态连接编译rotatelogs–滚动Apache日志的管道日志程序 –enable-static-logresolve 使用静态连接编译logresolve–解析Apache日志中的IP地址为主机名 –enable-static-htdbm 使用静态连接编译htdbm–操作DBM密码数据库 –enable-static-ab 使用静态连接编译ab–Apache服务器性能测试工具 –enable-static-checkgid 使用静态连接编译checkgid –disable-cgid 禁止用一个外部CGI守护进程执行CGI脚本 –disable-cgi 禁止编译CGI版本的PHP –disable-userdir 禁止用户从自己的主目录中提供页面 –with-mpm=worker 让apache以worker方式运行 –enable-authn-dbm=shared 对动态数据库进行操作。Rewrite时需要。 以下是分门别类的更多参数注解，与上面的会有重复 用于apr的configure脚本的选项： 可选特性 –enable-experimental-libtool 启用试验性质的自定义libtool –disable-libtool-lock 取消锁定(可能导致并行编译崩溃) –enable-debug 启用调试编译，仅供开发人员使用。 –enable-maintainer-mode 打开调试和编译时警告，仅供开发人员使用。 –enable-profile 打开编译profiling(GCC) –enable-pool-debug[=yes|no|verbose|verbose-alloc|lifetime|owner|all] 打开pools调试 –enable-malloc-debug 打开BeOS平台上的malloc_debug –disable-lfs 在32-bit平台上禁用大文件支持(large file support) –enable-nonportable-atomics 若只打算在486以上的CPU上运行Apache，那么使用该选项可以启用更加高效的基于互斥执行 的原子操作。 –enable-threads 启用线程支持在线程型的MPM上必须打开它 –disable-threads 禁用线程支持，如果不使用线程化的MPM，可以关闭它以减少系统开销。 –disable-dso 禁用DSO支持 –enable-other-child 启用可靠子进程支持 –disable-ipv6 禁用IPv6支持 **可选的额外程序包** –with-gnu-ld 指定C编译器使用GNU ld –with-pic 只使PIC/non-PIC对象[默认为两者都使用] –with-tags[=TAGS] 包含额外的配置 –with-installbuilddir=DIR 指定APR编译文件的存放位置(默认值为：’${datadir}/build’) –without-libtool 禁止使用libtool连接库文件 –with-efence[=DIR] 指定Electric Fence的安装目录 –with-sendfile 强制使用sendfile(译者注：Linux2.4/2.6内核都支持) –with-egd[=DIR] 使用EDG兼容的socket –with-devrandom[=DEV] 指定随机设备[默认为：/dev/random] 用于apr-util的configure脚本的选项 ： 可选的额外程序包 –with-apr=PATH 指定APR的安装目录(–prefix选项值或apr-config的路径) –with-ldap-include=PATH ldap包含文件目录(带结尾斜线) –with-ldap-lib=PATH ldap库文件路径 –with-ldap=library 使用的ldap库 –with-dbm=DBM 选择使用的DBM类型DBM={sdbm,gdbm,ndbm,db,db1,db185,db2,db3,db4,db41,db42,db43,db44} –with-gdbm=PATH 指定GDBM的位置 –with-ndbm=PATH 指定NDBM的位置 –with-berkeley-db=PATH 指定Berkeley DB的位置 –with-pgsql=PATH 指定PostgreSQL的位置 –with-mysql=PATH 参看INSTALL.MySQL文件的内容 –with-sqlite3=PATH 指定sqlite3的位置 –with-sqlite2=PATH 指定sqlite2的位置 –with-expat=PATH 指定Expat的位置或builtin –with-iconv=PATH iconv的安装目录 关于 2.2 编译参数\nbash 1 2 3 4 5 6 7 8 9 ./configure \\ --prefix=/app/apache2.4.28 \\ --enable-deflate \\ --enable-expires \\ --enable-headers \\ --enable-modules=most \\ --enable-so \\ --with-mpm=worker \\ --enable-rewrite 关于 2.4 编译参数\nBASH 1 2 3 4 5 6 7 8 9 10 11 ./configure \\ --prefix=/app/apache-2.4.25.1 \\ --enable-so \\ --enable-deflate=shared \\ --enable-ssl=shared \\ --enable-expires=shared \\ --enable-headers=shared \\ --enable-rewrite=shared \\ --enable-static-support \\ --with-included-apr \\ --with-mpm=worker 开始安装httpd 先安装依赖包\nbash 1 2 3 4 5 6 yum -y install \\ gcc \\ gcc-c++ \\ openssl-devel \\ zlib-devel \\ pcre-devel Troubleshooting configure: error: Bundled APR requested but not found bash 1 configure: error: Bundled APR requested but not found at ./srclib/. Download and unpack the corresponding apr and apr-util packages to ./srclib/. 编译时需要下载 apr 和 apr-util 解压到 httpd/srclib/ 目录里 http://apr.apache.org/download\nerror: ‘PCRE_DUPNAMES’ undeclared (first use in this function) 网上搜了下说是yum安装的pcre的版本太老了，不支持PCRE_DUPNAMES 和 PCRE_JAVASCRIPT_COMPAT 这样的PCRE特性。好吧，我去下个最新版的pcre来编译安装。\n解决方法：编译安装pcre后，我们重新对httpd-2.4.9执行编译,这下就不会继续报错.\nbash 1 2 3 4 wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.35.tar.gz tar zxf pcre-8.35.tar.gz \u0026\u0026 cd pcre-8.35 ./configure make \u0026\u0026 make install cannot restore segment prot after reloc: Permission denied 错误如下：\nbash 1 httpd: Syntax error on line 149 of /usr/local/apache/conf/httpd.conf: Cannot load modules/libphp5.so into server: /usr/local/apache/modules/libphp5.so: cannot restore segment prot after reloc: Permission denied 解决方法：很明显的selinux的权限问题\nbash 1 2 3 chown -R apache:apache /usr/local/apache setenforce 0 chcon -c -v -R -u system_u -r object_r -t textrel_shlib_t /usr/local/apache/modules/libphp5.so configure: WARNING: OpenSSL version is too old 错误现象：CentOS 6.x\nbash 1 2 3 4 checking for OpenSSL version \u003e= 0.9.8a... FAILED configure: WARNING: OpenSSL version is too old no checking whether to enable mod_ssl... configure: error: mod_ssl has been requested but can not be built due to prerequisite failures 解决方法：\nbash 1 yum install openssl openssl-devel zlib location… not found 错误现象：\nbash 1 2 checking for zlib location... not found checking whether to enable mod_deflate... configure: error: mod_deflate has been requested but can not be built due to prerequisite failures 解决方法\nbash 1 yum install zlib zlib-devel -y no acceptable C compiler found in $PATH 错误现象：\nbash 1 configure: error: no acceptable C compiler found in $PATH 解决方法：gcc工具没安装，或开发工具包没安装 [CentOS 6.x]\nbash 1 2 yum groupinstall \"Development tools\" -y yum install gcc -y httpd: Could not reliably determine the server’s fully qualified domain name, 错误现象：\nbash 1 2 3 $ ./bin/apachectl graceful httpd: apr_sockaddr_info_get() failed for web-lamp01 httpd: Could not reliably determine the server's fully qualified domain name, using 127.0.0.1 for ServerName 错误原因：找不到完整的 fqdn www.etiantian.com 为一个完整的 fqdn 使用 127.0.0.1 替代\n解决方法：在 httpd.conf 如果没有注册的DNS域名，用IP地址替换它\n启动参数 apachectl参数\n选项参数 注释说明 configtest 检查设置文件中的语法是否正确。 fullstatus 显示服务器完整的状态信息。 graceful 重新启动Apache服务器，但不会中断原有的连接。 help 显示帮助信息。 restart 重新启动Apache服务器。 start 启动Apache服务器。 status 显示服务器摘要的状态信息。 stop 停止Apache服务器。 httpd参数\n参数选项 注释说明 -c 在读取配置文件前，先执行选项中的指令。 -C 在读取配置文件后，再执行选项中的指令。 -d \u003c服务器根目录\u003e 指定服务器的根目录。 -D \u003c设定文件参数\u003e 指定要传入配置文件的参数。 -f \u003c设定文件\u003e 指定配置文件。 -h 显示帮助。 -l 显示服务器编译时所包含的模块。 -L 显示httpd指令的说明。 -S 显示配置文件中的设定。 -t 测试配置文件的语法是否正确。 -v 显示版本信息。 -V 显示版本信息以及建立环境。 -X 以单一程序的方式来启动服务器。 bash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 $ /app/apache/bin/apachectl start $ lsof -i:80 COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME httpd 5871 root 4u IPv6 69297 0t0 TCP *:http (LISTEN) httpd 5873 daemon 4u IPv6 69297 0t0 TCP *:http (LISTEN) httpd 5874 daemon 4u IPv6 69297 0t0 TCP *:http (LISTEN) httpd 5875 daemon 4u IPv6 69297 0t0 TCP *:http (LISTEN) $ ps -ef|grep httpd root 5871 1 0 03:12 ? 00:00:00 /app/apache2.2.27/bin/httpd -k start daemon 5872 5871 0 03:12 ? 00:00:00 /app/apache2.2.27/bin/httpd -k start daemon 5873 5871 0 03:12 ? 00:00:00 /app/apache2.2.27/bin/httpd -k start daemon 5874 5871 0 03:12 ? 00:00:00 /app/apache2.2.27/bin/httpd -k start daemon 5875 5871 0 03:12 ? 00:00:00 /app/apache2.2.27/bin/httpd -k start root 5960 2056 0 03:12 pts/0 00:00:00 grep --color=auto httpd httpd目录结构 bash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 $ tree -L 1 . ├── bin #这是apache命令目录，如apache启动命令apachectl ├── ab #压力测试工具 同类软件还有jmeter loadrunner webench等 ├── apachectl #apache启动命令，需重点掌握，apachectl是一个脚本 ├── apxs # apxs是一个为Apache HTTP服务器编译和安装扩展模块的工具，在进行DOS当时编译模块时会用到 ├── htcacheclean #这是清理磁盘缓冲区的命令，需要在编译时指定相关参数才可以使用，一般很少用 ├── htpasswd # 建立和更新基本认证文件，如：配置nagios等监控服务时会用到 ├── httpd #httpd为apache的控制命令程序，apachectl执行时会调用httpd └── rotatelogs #apache自带的日志轮询命令，其他未使用过的略过未提级，以便大家学习主要的命令 ├── build ├── cgi-bin ├── conf # apache所有配置文件的目录 ├── extra # 额外的apache配置目录，这个目录里的文件我们会经常访问修改，如：httpd-vhosts.conf默认就在此目录 ├── httpd.conf #apache的主配置文件，这个文件我们会经常访问修改，其中的每一行的参数作用都应该闹明白 ├── magic ├── mime.types └── original ├── error ├── htdocs # 默认的apache的站点目录 ├── icons ├── include ├── lib ├── logs # 这个时apache的日志默认路径，包括错误日志及访问日志 ├── access_log #这是apache的默认访问日志 ├── cgisock.5871 ├── error_log # apache的错误日志 └── httpd.pid # httpd的pid文件，httpd进程启动后，会把所有的进程号ID写到此文件 ├── man ├── manual └── modules # apache模块的目录，如memcache httpd主配置文件说明 bash 1 grep -Ev \"#|^$\" httpd.conf \u003ehttpd.conf.ori bash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 # 服务的根目录 软件安装到哪 ServerRoot \"/app/apache2.2.27\" # web服务监听的端口 监听的ip默认为本机的所有ip地址 listen可以为多个，也可以指定ip # 没有listen端口是开启不了的 Listen 80 Listen 8000 Listen 192.168.59.1:90 # 如不加默认为所有 User daemon # 编译安装软件默认用户是daemon 用户 Group daemon #组 #管理员的邮箱 当前网站出问题了，会在页面显示 ServerAdmin you@example.com # 默认的站点目录 DocumentRoot \"/app/apache2.2.27/htdocs\" # 权限控制 表示根目录拒绝其他人访问 Options FollowSymLinks #带符号连接 AllowOverride None #禁止相关的功能 如.htaccess Order deny,allow #不让任何人访问这个目录 Deny from all # 如果新增加一个站点目录必须增加这6行，否则网站打不开 ","wordCount":"3233","inLanguage":"zh","datePublished":"2016-10-16T00:00:00Z","dateModified":"2022-12-02T23:00:36+08:00","author":{"@type":"Person","name":"cylon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.oomkill.com/2016/10/apache-httpd/"},"publisher":{"@type":"Organization","name":"Cylon's Collection","logo":{"@type":"ImageObject","url":"https://www.oomkill.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.oomkill.com/><img src=https://www.oomkill.com/favicon.ico alt aria-label=logo height=20>Cylon's Collection</a><div class=logo-switches><button id=theme-toggle><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.oomkill.com/archives><span>归档</span></a></li><li><a href=https://www.oomkill.com/tags><span>标签</span></a></li><li><a href=https://www.oomkill.com/search><span>搜索</span></a></li><li><a href=https://www.oomkill.com/about accesskey=/><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Apache httpd配置集锦</h1><div class=post-meta><span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2016-10-16</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg><span>3233 字</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>16 分钟</span></span>
<span class=pe-post-meta-item>&nbsp;·&nbsp;<svg t="1714036239378" fill="currentcolor" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="6659" width="256" height="256"><path d="M690 78.2c-18.6-18.8-49-19-67.8-.4s-19 49-.4 67.8l255.4 258.6c67.8 68.6 67.8 178.8.0 247.4L653.4 878.2c-18.6 18.8-18.4 49.2.4 67.8s49.2 18.4 67.8-.4l224-226.4c104.8-106 104.8-276.4.0-382.4L690 78.2zM485.4 101.4c-24-24-56.6-37.4-90.6-37.4H96C43 64 0 107 0 160v299c0 34 13.4 66.6 37.4 90.6l336 336c50 50 131 50 181 0l267-267c50-50 50-131 0-181l-336-336zM96 160h299c8.4.0 16.6 3.4 22.6 9.4l336 336c12.4 12.4 12.4 32.8.0 45.2l-267 267c-12.4 12.4-32.8 12.4-45.2.0l-336-336c-6-6-9.4-14.2-9.4-22.6V160zm192 128a64 64 0 10-128 0 64 64 0 10128 0z" p-id="6660"/></svg></span><ul class=pe-post-meta-item><a href=https://www.oomkill.com/tags/web-middleware/>#Web Middleware</a></ul></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details><summary><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e5%ae%89%e8%a3%85httpd aria-label=安装httpd>安装httpd</a><ul><li><a href=#httpd-%e7%bc%96%e8%af%91%e5%8f%82%e6%95%b0 aria-label="httpd 编译参数">httpd 编译参数</a><li><a href=#%e5%bc%80%e5%a7%8b%e5%ae%89%e8%a3%85httpd aria-label=开始安装httpd>开始安装httpd</a><li><a href=#troubleshooting aria-label=Troubleshooting>Troubleshooting</a><ul><li><a href=#configure-error-bundled-apr-requested-but-not-found aria-label="configure: error: Bundled APR requested but not found">configure: error: Bundled APR requested but not found</a><li><a href=#error-pcre_dupnames-undeclared-first-use-in-this-function aria-label="error: &amp;lsquo;PCRE_DUPNAMES&amp;rsquo; undeclared (first use in this function)">error: &lsquo;PCRE_DUPNAMES&rsquo; undeclared (first use in this function)</a><li><a href=#cannot-restore-segment-prot-after-reloc-permission-denied aria-label="cannot restore segment prot after reloc: Permission denied">cannot restore segment prot after reloc: Permission denied</a><li><a href=#configure-warning-openssl-version-is-too-old aria-label="configure: WARNING: OpenSSL version is too old">configure: WARNING: OpenSSL version is too old</a><li><a href=#zlib-location-not-found aria-label="zlib location&amp;hellip; not found">zlib location&mldr; not found</a><li><a href=#no-acceptable-c-compiler-found-in-path aria-label="no acceptable C compiler found in $PATH">no acceptable C compiler found in $PATH</a><li><a href=#httpd-could-not-reliably-determine-the-servers-fully-qualified-domain-name aria-label="httpd: Could not reliably determine the server&amp;rsquo;s fully qualified domain name,">httpd: Could not reliably determine the server&rsquo;s fully qualified domain name,</a></ul><li><a href=#%e5%90%af%e5%8a%a8%e5%8f%82%e6%95%b0 aria-label=启动参数>启动参数</a><li><a href=#httpd%e7%9b%ae%e5%bd%95%e7%bb%93%e6%9e%84 aria-label=httpd目录结构>httpd目录结构</a><li><a href=#httpd%e4%b8%bb%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e8%af%b4%e6%98%8e aria-label=httpd主配置文件说明>httpd主配置文件说明</a><li><a href=#httpd%e7%9a%84%e6%89%a9%e5%b1%95%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label=httpd的扩展配置文件>httpd的扩展配置文件</a></ul><li><a href=#%e8%99%9a%e6%8b%9f%e4%b8%bb%e6%9c%ba aria-label=虚拟主机>虚拟主机</a><ul><li><a href=#%e5%9f%ba%e4%ba%8e%e5%9f%9f%e5%90%8d%e7%9a%84%e8%99%9a%e6%8b%9f%e4%b8%bb%e6%9c%ba aria-label=基于域名的虚拟主机★★★★★>基于域名的虚拟主机★★★★★</a><li><a href=#%e5%9f%ba%e4%ba%8e%e7%ab%af%e5%8f%a3%e7%9a%84%e8%99%9a%e6%8b%9f%e4%b8%bb%e6%9c%ba aria-label=基于端口的虚拟主机>基于端口的虚拟主机</a><li><a href=#%e5%9f%ba%e4%ba%8eip%e7%9a%84%e8%99%9a%e6%8b%9f%e4%b8%bb%e6%9c%ba aria-label=基于IP的虚拟主机>基于IP的虚拟主机</a><li><a href=#%e6%b7%b7%e5%90%88%e8%99%9a%e6%8b%9f%e4%b8%bb%e6%9c%ba aria-label=混合虚拟主机>混合虚拟主机</a></ul><li><a href=#%e6%97%a5%e5%bf%97%e6%a0%bc%e5%bc%8f aria-label=日志格式>日志格式</a><ul><li><a href=#%e6%97%a5%e5%bf%97%e8%bd%ae%e8%af%a2 aria-label=日志轮询>日志轮询</a><li><a href=#%e4%b8%8d%e8%ae%b0%e5%bd%95%e6%97%a5%e5%bf%97 aria-label=不记录日志>不记录日志</a></ul><li><a href=#%e9%9a%90%e8%97%8fhttpd%e7%89%88%e6%9c%ac%e5%8f%b7 aria-label=隐藏httpd版本号>隐藏httpd版本号</a><ul><li><a href=#%e9%9a%90%e8%97%8fphp%e7%89%88%e6%9c%ac%e5%8f%b7 aria-label=隐藏php版本号>隐藏php版本号</a></ul><li><a href=#http-fastcgi%e6%a8%a1%e5%bc%8f%e5%90%af%e5%8a%a8 aria-label="HTTP fastcgi模式启动">HTTP fastcgi模式启动</a><li><a href=#httpd%e7%9a%84%e5%b7%a5%e4%bd%9c%e6%a8%a1%e5%bc%8f aria-label=httpd的工作模式>httpd的工作模式</a><ul><li><a href=#workerperfor%e6%a8%a1%e5%bc%8f aria-label=worker/perfor模式>worker/perfor模式</a><li><a href=#prefork%e6%a8%a1%e5%bc%8f aria-label=prefork模式>prefork模式</a><ul><li><a href=#%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86 aria-label=工作原理>工作原理</a><li><a href=#prefork%e9%85%8d%e7%bd%ae%e5%8f%82%e6%95%b0%e8%af%b4%e6%98%8e aria-label=prefork配置参数说明>prefork配置参数说明</a></ul><li><a href=#worker%e6%a8%a1%e5%bc%8f aria-label=worker模式>worker模式</a><li><a href=#worker-%e6%a8%a1%e5%bc%8f%e9%85%8d%e7%bd%ae%e5%8f%82%e6%95%b0%e8%af%b4%e6%98%8e aria-label="worker 模式配置参数说明">worker 模式配置参数说明</a></ul><li><a href=#%e9%85%8d%e7%bd%aehttpd%e5%af%b9%e7%ab%99%e7%82%b9%e6%96%87%e4%bb%b6%e5%8e%8b%e7%bc%a9 aria-label=配置httpd对站点文件压缩>配置httpd对站点文件压缩</a><ul><li><a href=#mod_deflate%e6%a8%a1%e5%9d%97%e4%bb%8b%e7%bb%8d aria-label=mod_deflate模块介绍>mod_deflate模块介绍</a><li><a href=#%e5%b8%b8%e8%a7%84%e6%96%b9%e6%b3%95%e5%ae%89%e8%a3%85 aria-label=常规方法安装>常规方法安装</a><li><a href=#mod_deflate-dso%e5%ae%89%e8%a3%85%e6%96%b9%e6%b3%95 aria-label="mod_deflate DSO安装方法">mod_deflate DSO安装方法</a><li><a href=#mod_deflate%e6%b5%8b%e8%af%95 aria-label=mod_deflate测试>mod_deflate测试</a></ul><li><a href=#mod_expires-%e7%bc%93%e5%ad%98%e5%8a%9f%e8%83%bd aria-label="mod_expires 缓存功能">mod_expires 缓存功能</a><ul><li><a href=#%e5%b8%b8%e8%a7%84%e6%96%b9%e6%b3%95%e5%ae%89%e8%a3%85-1 aria-label=常规方法安装>常规方法安装</a><li><a href=#mod_expires%e5%9c%a8httpd%e4%b8%ad%e5%ba%94%e7%94%a8 aria-label=mod_expires在httpd中应用>mod_expires在httpd中应用</a></ul><li><a href=#%e9%85%8d%e7%bd%aehttpd%e9%98%b2%e7%9b%97%e9%93%be%e5%8a%9f%e8%83%bd aria-label=配置httpd防盗链功能>配置httpd防盗链功能</a><ul><li><a href=#httpd-web%e6%9c%8d%e5%8a%a1%e5%ae%9e%e7%8e%b0%e9%98%b2%e7%9b%97%e9%93%be aria-label="httpd Web服务实现防盗链">httpd Web服务实现防盗链</a><li><a href=#httpd%e5%b8%b8%e7%94%a8rewrite%e6%a0%87%e5%bf%97 aria-label=httpd常用Rewrite标志>httpd常用Rewrite标志</a></ul><li><a href=#%e7%a6%81%e6%ad%a2%e8%b5%84%e6%ba%90%e7%9b%ae%e5%bd%95%e8%a7%a3%e6%9e%90php%e7%a8%8b%e5%ba%8f aria-label=禁止资源目录解析PHP程序>禁止资源目录解析PHP程序</a><li><a href=#%e7%a6%81%e6%ad%a2%e7%9b%ae%e5%bd%95%e7%b4%a2%e5%bc%95%e6%b5%8f%e8%a7%88%e5%8a%9f%e8%83%bd aria-label=禁止目录索引浏览功能>禁止目录索引浏览功能</a><li><a href=#%e5%85%b3%e9%97%ad%e6%97%a0%e7%94%a8%e7%9a%84cgi%e5%8a%9f%e8%83%bd%e9%85%8d%e7%bd%ae aria-label=关闭无用的CGI功能配置>关闭无用的CGI功能配置</a><li><a href=#%e7%a6%81%e6%ad%a2httpd%e7%94%a8%e6%88%b7%e9%87%8d%e8%bd%bd%e5%8a%9f%e8%83%bd aria-label=禁止httpd用户重载功能>禁止httpd用户重载功能</a><li><a href=#%e9%81%bf%e5%85%8d%e4%bd%bf%e7%94%a8htaccess%e6%96%87%e4%bb%b6 aria-label=避免使用.htaccess文件>避免使用.htaccess文件</a><li><a href=#%e5%a6%82%e4%bd%95%e5%af%b9httpd%e9%85%8d%e7%bd%ae%e4%bc%98%e5%8c%96 aria-label=如何对httpd配置优化？>如何对httpd配置优化？</a></li></div></details></div></aside><script src=/js/pe-toc.min.445eb1bfc5e85dd13b9519fcc2a806522e9629b6224a2974052789ba00ab78af.js integrity="sha256-RF6xv8XoXdE7lRn8wqgGUi6WKbYiSil0BSeJugCreK8="></script><div class=post-content><p>httpd下载地址：<a href=https://archive.apache.org/dist/httpd/ target=_blank rel="noopener nofollow noreferrer">Historical releases</a></p><h2 id=安装httpd>安装httpd<a hidden class=anchor aria-hidden=true href=#安装httpd>#</a></h2><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ls
</span></span><span class=line><span class=cl>ABOUT_APACHE  buildconf	emacs-style  INSTALL			LICENSE			os		srclib
</span></span><span class=line><span class=cl>acinclude.m4  CHANGES		httpd.dep    InstallBin.dsp  	Makefile.in    README 	support
</span></span><span class=line><span class=cl>Apache.dsw    config.layout  httpd.dsp LAYOUT          	Makefile.win   README.platforms <span class=nb>test</span>
</span></span><span class=line><span class=cl>build    configure  httpd.mak  libhttpd.dep  modules    README-win32.txt  VERSIONING
</span></span><span class=line><span class=cl>BuildAll.dsp  configure.in   httpd.spec   libhttpd.dsp    NOTICE   ROADMAP
</span></span><span class=line><span class=cl>BuildBin.dsp  docs            include      libhttpd.mak    NWGNUmakefile  server</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=httpd-编译参数>httpd 编译参数<a hidden class=anchor aria-hidden=true href=#httpd-编译参数>#</a></h3><table><thead><tr><th>参数选项</th><th>注释说明</th></tr></thead><tbody><tr><td>./configure</td><td>配置源代码树</td></tr><tr><td>–prefix=/usr/local/apache2</td><td>体系无关文件的顶级安装目录PREFIX，也就Apache的安装目录。</td></tr><tr><td>–enable-module=so [-enable-deflate]</td><td>打开so模块，so模块是用来提DSO支持的apache核心模块</td></tr><tr><td>–enable-deflate=shared [-enable-expires]</td><td>支持网页压缩</td></tr><tr><td>–enable-expires=shared [-enable-rewrite]</td><td>支持缓存过期控制</td></tr><tr><td>–enable-rewrite=shared</td><td>支持URL重写</td></tr><tr><td>–enable-cache</td><td>支持缓存</td></tr><tr><td>–enable-file-cache</td><td>支持文件缓存</td></tr><tr><td>–enable-mem-cache</td><td>支持记忆缓存</td></tr><tr><td>–enable-disk-cache</td><td>支持磁盘缓存</td></tr><tr><td>–enable-static-support</td><td>支持静态连接(默认为动态连接)</td></tr><tr><td>–enable-static-htpasswd</td><td>使用静态连接编译htpasswd–管理用于基本认证的用户文件</td></tr><tr><td>–enable-static-htdigest</td><td>使用静态连接编译htdigest–管理用于摘要认证的用户文件</td></tr><tr><td>–enable-static-rotatelogs</td><td>使用静态连接编译rotatelogs–滚动Apache日志的管道日志程序</td></tr><tr><td>–enable-static-logresolve</td><td>使用静态连接编译logresolve–解析Apache日志中的IP地址为主机名</td></tr><tr><td>–enable-static-htdbm</td><td>使用静态连接编译htdbm–操作DBM密码数据库</td></tr><tr><td>–enable-static-ab</td><td>使用静态连接编译ab–Apache服务器性能测试工具</td></tr><tr><td>–enable-static-checkgid</td><td>使用静态连接编译checkgid</td></tr><tr><td>–disable-cgid</td><td>禁止用一个外部CGI守护进程执行CGI脚本</td></tr><tr><td>–disable-cgi</td><td>禁止编译CGI版本的PHP</td></tr><tr><td>–disable-userdir</td><td>禁止用户从自己的主目录中提供页面</td></tr><tr><td>–with-mpm=worker</td><td>让apache以worker方式运行</td></tr><tr><td>–enable-authn-dbm=shared</td><td>对动态数据库进行操作。Rewrite时需要。</td></tr><tr><td><strong>以下是分门别类的更多参数注解，与上面的会有重复</strong></td><td></td></tr><tr><td><strong>用于apr的configure脚本的选项</strong>：</td><td></td></tr><tr><td><strong>可选特性</strong></td><td></td></tr><tr><td>&ndash;enable-experimental-libtool</td><td>启用试验性质的自定义libtool</td></tr><tr><td>&ndash;disable-libtool-lock</td><td>取消锁定(可能导致并行编译崩溃)</td></tr><tr><td>&ndash;enable-debug</td><td>启用调试编译，仅供开发人员使用。</td></tr><tr><td>&ndash;enable-maintainer-mode</td><td>打开调试和编译时警告，仅供开发人员使用。</td></tr><tr><td>&ndash;enable-profile</td><td>打开编译profiling(GCC)</td></tr><tr><td>&ndash;enable-pool-debug[=yes|no|verbose|verbose-alloc|lifetime|owner|all]</td><td>打开pools调试</td></tr><tr><td>&ndash;enable-malloc-debug</td><td>打开BeOS平台上的malloc_debug</td></tr><tr><td>&ndash;disable-lfs</td><td>在32-bit平台上禁用大文件支持(large file support)</td></tr><tr><td>&ndash;enable-nonportable-atomics</td><td>若只打算在486以上的CPU上运行Apache，那么使用该选项可以启用更加高效的基于互斥执行 的原子操作。</td></tr><tr><td>&ndash;enable-threads</td><td>启用线程支持在线程型的MPM上必须打开它</td></tr><tr><td>&ndash;disable-threads</td><td>禁用线程支持，如果不使用线程化的MPM，可以关闭它以减少系统开销。</td></tr><tr><td>&ndash;disable-dso</td><td>禁用DSO支持</td></tr><tr><td>&ndash;enable-other-child</td><td>启用可靠子进程支持</td></tr><tr><td>&ndash;disable-ipv6</td><td>禁用IPv6支持</td></tr><tr><td>*<strong>*<em>可选的额外程序包*</em>*</strong></td><td></td></tr><tr><td>&ndash;with-gnu-ld</td><td>指定C编译器使用GNU ld</td></tr><tr><td></td><td></td></tr><tr><td>&ndash;with-pic</td><td>只使PIC/non-PIC对象[默认为两者都使用]</td></tr><tr><td>&ndash;with-tags[=TAGS]</td><td>包含额外的配置</td></tr><tr><td>&ndash;with-installbuilddir=DIR</td><td>指定APR编译文件的存放位置(默认值为：’${datadir}/build’)</td></tr><tr><td>&ndash;without-libtool</td><td>禁止使用libtool连接库文件</td></tr><tr><td>&ndash;with-efence[=DIR]</td><td>指定Electric Fence的安装目录</td></tr><tr><td></td><td></td></tr><tr><td>&ndash;with-sendfile</td><td>强制使用sendfile(译者注：Linux2.4/2.6内核都支持)</td></tr><tr><td>&ndash;with-egd[=DIR]</td><td>使用EDG兼容的socket</td></tr><tr><td>&ndash;with-devrandom[=DEV]</td><td>指定随机设备[默认为：/dev/random]</td></tr><tr><td><em><strong>用于apr-util的configure脚本的选项</strong></em> ：</td><td></td></tr><tr><td><strong>可选的额外程序包</strong></td><td></td></tr><tr><td>&ndash;with-apr=PATH</td><td>指定APR的安装目录(–prefix选项值或apr-config的路径)</td></tr><tr><td>&ndash;with-ldap-include=PATH</td><td>ldap包含文件目录(带结尾斜线)</td></tr><tr><td>&ndash;with-ldap-lib=PATH</td><td>ldap库文件路径</td></tr><tr><td>&ndash;with-ldap=library</td><td>使用的ldap库</td></tr><tr><td>&ndash;with-dbm=DBM</td><td>选择使用的DBM类型DBM={sdbm,gdbm,ndbm,db,db1,db185,db2,db3,db4,db41,db42,db43,db44}</td></tr><tr><td>&ndash;with-gdbm=PATH</td><td>指定GDBM的位置</td></tr><tr><td>&ndash;with-ndbm=PATH</td><td>指定NDBM的位置</td></tr><tr><td>&ndash;with-berkeley-db=PATH</td><td>指定Berkeley DB的位置</td></tr><tr><td>&ndash;with-pgsql=PATH</td><td>指定PostgreSQL的位置</td></tr><tr><td>&ndash;with-mysql=PATH</td><td>参看INSTALL.MySQL文件的内容</td></tr><tr><td>&ndash;with-sqlite3=PATH</td><td>指定sqlite3的位置</td></tr><tr><td>&ndash;with-sqlite2=PATH</td><td>指定sqlite2的位置</td></tr><tr><td>&ndash;with-expat=PATH</td><td>指定Expat的位置或builtin</td></tr><tr><td>&ndash;with-iconv=PATH</td><td>iconv的安装目录</td></tr></tbody></table><p>关于 2.2 编译参数</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl> ./configure <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --prefix<span class=o>=</span>/app/apache2.4.28 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --enable-deflate <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --enable-expires <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --enable-headers <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --enable-modules<span class=o>=</span>most <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --enable-so <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --with-mpm<span class=o>=</span>worker <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --enable-rewrite</span></span></code></pre></td></tr></table></div></div></div></div><p>关于 2.4 编译参数</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>BASH</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-BASH data-lang=BASH><span class=line><span class=cl>./configure <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --prefix<span class=o>=</span>/app/apache-2.4.25.1 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --enable-so <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --enable-deflate<span class=o>=</span>shared <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --enable-ssl<span class=o>=</span>shared <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --enable-expires<span class=o>=</span>shared <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --enable-headers<span class=o>=</span>shared <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --enable-rewrite<span class=o>=</span>shared <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --enable-static-support <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --with-included-apr <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --with-mpm<span class=o>=</span>worker</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=开始安装httpd>开始安装httpd<a hidden class=anchor aria-hidden=true href=#开始安装httpd>#</a></h3><p>先安装依赖包</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yum -y install <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	gcc <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	gcc-c++ <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	openssl-devel <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	zlib-devel <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	pcre-devel </span></span></code></pre></td></tr></table></div></div></div></div><h3 id=troubleshooting>Troubleshooting<a hidden class=anchor aria-hidden=true href=#troubleshooting>#</a></h3><h4 id=configure-error-bundled-apr-requested-but-not-found>configure: error: Bundled APR requested but not found<a hidden class=anchor aria-hidden=true href=#configure-error-bundled-apr-requested-but-not-found>#</a></h4><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>configure: error: Bundled APR requested but not found at ./srclib/. Download and unpack the corresponding apr and apr-util packages to ./srclib/.</span></span></code></pre></td></tr></table></div></div></div></div><p>编译时需要下载 <code>apr</code> 和 <code>apr-util</code> 解压到 <code>httpd/srclib/</code> 目录里 <a href=http://apr.apache.org/download target=_blank rel="noopener nofollow noreferrer">http://apr.apache.org/download</a></p><h4 id=error-pcre_dupnames-undeclared-first-use-in-this-function>error: &lsquo;PCRE_DUPNAMES&rsquo; undeclared (first use in this function)<a hidden class=anchor aria-hidden=true href=#error-pcre_dupnames-undeclared-first-use-in-this-function>#</a></h4><p>网上搜了下说是yum安装的pcre的版本太老了，不支持PCRE_DUPNAMES 和 PCRE_JAVASCRIPT_COMPAT 这样的PCRE特性。好吧，我去下个最新版的pcre来编译安装。</p><p>解决方法：编译安装pcre后，我们重新对httpd-2.4.9执行编译,这下就不会继续报错.</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.35.tar.gz
</span></span><span class=line><span class=cl>tar zxf pcre-8.35.tar.gz <span class=o>&amp;&amp;</span> <span class=nb>cd</span> pcre-8.35
</span></span><span class=line><span class=cl>./configure
</span></span><span class=line><span class=cl>make <span class=o>&amp;&amp;</span> make install</span></span></code></pre></td></tr></table></div></div></div></div><h4 id=cannot-restore-segment-prot-after-reloc-permission-denied>cannot restore segment prot after reloc: Permission denied<a hidden class=anchor aria-hidden=true href=#cannot-restore-segment-prot-after-reloc-permission-denied>#</a></h4><p>错误如下：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>httpd: Syntax error on line <span class=m>149</span> of /usr/local/apache/conf/httpd.conf: Cannot load modules/libphp5.so into server: /usr/local/apache/modules/libphp5.so: cannot restore segment prot after reloc: Permission denied</span></span></code></pre></td></tr></table></div></div></div></div><p>解决方法：很明显的selinux的权限问题</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>chown -R apache:apache /usr/local/apache
</span></span><span class=line><span class=cl>setenforce <span class=m>0</span>
</span></span><span class=line><span class=cl>chcon -c -v -R -u system_u -r object_r -t textrel_shlib_t /usr/local/apache/modules/libphp5.so</span></span></code></pre></td></tr></table></div></div></div></div><h4 id=configure-warning-openssl-version-is-too-old>configure: WARNING: OpenSSL version is too old<a hidden class=anchor aria-hidden=true href=#configure-warning-openssl-version-is-too-old>#</a></h4><p>错误现象：CentOS 6.x</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>checking <span class=k>for</span> OpenSSL version &gt;<span class=o>=</span> 0.9.8a... FAILED
</span></span><span class=line><span class=cl>configure: WARNING: OpenSSL version is too old
</span></span><span class=line><span class=cl>no
</span></span><span class=line><span class=cl>checking whether to <span class=nb>enable</span> mod_ssl... configure: error: mod_ssl has been requested but can not be built due to prerequisite failures</span></span></code></pre></td></tr></table></div></div></div></div><p>解决方法：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yum install openssl openssl-devel</span></span></code></pre></td></tr></table></div></div></div></div><h4 id=zlib-location-not-found>zlib location&mldr; not found<a hidden class=anchor aria-hidden=true href=#zlib-location-not-found>#</a></h4><p>错误现象：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>checking <span class=k>for</span> zlib location... not found
</span></span><span class=line><span class=cl>checking whether to <span class=nb>enable</span> mod_deflate... configure: error: mod_deflate has been requested but can not be built due to prerequisite failures</span></span></code></pre></td></tr></table></div></div></div></div><p>解决方法</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yum install zlib zlib-devel -y</span></span></code></pre></td></tr></table></div></div></div></div><h4 id=no-acceptable-c-compiler-found-in-path>no acceptable C compiler found in $PATH<a hidden class=anchor aria-hidden=true href=#no-acceptable-c-compiler-found-in-path>#</a></h4><p>错误现象：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>configure: error: no acceptable C compiler found in <span class=nv>$PATH</span></span></span></code></pre></td></tr></table></div></div></div></div><p>解决方法：gcc工具没安装，或开发工具包没安装 [CentOS 6.x]</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yum groupinstall <span class=s2>&#34;Development tools&#34;</span> -y
</span></span><span class=line><span class=cl>yum install gcc -y</span></span></code></pre></td></tr></table></div></div></div></div><h4 id=httpd-could-not-reliably-determine-the-servers-fully-qualified-domain-name>httpd: Could not reliably determine the server&rsquo;s fully qualified domain name,<a hidden class=anchor aria-hidden=true href=#httpd-could-not-reliably-determine-the-servers-fully-qualified-domain-name>#</a></h4><p>错误现象：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ./bin/apachectl graceful
</span></span><span class=line><span class=cl>httpd: apr_sockaddr_info_get<span class=o>()</span> failed <span class=k>for</span> web-lamp01
</span></span><span class=line><span class=cl>httpd: Could not reliably determine the server<span class=err>&#39;</span>s fully qualified domain name, using 127.0.0.1 <span class=k>for</span> ServerName</span></span></code></pre></td></tr></table></div></div></div></div><p>错误原因：找不到完整的 <code>fqdn www.etiantian.com</code> 为一个完整的 fqdn 使用 127.0.0.1 替代</p><p>解决方法：在 <code>httpd.conf</code> 如果没有注册的DNS域名，用IP地址替换它</p><h3 id=启动参数>启动参数<a hidden class=anchor aria-hidden=true href=#启动参数>#</a></h3><p>apachectl参数</p><table><thead><tr><th>选项参数</th><th>注释说明</th></tr></thead><tbody><tr><td>configtest</td><td>检查设置文件中的语法是否正确。</td></tr><tr><td>fullstatus</td><td>显示服务器完整的状态信息。</td></tr><tr><td>graceful</td><td>重新启动Apache服务器，但不会中断原有的连接。</td></tr><tr><td>help</td><td>显示帮助信息。</td></tr><tr><td>restart</td><td>重新启动Apache服务器。</td></tr><tr><td>start</td><td>启动Apache服务器。</td></tr><tr><td>status</td><td>显示服务器摘要的状态信息。</td></tr><tr><td>stop</td><td>停止Apache服务器。</td></tr></tbody></table><p>httpd参数</p><table><thead><tr><th>参数选项</th><th>注释说明</th></tr></thead><tbody><tr><td>-c</td><td>&lt;httpd指令> 在读取配置文件前，先执行选项中的指令。</td></tr><tr><td>-C</td><td>&lt;httpd指令> 在读取配置文件后，再执行选项中的指令。</td></tr><tr><td>-d</td><td>&lt;服务器根目录> 指定服务器的根目录。</td></tr><tr><td>-D</td><td>&lt;设定文件参数> 指定要传入配置文件的参数。</td></tr><tr><td>-f</td><td>&lt;设定文件> 指定配置文件。</td></tr><tr><td>-h</td><td>显示帮助。</td></tr><tr><td>-l</td><td>显示服务器编译时所包含的模块。</td></tr><tr><td>-L</td><td>显示httpd指令的说明。</td></tr><tr><td>-S</td><td>显示配置文件中的设定。</td></tr><tr><td>-t</td><td>测试配置文件的语法是否正确。</td></tr><tr><td>-v</td><td>显示版本信息。</td></tr><tr><td>-V</td><td>显示版本信息以及建立环境。</td></tr><tr><td>-X</td><td>以单一程序的方式来启动服务器。</td></tr></tbody></table><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ /app/apache/bin/apachectl start
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ lsof -i:80
</span></span><span class=line><span class=cl>COMMAND  PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
</span></span><span class=line><span class=cl>httpd   <span class=m>5871</span>   root    4u  IPv6  <span class=m>69297</span>      0t0  TCP *:http <span class=o>(</span>LISTEN<span class=o>)</span>
</span></span><span class=line><span class=cl>httpd   <span class=m>5873</span> daemon    4u  IPv6  <span class=m>69297</span>      0t0  TCP *:http <span class=o>(</span>LISTEN<span class=o>)</span>
</span></span><span class=line><span class=cl>httpd   <span class=m>5874</span> daemon    4u  IPv6  <span class=m>69297</span>      0t0  TCP *:http <span class=o>(</span>LISTEN<span class=o>)</span>
</span></span><span class=line><span class=cl>httpd   <span class=m>5875</span> daemon    4u  IPv6  <span class=m>69297</span>      0t0  TCP *:http <span class=o>(</span>LISTEN<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ ps -ef<span class=p>|</span>grep httpd
</span></span><span class=line><span class=cl>root      <span class=m>5871</span>     <span class=m>1</span>  <span class=m>0</span> 03:12 ?        00:00:00 /app/apache2.2.27/bin/httpd -k start
</span></span><span class=line><span class=cl>daemon    <span class=m>5872</span>  <span class=m>5871</span>  <span class=m>0</span> 03:12 ?        00:00:00 /app/apache2.2.27/bin/httpd -k start
</span></span><span class=line><span class=cl>daemon    <span class=m>5873</span>  <span class=m>5871</span>  <span class=m>0</span> 03:12 ?        00:00:00 /app/apache2.2.27/bin/httpd -k start
</span></span><span class=line><span class=cl>daemon    <span class=m>5874</span>  <span class=m>5871</span>  <span class=m>0</span> 03:12 ?        00:00:00 /app/apache2.2.27/bin/httpd -k start
</span></span><span class=line><span class=cl>daemon    <span class=m>5875</span>  <span class=m>5871</span>  <span class=m>0</span> 03:12 ?        00:00:00 /app/apache2.2.27/bin/httpd -k start
</span></span><span class=line><span class=cl>root      <span class=m>5960</span>  <span class=m>2056</span>  <span class=m>0</span> 03:12 pts/0    00:00:00 grep --color<span class=o>=</span>auto httpd</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=httpd目录结构>httpd目录结构<a hidden class=anchor aria-hidden=true href=#httpd目录结构>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ tree -L <span class=m>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── bin <span class=c1>#这是apache命令目录，如apache启动命令apachectl</span>
</span></span><span class=line><span class=cl>      ├── ab <span class=c1>#压力测试工具 同类软件还有jmeter loadrunner webench等</span>
</span></span><span class=line><span class=cl>  ├── apachectl  <span class=c1>#apache启动命令，需重点掌握，apachectl是一个脚本</span>
</span></span><span class=line><span class=cl>      ├── apxs <span class=c1># apxs是一个为Apache HTTP服务器编译和安装扩展模块的工具，在进行DOS当时编译模块时会用到 </span>
</span></span><span class=line><span class=cl>      ├── htcacheclean <span class=c1>#这是清理磁盘缓冲区的命令，需要在编译时指定相关参数才可以使用，一般很少用</span>
</span></span><span class=line><span class=cl>      ├── htpasswd <span class=c1># 建立和更新基本认证文件，如：配置nagios等监控服务时会用到</span>
</span></span><span class=line><span class=cl>      ├── httpd <span class=c1>#httpd为apache的控制命令程序，apachectl执行时会调用httpd</span>
</span></span><span class=line><span class=cl>      └── rotatelogs <span class=c1>#apache自带的日志轮询命令，其他未使用过的略过未提级，以便大家学习主要的命令</span>
</span></span><span class=line><span class=cl>├── build
</span></span><span class=line><span class=cl>├── cgi-bin
</span></span><span class=line><span class=cl>├── conf <span class=c1># apache所有配置文件的目录</span>
</span></span><span class=line><span class=cl>  ├── extra <span class=c1># 额外的apache配置目录，这个目录里的文件我们会经常访问修改，如：httpd-vhosts.conf默认就在此目录</span>
</span></span><span class=line><span class=cl>  ├── httpd.conf <span class=c1>#apache的主配置文件，这个文件我们会经常访问修改，其中的每一行的参数作用都应该闹明白</span>
</span></span><span class=line><span class=cl>  ├── magic
</span></span><span class=line><span class=cl>  ├── mime.types
</span></span><span class=line><span class=cl>  └── original
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>├── error
</span></span><span class=line><span class=cl>├── htdocs <span class=c1># 默认的apache的站点目录</span>
</span></span><span class=line><span class=cl>├── icons
</span></span><span class=line><span class=cl>├── include
</span></span><span class=line><span class=cl>├── lib
</span></span><span class=line><span class=cl>├── logs <span class=c1># 这个时apache的日志默认路径，包括错误日志及访问日志</span>
</span></span><span class=line><span class=cl>  ├── access_log <span class=c1>#这是apache的默认访问日志</span>
</span></span><span class=line><span class=cl>  ├── cgisock.5871
</span></span><span class=line><span class=cl>  ├── error_log <span class=c1># apache的错误日志</span>
</span></span><span class=line><span class=cl>  └── httpd.pid <span class=c1># httpd的pid文件，httpd进程启动后，会把所有的进程号ID写到此文件</span>
</span></span><span class=line><span class=cl>├── man
</span></span><span class=line><span class=cl>├── manual
</span></span><span class=line><span class=cl>└── modules <span class=c1># apache模块的目录，如memcache</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=httpd主配置文件说明>httpd主配置文件说明<a hidden class=anchor aria-hidden=true href=#httpd主配置文件说明>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>grep -Ev <span class=s2>&#34;#|^</span>$<span class=s2>&#34;</span> httpd.conf &gt;httpd.conf.ori</span></span></code></pre></td></tr></table></div></div></div></div><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 服务的根目录 软件安装到哪</span>
</span></span><span class=line><span class=cl>ServerRoot <span class=s2>&#34;/app/apache2.2.27&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># web服务监听的端口 监听的ip默认为本机的所有ip地址 listen可以为多个，也可以指定ip</span>
</span></span><span class=line><span class=cl><span class=c1># 没有listen端口是开启不了的</span>
</span></span><span class=line><span class=cl>Listen <span class=m>80</span>
</span></span><span class=line><span class=cl>Listen <span class=m>8000</span>
</span></span><span class=line><span class=cl>Listen 192.168.59.1:90 <span class=c1># 如不加默认为所有</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;IfModule !mpm_netware_module&gt;
</span></span><span class=line><span class=cl>&lt;IfModule !mpm_winnt_module&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>User daemon <span class=c1># 编译安装软件默认用户是daemon 用户</span>
</span></span><span class=line><span class=cl>Group daemon <span class=c1>#组</span>
</span></span><span class=line><span class=cl>&lt;/IfModule&gt;
</span></span><span class=line><span class=cl>&lt;/IfModule&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#管理员的邮箱 当前网站出问题了，会在页面显示</span>
</span></span><span class=line><span class=cl>ServerAdmin you@example.com
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 默认的站点目录</span>
</span></span><span class=line><span class=cl>DocumentRoot <span class=s2>&#34;/app/apache2.2.27/htdocs&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 权限控制 表示根目录拒绝其他人访问</span>
</span></span><span class=line><span class=cl>&lt;Directory /&gt;
</span></span><span class=line><span class=cl>    Options FollowSymLinks <span class=c1>#带符号连接</span>
</span></span><span class=line><span class=cl>    AllowOverride None <span class=c1>#禁止相关的功能 如.htaccess</span>
</span></span><span class=line><span class=cl>    Order deny,allow <span class=c1>#不让任何人访问这个目录</span>
</span></span><span class=line><span class=cl>    Deny from all 
</span></span><span class=line><span class=cl>&lt;/Directory&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 如果新增加一个站点目录必须增加这6行，否则网站打不开</span>
</span></span><span class=line><span class=cl>&lt;Directory <span class=s2>&#34;/app/apache2.2.27/htdocs&#34;</span>&gt;
</span></span><span class=line><span class=cl>    Options Indexes FollowSymLinks <span class=c1>#Indexs 没有index展示所有目录</span>
</span></span><span class=line><span class=cl>    AllowOverride None
</span></span><span class=line><span class=cl>    Order allow,deny
</span></span><span class=line><span class=cl>    Allow from all
</span></span><span class=line><span class=cl>&lt;/Directory&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 指定访问的首页 如果有多个用空格分开</span>
</span></span><span class=line><span class=cl>&lt;IfModule dir_module&gt;
</span></span><span class=line><span class=cl>    DirectoryIndex index.html index.php
</span></span><span class=line><span class=cl>&lt;/IfModule&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;FilesMatch <span class=s2>&#34;^\.ht&#34;</span>&gt;
</span></span><span class=line><span class=cl>    Order allow,deny
</span></span><span class=line><span class=cl>    Deny from all
</span></span><span class=line><span class=cl>    Satisfy All
</span></span><span class=line><span class=cl>&lt;/FilesMatch&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#错误日志</span>
</span></span><span class=line><span class=cl>ErrorLog <span class=s2>&#34;logs/error_log&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#日志级别 警告</span>
</span></span><span class=line><span class=cl>LogLevel warn
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#访问日志的类型</span>
</span></span><span class=line><span class=cl>&lt;IfModule log_config_module&gt;
</span></span><span class=line><span class=cl>    LogFormat <span class=s2>&#34;%h %l %u %t \&#34;%r\&#34; %&gt;s %b \&#34;%{Referer}i\&#34; \&#34;%{User-Agent}i\&#34;&#34;</span> combined
</span></span><span class=line><span class=cl>    LogFormat <span class=s2>&#34;%h %l %u %t \&#34;%r\&#34; %&gt;s %b&#34;</span> common
</span></span><span class=line><span class=cl>    &lt;IfModule logio_module&gt;
</span></span><span class=line><span class=cl>      LogFormat <span class=s2>&#34;%h %l %u %t \&#34;%r\&#34; %&gt;s %b \&#34;%{Referer}i\&#34; \&#34;%{User-Agent}i\&#34; %I %O&#34;</span> combinedio
</span></span><span class=line><span class=cl>    &lt;/IfModule&gt;
</span></span><span class=line><span class=cl>    CustomLog <span class=s2>&#34;logs/access_log&#34;</span> common
</span></span><span class=line><span class=cl>&lt;/IfModule&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># cgi的配置 现在已经过时了，工作中应该删掉</span>
</span></span><span class=line><span class=cl>&lt;IfModule alias_module&gt;
</span></span><span class=line><span class=cl>    ScriptAlias /cgi-bin/ <span class=s2>&#34;/app/apache2.2.27/cgi-bin/&#34;</span>
</span></span><span class=line><span class=cl>&lt;/IfModule&gt;
</span></span><span class=line><span class=cl>&lt;IfModule cgid_module&gt;
</span></span><span class=line><span class=cl>&lt;/IfModule&gt;
</span></span><span class=line><span class=cl>&lt;Directory <span class=s2>&#34;/app/apache2.2.27/cgi-bin&#34;</span>&gt;
</span></span><span class=line><span class=cl>    AllowOverride None
</span></span><span class=line><span class=cl>    Options None
</span></span><span class=line><span class=cl>    Order allow,deny
</span></span><span class=line><span class=cl>    Allow from all
</span></span><span class=line><span class=cl>&lt;/Directory&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 缺省的类型</span>
</span></span><span class=line><span class=cl>DefaultType text/plain
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#添加的类型，对什么类型做什么控制</span>
</span></span><span class=line><span class=cl>&lt;IfModule mime_module&gt;
</span></span><span class=line><span class=cl>    TypesConfig conf/mime.types
</span></span><span class=line><span class=cl>     AddType application/x-compress .Z
</span></span><span class=line><span class=cl>    AddType application/x-gzip .gz .tgz
</span></span><span class=line><span class=cl>&lt;/IfModule&gt;
</span></span><span class=line><span class=cl>&lt;IfModule ssl_module&gt;
</span></span><span class=line><span class=cl>SSLRandomSeed startup <span class=nb>builtin</span>
</span></span><span class=line><span class=cl>SSLRandomSeed connect <span class=nb>builtin</span>
</span></span><span class=line><span class=cl>&lt;/IfModule&gt;</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=httpd的扩展配置文件>httpd的扩展配置文件<a hidden class=anchor aria-hidden=true href=#httpd的扩展配置文件>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ll
</span></span><span class=line><span class=cl>总用量 <span class=m>56</span>
</span></span><span class=line><span class=cl>-rw-r--r--. <span class=m>1</span> root root  <span class=m>2843</span> 4月   <span class=m>8</span> 03:03 httpd-autoindex.conf
</span></span><span class=line><span class=cl>-rw-r--r--. <span class=m>1</span> root root  <span class=m>1713</span> 4月   <span class=m>8</span> 03:03 httpd-dav.conf
</span></span><span class=line><span class=cl>-rw-r--r--. <span class=m>1</span> root root  <span class=m>2344</span> 4月   <span class=m>8</span> 03:03 httpd-default.conf
</span></span><span class=line><span class=cl>-rw-r--r--. <span class=m>1</span> root root  <span class=m>1103</span> 4月   <span class=m>8</span> 03:03 httpd-info.conf
</span></span><span class=line><span class=cl>-rw-r--r--. <span class=m>1</span> root root  <span class=m>5078</span> 4月   <span class=m>8</span> 03:03 httpd-languages.conf
</span></span><span class=line><span class=cl>-rw-r--r--. <span class=m>1</span> root root   <span class=m>933</span> 4月   <span class=m>8</span> 03:03 httpd-manual.conf
</span></span><span class=line><span class=cl>-rw-r--r--. <span class=m>1</span> root root  <span class=m>3789</span> 4月   <span class=m>8</span> 03:03 httpd-mpm.conf
</span></span><span class=line><span class=cl>-rw-r--r--. <span class=m>1</span> root root  <span class=m>2183</span> 4月   <span class=m>8</span> 03:03 httpd-multilang-errordoc.conf
</span></span><span class=line><span class=cl>-rw-r--r--. <span class=m>1</span> root root <span class=m>11378</span> 4月   <span class=m>8</span> 03:03 httpd-ssl.conf
</span></span><span class=line><span class=cl>-rw-r--r--. <span class=m>1</span> root root   <span class=m>817</span> 4月   <span class=m>8</span> 03:03 httpd-userdir.conf
</span></span><span class=line><span class=cl>-rw-r--r--. <span class=m>1</span> root root  <span class=m>1491</span> 4月   <span class=m>8</span> 03:03 httpd-vhosts.conf</span></span></code></pre></td></tr></table></div></div></div></div><p>mpm</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>--with-mpm<span class=o>=</span>worker <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>&lt;IfModule mpm_prefork_module&gt;
</span></span><span class=line><span class=cl>    StartServers          <span class=m>5</span>
</span></span><span class=line><span class=cl>    MinSpareServers       <span class=m>5</span>
</span></span><span class=line><span class=cl>    MaxSpareServers      <span class=m>10</span>
</span></span><span class=line><span class=cl>    MaxClients          <span class=m>150</span>
</span></span><span class=line><span class=cl>    MaxRequestsPerChild   <span class=m>0</span>
</span></span><span class=line><span class=cl>&lt;/IfModule&gt;
</span></span><span class=line><span class=cl><span class=c1># 如果指定了worker就是woker，否则是prefork</span>
</span></span><span class=line><span class=cl>&lt;IfModule mpm_worker_module&gt;
</span></span><span class=line><span class=cl>    StartServers          <span class=m>2</span>
</span></span><span class=line><span class=cl>    MaxClients          <span class=m>150</span>
</span></span><span class=line><span class=cl>    MinSpareThreads      <span class=m>25</span>
</span></span><span class=line><span class=cl>    MaxSpareThreads      <span class=m>75</span>
</span></span><span class=line><span class=cl>    ThreadsPerChild      <span class=m>25</span>
</span></span><span class=line><span class=cl>    MaxRequestsPerChild   <span class=m>0</span>
</span></span><span class=line><span class=cl>&lt;/IfModule&gt;</span></span></code></pre></td></tr></table></div></div></div></div><p>defalut配置文件</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ grep -Ev <span class=s2>&#34;#|^</span>$<span class=s2>&#34;</span> httpd-default.conf 
</span></span><span class=line><span class=cl><span class=c1># 连接超时</span>
</span></span><span class=line><span class=cl>Timeout <span class=m>300</span>
</span></span><span class=line><span class=cl><span class=c1>#保持连接的状态</span>
</span></span><span class=line><span class=cl>KeepAlive On
</span></span><span class=line><span class=cl><span class=c1>#最大接受多少个永久连接</span>
</span></span><span class=line><span class=cl>MaxKeepAliveRequests <span class=m>100</span>
</span></span><span class=line><span class=cl><span class=c1>#在同一个连接上，等待下一个请求的时间</span>
</span></span><span class=line><span class=cl>KeepAliveTimeout <span class=m>5</span>
</span></span><span class=line><span class=cl>UseCanonicalName Off
</span></span><span class=line><span class=cl><span class=c1>#将伪静态的语法写在这个里面</span>
</span></span><span class=line><span class=cl>AccessFileName .htaccess
</span></span><span class=line><span class=cl><span class=c1>#隐藏apache版本号，不同意被攻击</span>
</span></span><span class=line><span class=cl>ServerTokens Full
</span></span><span class=line><span class=cl>ServerSignature On
</span></span><span class=line><span class=cl>HostnameLookups Off</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=虚拟主机>虚拟主机<a hidden class=anchor aria-hidden=true href=#虚拟主机>#</a></h2><p>所谓基于 ”x“ 的虚拟主机，就是靠 ”x“ 来区分不同的站点。支持各种混合，N多个虚拟主机</p><h3 id=基于域名的虚拟主机>基于域名的虚拟主机★★★★★<a hidden class=anchor aria-hidden=true href=#基于域名的虚拟主机>#</a></h3><p>建立三个站点</p><ul><li><code>www.etiantian.com</code> &mdash;&mdash; <code>/var/html/www</code></li><li><code>blog.etiantian.com</code> &mdash;&mdash; <code>/var/html/blog</code></li><li><code>bbs.etiantian.com</code> &mdash;&mdash; <code>/var/html/bbs</code></li></ul><p>步骤1：在 <code>httpd.conf</code> 中打开 <code>Include conf/extra/httpd-vhosts.conf</code></p><p>步骤2：在 <code>extra</code> 中的 <code>vhost </code>中添加三个虚拟主机</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>&lt;VirtualHost *:80&gt;
    ServerAdmin test.com@gmail.com
    DocumentRoot &#34;/var/html/www&#34;
    ServerName www.etiantian.com
    ErrorLog &#34;logs/www_error_log&#34;
    CustomLog &#34;logs/www_access_log&#34; common
&lt;/VirtualHost&gt;

&lt;VirtualHost *:80&gt;
    ServerAdmin test.com@gmail.com
    DocumentRoot &#34;/var/html/blog&#34;
    ServerName blog.etiantian.com
    ErrorLog &#34;logs/blog_error_log&#34;
    CustomLog &#34;logs/blog_access_log&#34; common
&lt;/VirtualHost&gt;

&lt;VirtualHost *:80&gt;
    ServerAdmin test.com@gmail.com
    DocumentRoot &#34;/var/html/bbs&#34;
    ServerName bbs.etiantian.com
    ErrorLog &#34;logs/bbs_error_log&#34;
    CustomLog &#34;logs/bbs_access_log&#34; common
&lt;/VirtualHost&gt;</code></pre></div></div><p>步骤3：在主配置文件，或在 <code>&lt;VirtualHost></code> 里配置权限</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>&lt;Directory &#34;/var/html&#34;&gt;
    Options FollowSymLinks
    AllowOverride None
    Order allow,deny
    Allow from all
&lt;/Directory&gt;</code></pre></div></div><p>如果配置为 <code>Options Indexes FollowSymLinks</code> 则显示为下图所示</p><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/CylonChau/imgbed//img/image-20221202162523234.png><img src=https://cdn.jsdelivr.net/gh/CylonChau/imgbed//img/image-20221202162523234.png#center alt=image-20221202162523234 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><p>如果配置为 <code>Options -Indexes FollowSymLinks</code> 则显示为下图所示</p><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/CylonChau/imgbed//img/wps65.tmp.jpg><img src=https://cdn.jsdelivr.net/gh/CylonChau/imgbed//img/wps65.tmp.jpg#center alt=img onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><h3 id=基于端口的虚拟主机>基于端口的虚拟主机<a hidden class=anchor aria-hidden=true href=#基于端口的虚拟主机>#</a></h3><p>一般来讲是内部网站</p><ul><li>优点：安全一些，别人找不到</li></ul><p>步骤1：在 <code>httpd.conf</code> 中增加监听端口</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>Listen 80
Listen 8000
Listen 9000</code></pre></div></div><p>步骤1：在 <code>vhost</code> 文件中增加</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>NameVirtualHost *:80
NameVirtualHost *:8000

&lt;VirtualHost *:8000&gt;</code></pre></div></div><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/CylonChau/imgbed//img/image-20221202162815605.png><img src=https://cdn.jsdelivr.net/gh/CylonChau/imgbed//img/image-20221202162815605.png#center alt=image-20221202162815605 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><h3 id=基于ip的虚拟主机>基于IP的虚拟主机<a hidden class=anchor aria-hidden=true href=#基于ip的虚拟主机>#</a></h3><p>步骤1：配置别名ip</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ifconfig eth0:0 192.168.59.140/24</span></span></code></pre></td></tr></table></div></div></div></div><p>步骤2：1.修改 <code>vhost</code> 文件虚拟主机配置</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>&lt;VirtualHost 192.168.59.140:80&gt;
    ServerAdmin test.com@gmail.com
    DocumentRoot &#34;/var/html/blog&#34;
    ServerName 192.168.59.140
    ErrorLog &#34;logs/blog_error_log&#34;
    CustomLog &#34;logs/blog_access_log&#34; common
&lt;/VirtualHost&gt;</code></pre></div></div><h3 id=混合虚拟主机>混合虚拟主机<a hidden class=anchor aria-hidden=true href=#混合虚拟主机>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>&lt;VirtualHost 192.168.59.140:900&gt;
    ServerAdmin test.com@gmail.com
    DocumentRoot &#34;/var/html/blog&#34;
    ServerName 192.168.59.140
    ErrorLog &#34;logs/blog_error_log&#34;
    CustomLog &#34;logs/blog_access_log&#34; common
&lt;/VirtualHost&gt;</code></pre></div></div><h2 id=日志格式>日志格式<a hidden class=anchor aria-hidden=true href=#日志格式>#</a></h2><ul><li>通用日志格式Common Log Format</li><li>组合日志格式Combinded Log Format</li></ul><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>LogFormat &#34;%h %l %u %t \&#34;%r\&#34; %&gt;s %b \&#34;%{Referer}i\&#34; \&#34;%{User-Agent}i\&#34;&#34; combined
LogFormat &#34;%h %l %u %t \&#34;%r\&#34; %&gt;s %b&#34; common</code></pre></div></div><p>如何使用combined或common呢？</p><p>答：在虚拟主机配置中更改格式</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>&lt;VirtualHost *:80&gt;
    ServerAdmin test.com@gmail.com
    DocumentRoot &#34;/var/html/www&#34;
    ServerName www.etiantian.com
    ErrorLog &#34;logs/www_error_log&#34;
    CustomLog &#34;logs/www_access_log&#34; common/combind
&lt;/VirtualHost&gt;</code></pre></div></div><h3 id=日志轮询>日志轮询<a hidden class=anchor aria-hidden=true href=#日志轮询>#</a></h3><ul><li>rotatelog</li><li>cronolog ☆☆☆</li></ul><p>安装 cronolog</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./configure
</span></span><span class=line><span class=cl>make  
</span></span><span class=line><span class=cl>make install
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ which cronolog
</span></span><span class=line><span class=cl>/usr/local/sbin/cronolog</span></span></code></pre></td></tr></table></div></div></div></div><p><strong>如果用cronolog轮询的的话最好用全路径</strong></p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>CustomLog <span class=s2>&#34;|/usr/local/sbin/cronolog  /app/logs/access_bbs_%Y%m%d.log&#34;</span> combined
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ mkdir /app/logs -p
</span></span><span class=line><span class=cl>$ ../bin/apachectl graceful</span></span></code></pre></td></tr></table></div></div></div></div><p>日志轮询除了可以使用年月日还可以使用周</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>CustomLog <span class=s2>&#34;|/usr/local/sbin/cronolog  /app/logs/access_bbs_%w.log&#34;</span> combined</span></span></code></pre></td></tr></table></div></div></div></div><p><strong>时间格式串</strong>：</p><table><thead><tr><th>时间格式串</th><th></th></tr></thead><tbody><tr><td>%H</td><td>24小时制小时(00..23)</td></tr><tr><td>%I</td><td>12小时制小时(01..12)</td></tr><tr><td>%p</td><td>本地AM/PM指示符</td></tr><tr><td>%M</td><td>分钟(00..59)</td></tr><tr><td>%S</td><td>秒(00..61)</td></tr><tr><td>%X</td><td>本地时间(e.g.:“15:12:47″)</td></tr><tr><td>%Z</td><td>时区(e.g.GMT)，如果不能检测出时区，值为空</td></tr><tr><td></td><td><strong>日期格式串</strong></td></tr><tr><td>%a</td><td>本地简短星期名(e.g.: Sun..Sat)</td></tr><tr><td>%A</td><td>本地完整星期名(e.g.: Sunday .. Saturday)</td></tr><tr><td>%b</td><td>本地简短月名(e.g.: Jan .. Dec)</td></tr><tr><td>%B</td><td>本地完整月名(e.g.: January .. December)</td></tr><tr><td>%c</td><td>本地日期与时间(e.g.: “Sun Dec 15 14:12:47 GMT 1996″)</td></tr><tr><td>%d</td><td>一月中的第几日(01 .. 31)</td></tr><tr><td>%j</td><td>一年中的第几天 (001 .. 366)</td></tr><tr><td>%m</td><td>月名的数字表示 (01 .. 12)</td></tr><tr><td>%U</td><td>一年中以星期日为每周第一天计算的星期数(00..53, 第一周包括新年的第一个星期日)</td></tr><tr><td>%W</td><td>一年中以星期一为每周第一天计算的星期数(00..53, 第一周包括新年的第一个星期一)</td></tr><tr><td>%w</td><td>星期名的数字表示 (0 .. 6, 0为星期日)</td></tr><tr><td>%x</td><td>本地日期 (e.g. 今天在北京是: “15/12/96″)</td></tr><tr><td>%y</td><td>不带世纪的年(00 .. 99)</td></tr><tr><td>%Y</td><td>带世纪的年(1970 .. 2038)</td></tr></tbody></table><p><strong>错误写法</strong>：</p><p><strong>提示：cronolog轮询日志的正确写法，被轮询的日志路径要写全路径</strong></p><p><strong>按天轮询（生产环境常见用法，推荐使用）</strong></p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 错误写法</span>
</span></span><span class=line><span class=cl>CustomLog <span class=s2>&#34;|usr/local/sbin/cronolog logs/access_www_%w.log&#34;</span> combined
</span></span><span class=line><span class=cl><span class=c1># 正确写法</span>
</span></span><span class=line><span class=cl>CustomLog <span class=s2>&#34;|usr/local/sbin/cronolog /app/logs/access_www_%Y%m%d.log&#34;</span> combined</span></span></code></pre></td></tr></table></div></div></div></div><p><strong>提示：这是大多数网站的常规配置方法（按天记录日志，日志不会自动覆盖）</strong></p><p><strong>按小时轮询（生产环境较常见用法）</strong>：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 按小时轮询（生产环境较常见用法）</span>
</span></span><span class=line><span class=cl>CustomLog <span class=s2>&#34;|usr/local/sbin/cronolog /app/logs/access_www_%Y%m%d%H.log&#34;</span> combined
</span></span><span class=line><span class=cl><span class=c1># 按天轮询（生产环境较常见用法）</span>
</span></span><span class=line><span class=cl>CustomLog <span class=s2>&#34;|usr/local/sbin/cronolog /app/logs/access_www_%Y%m%d.log&#34;</span> combined</span></span></code></pre></td></tr></table></div></div></div></div><p>完整配置如下</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&lt;VirtualHost *:80&gt;
</span></span><span class=line><span class=cl>    ServerAdmin test.com@gmail.com
</span></span><span class=line><span class=cl>    DocumentRoot <span class=s2>&#34;/var/html/blog&#34;</span>
</span></span><span class=line><span class=cl>    ServerName blog.etiantian.com
</span></span><span class=line><span class=cl>    ErrorLog <span class=s2>&#34;logs/blog_error_log&#34;</span>
</span></span><span class=line><span class=cl>    CustomLog <span class=s2>&#34;|/usr/local/sbin/cronolog  /app/logs/access_blog_%w.log&#34;</span> combined
</span></span><span class=line><span class=cl>&lt;/VirtualHost&gt;</span></span></code></pre></td></tr></table></div></div></div></div><p><strong>配置定时任务</strong></p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 创建脚本目录</span>
</span></span><span class=line><span class=cl>mkdir /server/script/web/ -p
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建脚本文件</span>
</span></span><span class=line><span class=cl>touch /server/script/web/apache_log.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 编辑脚本内容</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> /app/apache/logs
</span></span><span class=line><span class=cl>mv www_access_log /app/logs/www_access_<span class=k>$(</span>date +%F -d <span class=s1>&#39;-1day&#39;</span><span class=k>)</span>.log
</span></span><span class=line><span class=cl>www_access_log
</span></span><span class=line><span class=cl>&gt;www_access_log
</span></span><span class=line><span class=cl>/app/apache/bin/apachectl graceful
</span></span><span class=line><span class=cl><span class=c1># 添加定时任务</span>
</span></span><span class=line><span class=cl><span class=m>00</span> <span class=m>00</span> * * * /bin/sh /server/script/web/apache_log.sh &gt;/dev/null 2&gt;<span class=p>&amp;</span><span class=m>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 测试脚本是否可执行成功</span>
</span></span><span class=line><span class=cl><span class=c1># 如果脚本没有执行权限</span>
</span></span><span class=line><span class=cl>$ /server/script/web/apache_log.sh         
</span></span><span class=line><span class=cl>-bash: /server/script/web/apache_log.sh: 权限不够
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ /bin/sh /server/script/web/apache_log.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看执行结果</span>
</span></span><span class=line><span class=cl>$ ll
</span></span><span class=line><span class=cl>总用量 <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=c1># 将时间设置为0时</span>
</span></span><span class=line><span class=cl>$ date -s <span class=s1>&#39;2017-04-20 23:59:00&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 这时候时23:59查看当天日志是有内容的，并且/app/logs/下面没有文件</span>
</span></span><span class=line><span class=cl>$ cat /app/apache/logs/www_access_log 
</span></span><span class=line><span class=cl>192.168.59.1 - - <span class=o>[</span>20/Apr/2017:23:59:19 +0800<span class=o>]</span> <span class=s2>&#34;GET / HTTP/1.1&#34;</span> <span class=m>304</span> - <span class=s2>&#34;-&#34;</span> <span class=s2>&#34;Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:45.0) Gecko/20100101 Firefox/45.0&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 0时这个时候发现目录生成新日志文件了</span>
</span></span><span class=line><span class=cl>$ ll
</span></span><span class=line><span class=cl>总用量 <span class=m>4</span>
</span></span><span class=line><span class=cl>-rw-r--r--. <span class=m>1</span> root root <span class=m>153</span> 4月  <span class=m>20</span> 23:59 www_access_2017-04-21.log</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=不记录日志>不记录日志<a hidden class=anchor aria-hidden=true href=#不记录日志>#</a></h3><p>正如下列配置所示</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>&lt;FilesMatch &#39;\. (css|js|gif|jpg|ico|swf|png)&#39;&gt;
 	SetEnv IMAG 1
&lt;/FilesMatch&gt;</code></pre></div></div><p>实际日志配置</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>CustomLog &#34;|/usr/local/sbin/cronolog  /app/logs/access_bbs_%w.log&#34; combined evn=!IMAG</code></pre></div></div><p>查询日志</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>awk &#39;{print $1}&#39; www-access_2014-09-18log |sort|uniq -c|sort -rn -k1|head -10</code></pre></div></div><h2 id=隐藏httpd版本号>隐藏httpd版本号<a hidden class=anchor aria-hidden=true href=#隐藏httpd版本号>#</a></h2><p>步骤1：编译前隐藏版本信息</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /home/tools/httpd-2.2.27/include/ap_release.h </span></span></code></pre></td></tr></table></div></div></div></div><p>找到 <code>#define AP_SERVER_BASEPRODUCT "Apache"</code></p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>#define AP_SERVER_BASEPRODUCT &#34;Apache&#34;
# 修改为
#define AP_SERVER_BASEPRODUCT &#34;Microsoft-IIS/5.0&#34;

#define AP_SERVER_BASEVENDOR &#34;Apache Software Foundation&#34;
#define AP_SERVER_BASEPROJECT &#34;Apache HTTP Server&#34;
#define AP_SERVER_BASEPRODUCT &#34;Apache&#34;

#define AP_SERVER_MAJORVERSION_NUMBER 2
#define AP_SERVER_MINORVERSION_NUMBER 2
#define AP_SERVER_PATCHLEVEL_NUMBER   27
#define AP_SERVER_DEVBUILD_BOOLEAN    0</code></pre></div></div><p>找到 <code>cat /home/tools/httpd-2.2.27/os/unix/os.h</code>，修改 <code>#define PLATFORM "Unix" 修改为 #define PLATFORM "Win32"</code></p><p>**步骤3：最后修改 /etc/httpd/conf/httpd.conf **</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>ServerTokens Prod        # Prod 同 ProductOnly
ServerSignature Off</code></pre></div></div><p>配置前的响应头</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ curl 127.0.0.1 -I
</span></span><span class=line><span class=cl>HTTP/1.1 <span class=m>200</span> OK
</span></span><span class=line><span class=cl>Date: Thu, <span class=m>20</span> Apr <span class=m>2017</span> 16:18:24 GMT
</span></span><span class=line><span class=cl>Server: Apache/2.2.27 <span class=o>(</span>Unix<span class=o>)</span> DAV/2</span></span></code></pre></td></tr></table></div></div></div></div><p>配置如下参数</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi /app/apache/conf/extra/httpd-default.conf
</span></span><span class=line><span class=cl>ServerTokens Prod
</span></span><span class=line><span class=cl>ServerSignature Off</span></span></code></pre></td></tr></table></div></div></div></div><p>配置后的响应头</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ curl 127.0.0.1 -I                            
</span></span><span class=line><span class=cl>HTTP/1.1 <span class=m>200</span> OK
</span></span><span class=line><span class=cl>Date: Thu, <span class=m>20</span> Apr <span class=m>2017</span> 16:22:19 GMT
</span></span><span class=line><span class=cl>Server: Apache</span></span></code></pre></td></tr></table></div></div></div></div><p>附：</p><ul><li><em><strong>ServerSignature</strong></em> 三个选项，分别是 On | Off | EMail</li><li><em><strong>ServerTokens</strong></em> 的取值如下，其分别隐藏信息依次增加，推荐： ServerTokens ProductOnly</li></ul><p>未经修改的请求头如下</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ curl –head 127.0.0.1
</span></span><span class=line><span class=cl>HTTP/1.1 <span class=m>200</span> OK
</span></span><span class=line><span class=cl>Date: Thu, <span class=m>22</span> Jan <span class=m>2015</span> 15:39:00 GMT
</span></span><span class=line><span class=cl>Server: Apache/2.2.26 <span class=o>(</span>CentOS<span class=o>)</span>
</span></span><span class=line><span class=cl>X-Powered-By: PHP/5.5.9
</span></span><span class=line><span class=cl>Vary: Cookie,Accept-Encoding,User-Agent
</span></span><span class=line><span class=cl>X-Pingback: http://blog.mimvp.com/xmlrpc.php
</span></span><span class=line><span class=cl>Cache-Control: max-age<span class=o>=</span><span class=m>600</span>
</span></span><span class=line><span class=cl>Expires: Thu, <span class=m>22</span> Jan <span class=m>2015</span> 15:49:00 GMT
</span></span><span class=line><span class=cl>Content-Type: text/html<span class=p>;</span> <span class=nv>charset</span><span class=o>=</span>UTF-8</span></span></code></pre></td></tr></table></div></div></div></div><p>上面头信息中，会显示服务器类型和版本(Apache/2.2.26)，以及操作系统(CentOS)</p><p>修改 ServerTokens</p><p>修改 ServerTokens OS 为 ServerTokens productonly</p><p>再次返回头信息如下：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ curl –head 127.0.0.1
</span></span><span class=line><span class=cl>HTTP/1.1 <span class=m>200</span> OK
</span></span><span class=line><span class=cl>Date: Thu, <span class=m>22</span> Jan <span class=m>2015</span> 15:40:53 GMT
</span></span><span class=line><span class=cl>Server: Apache
</span></span><span class=line><span class=cl>X-Powered-By: PHP/5.5.9
</span></span><span class=line><span class=cl>Vary: Cookie,Accept-Encoding,User-Agent
</span></span><span class=line><span class=cl>X-Pingback: http://blog.mimvp.com/xmlrpc.php
</span></span><span class=line><span class=cl>Cache-Control: max-age<span class=o>=</span><span class=m>600</span>
</span></span><span class=line><span class=cl>Expires: Thu, <span class=m>22</span> Jan <span class=m>2015</span> 15:50:53 GMT
</span></span><span class=line><span class=cl>Content-Type: text/html<span class=p>;</span> <span class=nv>charset</span><span class=o>=</span>UTF-8</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=隐藏php版本号>隐藏php版本号<a hidden class=anchor aria-hidden=true href=#隐藏php版本号>#</a></h3><p>php.ini</p><p>expose_php On 改成 expose_php Off</p><h2 id=http-fastcgi模式启动>HTTP fastcgi模式启动<a hidden class=anchor aria-hidden=true href=#http-fastcgi模式启动>#</a></h2><p>编译PHP时候不要使用aspx</p><p>注释掉以下，fpm安装方式。不用管，例如下面配置</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>LoadModule php5_module modules/libphp5.so
&lt;FilesMatch \.php$&gt;
    SetHandler application/x-httpd-php
&lt;/FilesMatch&gt;</code></pre></div></div><p>然后去掉 <code>mod_proxy.so</code> 和 <code>mod_proxy_fcgi.so</code> 之前的注解，确保他们被apache加载。</p><p>如果php-fpm使用的是TCP socket，那么在httpd.conf末尾加上：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>&lt;FilesMatch \.php$&gt;   正则匹配文件，如果文件名为.php结尾
         SetHandler &#34;proxy:fcgi://127.0.0.1:9000&#34;
&lt;/FilesMatch&gt;</code></pre></div></div><h2 id=httpd的工作模式>httpd的工作模式<a hidden class=anchor aria-hidden=true href=#httpd的工作模式>#</a></h2><h3 id=workerperfor模式>worker/perfor模式<a hidden class=anchor aria-hidden=true href=#workerperfor模式>#</a></h3><p>在linux中，我们可以使用 <code>http-l</code> 查看安装的模块是 prefork 模式还是 worker 模式</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ /app/apache/bin/apachectl -l<span class=p>|</span>sed -n <span class=s1>&#39;/worker\|prefork/p&#39;</span>
</span></span><span class=line><span class=cl>  prefork.c		<span class=c1>#&lt;== 默认为prefork（预派生）模式5个进程</span>
</span></span><span class=line><span class=cl><span class=m>482</span> Include conf/extra/httpd-mpm.conf  	<span class=c1>#&lt;==在httpd.conf中打开mpm配置文件.</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=prefork模式>prefork模式<a hidden class=anchor aria-hidden=true href=#prefork模式>#</a></h3><p>prefork使用的是多个子进程，而每个子进程只有一个线程，每个进程在某个确定的时间只能维持一个连接.</p><h4 id=工作原理>工作原理<a hidden class=anchor aria-hidden=true href=#工作原理>#</a></h4><p>控制进程最初简历若干个子进程，为了不在请求到来时再生成子进程，所以要根据需求不断的创建新的子进程，最大可以达到每秒32个知道满足需求为止.</p><p>安装方法：在编译的过程中，加入参数 <code>--with-mpm=prefork</code> 如果不加也可以，因为默认的话，会采用 prefork模式。</p><ul><li>优点：效率高，稳定，安全。对于线程调试困难的平台来说，调试更加容易些.</li><li>缺点：和work模式比消耗资源多.</li></ul><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/CylonChau/imgbed//img/image-20221202173701200.png><img src=https://cdn.jsdelivr.net/gh/CylonChau/imgbed//img/image-20221202173701200.png#center alt=image-20221202173701200 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><h4 id=prefork配置参数说明>prefork配置参数说明<a hidden class=anchor aria-hidden=true href=#prefork配置参数说明>#</a></h4><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf># prefork MPM
# StartServers: number of server processes to start
# MinSpareServers: minimum number of server processes which are kept spare
# MaxSpareServers: maximum number of server processes which are kept spare
# MaxRequestWorkers: maximum number of server processes allowed to start
# MaxConnectionsPerChild: maximum number of connections a server process serves
#                         before terminating
&lt;IfModule mpm_prefork_module&gt;
    StartServers           	1 	#&lt;==最初建立的子进程
    MinSpareServers          	1	#&lt;==最小空闲进程数，如果空闲进程小于设定值，apache会自动建立进程，如果服务器并发及负载大的话，可以考虑加大。
    MaxSpareServers          	2	#&lt;==最大空闲进程，如果空闲的进程大于设定值，apache会自动kill掉多余的进程，如果服务器负载大的话，可以考虑加大
    MaxRequestWorkers        	20	#&lt;==设定apache可以同时处理的请求，是对apache性能影响最大的参数，就是apache可以同时处理的请求数，就是说，如果有150个用户在访问，那么第151个用户就要等之前的访问结束后才能访问
    MaxConnectionsPerChild   	0	#&lt;==每个子进程可处理的请求数。每个子进程在处理了[max requests perchild] 个请求后将自动销毁。0意味着无限，即子进程永不销毁，虽然缺省值为0,可以使每个子进程处理更多的请求，但如果设成非0值也有两点重要好处1.可防止意外的内存泄露2.在服务器负载下降的时候会自动减少子进程数
&lt;/IfModule&gt;</code></pre></div></div><h3 id=worker模式>worker模式<a hidden class=anchor aria-hidden=true href=#worker模式>#</a></h3><p>worker模式是 Apache2.X 新引进来的模式，是线程与进程的结合，在worker模式下会有多个子进程，每个进程又会有多个线程。每个线程在某个确定的时间只能维持一个连接。</p><p>工作原理</p><p>由主控制进程生成若干个子进程，而每个子进程中又包含固定的线程数，各个线程独立处理请求，同样为了不在请求到来时再生成线程，再配置文件中设置了最小和最大的空闲线程数及所有子进程中的线程总数，如果现有子进程中的线程总数不能满足并发及负载，控制进程将派生新的子进程。</p><p>在配置编译的过程中，加入参数 <code>--with-mpm-worker</code>，如果不加的话系统会采用默认prefork模式。</p><ul><li>优点：内存占用比prefork模式低，适合高并发高流量HTTP服务。</li><li>缺点：假如一个线程崩溃，整个进程就会连同其任何线程一起 “死掉”。由于线程贡献内存空间，所以一个程序在运行时必须被系统识别为“每个线程都是安全的”服务稳定性不如prefork模式。</li></ul><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/CylonChau/imgbed//img/image-20221202174118478.png><img src=https://cdn.jsdelivr.net/gh/CylonChau/imgbed//img/image-20221202174118478.png#center alt=image-20221202174118478 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><h3 id=worker-模式配置参数说明>worker 模式配置参数说明<a hidden class=anchor aria-hidden=true href=#worker-模式配置参数说明>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf># worker MPM
# StartServers: initial number of server processes to start
# MinSpareThreads: minimum number of worker threads which are kept spare
# MaxSpareThreads: maximum number of worker threads which are kept spare
# ThreadsPerChild: constant number of worker threads in each server process
# MaxRequestWorkers: maximum number of worker threads
# MaxConnectionsPerChild: maximum number of connections a server process serves
#                         before terminating
&lt;IfModule mpm_worker_module&gt;
    StartServers             	3	#&lt;==最初建立的子进程
MinSpareThreads         	75	#&lt;==最小空闲线程数，如果空闲的线程小于设定值，apache会自动建立线程，如果服务器负载大的话，可以考虑加大此参数值。
MaxClients #&lt;==所有子进程中的线程总数。如果现有子进程中的线程总数不能满足负载，控制进程将派生新的子进程。
MaxSpareThreads        	250  #&lt;==最大空闲线程数，如果空闲的线程大于设定值，apache会自动kill掉多余的线程，如果服务器负载过大的话，可以考虑加大此参数值。   
ThreadsPerChild         	25	#&lt;==每个进程包含固定的线程数，此参数再worker模式中，是影响最大的参数
MaxRequestWorkers      	400	    
MaxConnectionsPerChild   	0Threads
&lt;/IfModule&gt;</code></pre></div></div><p>worker模式下所能同时处理的请求总数是由子进程总数乘Threadsperchild值决定的，应该大于等于maxcliens。如果负载很大，现有的子进程数不能满足时，控制进程会派生新的子进程。</p><p>默认最大的子进程总数是16，如需加大时，也需要显式声明serverlimit的值（最大值是20000）</p><blockquote><p>特别说明</p><p>如果显式生命了serverLimit，那么它乘 ThreadPreChild 的值必须大于等于MaxClients,而且MaxClients必须是ThreadPerChild的整数倍，否则Apache将会自动调节Apache将会自动调节到一个相应的值（可能是个非常期望值）</p><p>通过数学表达</p><p>MaxClient &lt;= 总的进程（ServerLimit）* 线程数（ThreadsPerChild）、</p><p>MaxClient % ThreadsPerChild = 0</p></blockquote><p>注意：worker MPM也有不完善的地方，如果一个线程崩溃，整个进程就会连同其所有线程一起 “死掉”</p><h2 id=配置httpd对站点文件压缩>配置httpd对站点文件压缩<a hidden class=anchor aria-hidden=true href=#配置httpd对站点文件压缩>#</a></h2><h3 id=mod_deflate模块介绍>mod_deflate模块介绍<a hidden class=anchor aria-hidden=true href=#mod_deflate模块介绍>#</a></h3><p>Apache的 <code>mod_deflate</code> 模块提供了 <code>Deflate</code> 输出过滤器，允许httpd服务器将输出内容在发送到客户端之前根据具体的策略进行压缩，以节约网络带宽，同时提升用户访问体验。</p><p><code>mod_deflate</code> 模块安装方法</p><p>检查是否安装了模块 <code>mod_deflate</code></p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ /app/apache/bin/apachectl -l
</span></span><span class=line><span class=cl>Compiled in modules:
</span></span><span class=line><span class=cl>  core.c
</span></span><span class=line><span class=cl>  mod_so.c
</span></span><span class=line><span class=cl>  http_core.c
</span></span><span class=line><span class=cl>  prefork.c</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=常规方法安装>常规方法安装<a hidden class=anchor aria-hidden=true href=#常规方法安装>#</a></h3><p><code>--enable-deflate</code> 提供对内容的亚索传输编码支持，一般html js css等内容站点，使用此参数功能会大大提高传输速度，提升访问者访问体验。在生产环境中，这是 httpd 调优的一个重要选项之一。</p><h3 id=mod_deflate-dso安装方法>mod_deflate DSO安装方法<a hidden class=anchor aria-hidden=true href=#mod_deflate-dso安装方法>#</a></h3><p>以DSO动态模块加载mod_deflate配置的全部命令为</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /root/tools/httpd-2.4.18/modules/filters	<span class=c1>#&lt;==切换到apache软件目录mod_deflate程序下</span>
</span></span><span class=line><span class=cl>/app/apache/bin/apxs  -c -i -a mod_deflate.c <span class=c1>#&lt;==以dso的方式编译入到apache中</span></span></span></code></pre></td></tr></table></div></div></div></div><p>出现如下错误</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>httpd: Syntax error on line <span class=m>103</span> of /app/apache2.4/conf/httpd.conf: Cannot load modules/mod_deflate.so into server: /app/apache2.4/modules/mod_deflate.so: undefined symbol: inflateEnd</span></span></code></pre></td></tr></table></div></div></div></div><p>解决方法：</p><p>出现这个错误其实时因为 <code>mod_deflate</code> 模块没有找到 <code>zlib</code> 库。解决办法就是找到 <code>apr-config</code> 文件中的<code>LDFLAGS=""</code>，把他改成 <code>LDFLAGS="-lz"</code> ，然后在运行 <code>/usr/local/apache2/bin/apxs -i -c -a mod_deflate.c</code> 一般就可以了。</p><p>方法1：在apr的主配置文件 <code>apr-1-config</code>（老版本可能是apr-conf）里面将 <code>LDFLAGS=""</code> 修改为 <code>LDFLAGS="-lz"</code>，然后用 apxs 从新编译 <code>mod_deflate.c</code> 后，httpd 服务就正常了，并且也可以正常压缩文件了。</p><p>方法2：需要在 <code>LoadModule deflate_module modules/mod_deflate.so</code> 的前面加载 <code>zlib.so64</code> 操作系统就在 <code>LoadModule deflate_module modules/mod_deflate.so</code> 这行的上一行添加 <code>LoadFile /usr/lib64/libz.so</code>即可。</p><p>上述参数选项说明</p><table><thead><tr><th>参数 </th><th>说明</th></tr></thead><tbody><tr><td>-c             </td><td>需要执行编译操作。他首先会编译C源码程序(.c)files为对应的目标代码文件(.o)，然后连接这些目标代码和files中其余的目标代码文件(.o和.a)，以生成动态共享对象dsofile。如果没有指定-o选项，则此输出文件名由files中的第一个文件名推测得到，也就是默认为mod_name.so</td></tr><tr><td>-i                                          </td><td>需要执行安装操作，以安装一个或多个共享对象到服务器的modules目录中。</td></tr><tr><td>-a</td><td>增加一个LoadMoudule行到httpd.conf文件中，以激活此模块</td></tr></tbody></table><h3 id=mod_deflate测试>mod_deflate测试<a hidden class=anchor aria-hidden=true href=#mod_deflate测试>#</a></h3><p>mod_deflate模块可以在主配置文件中配置，也可以在虚拟主机中配置</p><p>在主http.conf配置中配置如下：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>&lt;ifmodule mod_deflate.c&gt; # &lt;==开始标签标记 判断模块是否开启
    DeflateCompressionLevel 6 # &lt;==压缩级别 1-9
    SetOutputFilter DEFLATE	# &lt;==启用deflate模块对本站点的所有输出进行GZIP压缩
    AddOutputFilterByType Deflate text/html test/pain text/xml text/css 	
    AddOutputFilterByType Deflate application/javascript
&lt;/ifmodule&gt; # &lt;==判断结束标记</code></pre></div></div><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/CylonChau/imgbed//img/image-20221202180518764.png><img src=https://cdn.jsdelivr.net/gh/CylonChau/imgbed//img/image-20221202180518764.png#center alt=image-20221202180518764 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><h2 id=mod_expires-缓存功能>mod_expires 缓存功能<a hidden class=anchor aria-hidden=true href=#mod_expires-缓存功能>#</a></h2><p>mod_expires允许通过apache配置文件控制 HTTP “Expires:” 和 “Cache-Control:” 头内容，这个模块控制服务器应答时的Expires头内容和Cache-Control头的max-age指令。有效期可以设置为相对于源文件的最后修改时刻或者客户端的访问时刻。</p><p>这些HTTP头向客户端表明了内容的有效性和持久性。如果客户端本地有缓存，则内容就可以从缓存（除非过期）而不是从服务器读取。人后客户端会检查缓存中的副本，看看是否过期或者失效，以决定是否重新从服务器获得内容更新。</p><h3 id=常规方法安装-1>常规方法安装<a hidden class=anchor aria-hidden=true href=#常规方法安装-1>#</a></h3><p>&ndash;enable-deflate</p><p>提供对内容的亚索传输编码支持，一般html js css等内容站点，使用此参数功能会大大提高传输速度，提升访问者访问体验。在生产环境中，这是Apache调优的一个重要选项之一。</p><p>以DSO动态模块加载mod_deflate配置的全部命令为：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /root/tools/httpd-2.4.18/modules/metadata#&lt;<span class=o>==</span>切换到apache软件目录mod_expires程序下
</span></span><span class=line><span class=cl>/app/apache/bin/apxs  -c -i -a mod_expires.c <span class=c1>#&lt;==以dso的方式编译入到apache中</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=mod_expires在httpd中应用>mod_expires在httpd中应用<a hidden class=anchor aria-hidden=true href=#mod_expires在httpd中应用>#</a></h3><p>在主配置文件中配置，所有的虚拟主机都生效，在对应的虚拟主机上配置，只有对应的虚拟主机生效</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>&lt;ifmodule expires_module&gt;
    ExpiresActive on
    ExpiresDefault &#34;access plus 12 months&#34;
    ExpiresByType test/html &#34;access plus 1 years&#34;
    ExpiresByType test/css &#34;access plus 1 years&#34;
    ExpiresByType test/xml &#34;access plus 1 years&#34;
    ExpiresByType test/php &#34;access plus 1 years&#34;
    ExpiresByType image/gif &#34;access plus 30 days&#34;
    #ExpiresByType image/jpeg &#34;access plus 30 days&#34;
    #ExpiresByType image/jpg &#34;access plus 30 days&#34;
    ExpiresByType image/jpeg A7200000
	ExpiresByType image/png &#34;access plus 30 days&#34;
    ExpiresByType application/javascript &#34;access plus 30 days&#34;
    ExpiresByType application/x-javascript &#34;access plus 30 days&#34;
    ExpiresByType image/png &#34;access plus 30 days&#34;
&lt;/ifmodule&gt;</code></pre></div></div><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/CylonChau/imgbed//img/image-20221202180534378.png><img src=https://cdn.jsdelivr.net/gh/CylonChau/imgbed//img/image-20221202180534378.png#center alt=image-20221202180534378 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><h2 id=配置httpd防盗链功能>配置httpd防盗链功能<a hidden class=anchor aria-hidden=true href=#配置httpd防盗链功能>#</a></h2><h3 id=httpd-web服务实现防盗链>httpd Web服务实现防盗链<a hidden class=anchor aria-hidden=true href=#httpd-web服务实现防盗链>#</a></h3><p>利用referer和rewrite实现Apache防盗链调用，在主配置文件 <code>httpd.conf</code> 或者在虚拟主机 <code>httpd-vhosts.conf</code> 中配置如下</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>RewriteEngine ON	
RewriteCond %{HTTP_REFERER} !^http://www.test.com/.*$ [NC] #&lt;==此处，如果加http://就必须加^,否则直接写servername即可 如下
RewriteCond %{HTTP_REFERER} !http://www.test.com [NC]
RewriteCond %{HTTP_REFERER} !^http://www.test.com$ [NC]
RewriteCond %{SCRIPT_FILENAME} !nolink.png [NC]#&lt;==为防止无限302，文件名如果为nolink.png即不重写
RewriteRule .*\.(gif|jpg|swf|png)$ img/nolink.png [R,NC,L] #&lt;==重写时，必须加R</code></pre></div></div><p>访问查看结果</p><img src=https://cdn.jsdelivr.net/gh/CylonChau/imgbed//img/image-20221202174359240.png alt=image-20221202174359240 style=zoom:67%><p>用原本的域名访问，可直接访问</p><img src=https://cdn.jsdelivr.net/gh/CylonChau/imgbed//img/image-20221202174426073.png alt=image-20221202174426073 style=zoom:80%><h3 id=httpd常用rewrite标志>httpd常用Rewrite标志<a hidden class=anchor aria-hidden=true href=#httpd常用rewrite标志>#</a></h3><table><thead><tr><th>flag</th><th>说明</th></tr></thead><tbody><tr><td>Chain|C</td><td>如果当前规则被匹配，则继续处理其后继规则，如果当前规则不被匹配， 则其后继规则将被跳过。</td></tr><tr><td>forbidden|F</td><td>强制禁止当前URL的响应，并向客户端发送一个403的HTTP响应代码。</td></tr><tr><td>gone|G</td><td>强制废弃当前URL,向客户端发送一个410的HTTP响应代码，来表明此URL是已被废弃的。</td></tr><tr><td>handler|H=Content-handler</td><td>为需要处理的目标文件强制指定一个内容处理器。</td></tr><tr><td>last|L</td><td>停止标志，当mod_rewrite模块处理到此标志时会停止重写搡作，并不再应用其他重写规则。此标志通常用于跳出规则处理。</td></tr><tr><td>next|N</td><td>循环重写规则，从第一个规则开始再次执行重写规则，但此时处理的URL己经不是原始的URL.它相当于Perl语言中的next命令。</td></tr><tr><td>nocase|NC</td><td>忽略Pattern中的大小写。</td></tr><tr><td>Noescape|NE</td><td>使用此标记可以让URL中允许使用一些特殊字符，例如，‘T’、‘%’、‘;’等，如果不使用此标记则是将这些特殊字符转换成等值的16进制编码如‘%25’、‘%24’、‘%3B’等。</td></tr><tr><td>nosubreq|NS</td><td>不对内部子请求进行处理，使用此标记如果是内部子请求，则跳过当前规则。通常使用CGI脚本的子请求会出现一些问题，因此可以使用些标记来 禁止子请求。</td></tr><tr><td>proxy|P</td><td>强制重写的URL在内部由代理服务器模块来处理，并中断重写过程。使用这个标记要注意的是需要保证代理模块已经被加载，同时替换的字串是一个能被代理模块处理的有效的URL,否则代理模块将会返回一个错误的信息。</td></tr><tr><td>Passthiough|PT</td><td>将此URL强制交给下一个处理器来进行处理，而在转交之前， mod_rewrite模块会将内部request_rec结构中的URL字段设置为filename字段的值，这使得RewriteRule指令的输出能够被（从URL转换到文件名的）Alias、 ScriptAlias、Redirect等指令进行后续处理。</td></tr><tr><td>Qsappend|QSA</td><td>你可以通过此标记在现有的替换字符串中增加一个査询字符串， 注意：是增加而不是替换。</td></tr><tr><td></td><td>将重写的URL作为一个重定向处理，在使用这个标记时，必须确保该替换字段是一个有效的URL。否则，它会指向一个无效的位置，并且此 标记本身只是对URL加上http://thishost[:thisport]/前缀。如果没有在此标记后面指 定HTTP响应代码则会使用302 (临时性移动）这个响应代码来进行处理。用户可指定的响应代码范围为300〜400,或是使用符号化的名称，例如，temp、seeother 等。</td></tr><tr><td>redirect|R[=code]</td><td>将重写的URL作为一个重定向处理，在使用这个标记时，必须确保该替换字段是一个有效的URL。否则，它会指向一个无效的位置，并且此 标记本身只是对URL加上 <code>http://thishost[:thisport]/</code> 前缀。如果没有在此标记后面指 定HTTP响应代码则会使用302 (临时性移动）这个响应代码来进行处理。用户可指定的响应代码范围为300〜400,或是使用符号化的名称，例如，temp、seeother 等。</td></tr><tr><td>skip|S=num</td><td>与chain|C标记不同，使用此标记将强制跳过后继的规则，用户可以通过此标记来模拟if-then-else结构，最后一个规则是then从句，而被跳过的skip=N 个规则是else从句。</td></tr><tr><td>type|T=MIME-type</td><td>强制目标文件的MIME类型为MIME-type所指定的类型。</td></tr></tbody></table><h2 id=禁止资源目录解析php程序>禁止资源目录解析PHP程序<a hidden class=anchor aria-hidden=true href=#禁止资源目录解析php程序>#</a></h2><p>方案1：提示下载不解析</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>&lt;Directory &#34;/app/apache-2.4.18/htdocs/php&#34;&gt;
AllowOverride None
Options None
Require all granted
php_admin_flag engine off #&lt;==禁止解析php文件，此参数必须apex方式安装才存在。反之报错
&lt;/Directory&gt;</code></pre></div></div><img src=https://cdn.jsdelivr.net/gh/CylonChau/imgbed//img/image-20221202175111862.png alt=image-20221202175111862 style=zoom:80%><p><code>php_admin_flag engine off</code> 这个语句就是禁止解析 php 的控制语句，但只这样配置还不够，因为这样配置后用户依然可以访问 php 文件，只不过不解析了，但可以下载，用户下载 php 文件也是不合适的，所以有必要再禁止一下。</p><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/CylonChau/imgbed//img/image-20221202175148577.png><img src=https://cdn.jsdelivr.net/gh/CylonChau/imgbed//img/image-20221202175148577.png#center alt=image-20221202175148577 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><h2 id=禁止目录索引浏览功能>禁止目录索引浏览功能<a hidden class=anchor aria-hidden=true href=#禁止目录索引浏览功能>#</a></h2><p>默认配置当网站没有首页文件时，httpd会把整个目录结构展示给网站用户，这是非常大的隐患，必须要屏蔽掉。</p><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/CylonChau/imgbed//img/image-20221202175604755.png><img src=https://cdn.jsdelivr.net/gh/CylonChau/imgbed//img/image-20221202175604755.png#center alt=image-20221202175604755 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><p>在主配置文件 <code>httpd.conf</code> 或者虚拟主机的配置文件 <code>httpd-vhost.conf</code> 文件配置如下内容即可</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>&lt;Directory &#34;/app/apache-2.4.18/htdocs&#34;&gt;
    Options FollowSymLinks
    AllowOverride None
    Require all granted
    Allow from all
&lt;/Directory&gt;</code></pre></div></div><p>或</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>&lt;Directory &#34;/app/apache-2.4.18/htdocs&#34;&gt;
    Options -Indexes FollowSymLinks
    AllowOverride None
    Require all granted
    Allow from all
&lt;/Directory&gt;</code></pre></div></div><p>更改之后出现403权限问题，说明禁止了目录索引功能</p><h2 id=关闭无用的cgi功能配置>关闭无用的CGI功能配置<a hidden class=anchor aria-hidden=true href=#关闭无用的cgi功能配置>#</a></h2><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>304 &lt;IfModule alias_module&gt;
305     #
306     # Redirect: Allows you to tell clients about documents that used to 
307     # exist in your server&#39;s namespace, but do not anymore. The client 
308     # will make a new request for the document at its new location.
309     # Example:
310     # Redirect permanent /foo http://www.example.com/bar
311 
312     #
313     # Alias: Maps web paths into filesystem paths and is used to
314     # access content that does not live under the DocumentRoot.
315     # Example:
316     # Alias /webpath /full/filesystem/path
317     #
318     # If you include a trailing / on /webpath then the server will
319     # require it to be present in the URL.  You will also likely
320     # need to provide a &lt;Directory&gt; section to allow access to
321     # the filesystem path.
322 
323     #
324     # ScriptAlias: This controls which directories contain server scripts. 
325     # ScriptAliases are essentially the same as Aliases, except that
326     # documents in the target directory are treated as applications and
327     # run by the server when requested rather than as documents sent to the
328     # client.  The same rules about trailing &#34;/&#34; apply to ScriptAlias
329     # directives as to Alias.
330     #
331     ScriptAlias /cgi-bin/ &#34;/app/apache-2.4.18/cgi-bin/&#34;
332 
333 &lt;/IfModule&gt;

&lt;Directory &#34;/app/apache-2.4.18/htdocs/bbs&#34;&gt;
    Options FollowSymLinks
    AllowOverride None
 	Order allow,deny
    Allow form all
 &lt;/Directory&gt;</code></pre></div></div><h2 id=禁止httpd用户重载功能>禁止httpd用户重载功能<a hidden class=anchor aria-hidden=true href=#禁止httpd用户重载功能>#</a></h2><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>&lt;Directory &#34;/app/apache-2.4.18/htdocs&#34;&gt;
    Options -Indexes FollowSymLinks
    AllowOverride None		#&lt;==禁止用户重载
    Require all granted
    Allow from all
&lt;/Directory&gt;</code></pre></div></div><p>禁止用户重载会加快服务器响应速度，因为它不在为每个请求寻找每个目录访问控制文件(.htaccess)。也杜绝了开发人员变相修改配置的安全隐患</p><h2 id=避免使用htaccess文件>避免使用.htaccess文件<a hidden class=anchor aria-hidden=true href=#避免使用htaccess文件>#</a></h2><p>在Apache中，AllowOvCTride 指令来设置是否启用 <code>.htaccess</code> 文件功能。但是对于一些管理员来说，更简单更精细化的控制目录可以为他们节省很多的时间，于是 <code>.htaccess</code> 文件提供了一个这样的功能，你可以使用默认AllowOverride指令是使用None参数来禁止使用.htaccess文件功能。</p><p>可使用参数：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>* All：使用所有能在.htaccess文件中使用的指令.
* AuthConfig：使用鉴权指令，例如，AuthName、AuthType 等.
* FileInfo：使用控制文件类型的指令，例如，ErrorDocument、SetOutputFilter等. 
* Indexes:使用目录索引指令.
* Options：使用控制目录功能指令.
* Limit：使用主机访问控制指令.</code></pre></div></div><p>注意：</p><p><code>.htaccess</code> 文件会导致服务器性能的急速（如果服务器上有很多目录，且每层目录下都有.haccess文件）下降，在使用了AllowOverride指令允许使用 <code>.htaccess </code>文件后，无论是否使用 <code>.htaccess</code> 文件，httpd都会在每个目录下查找 <code>.htaccess</code> 文件。其次，当每个请求链接到来时，httpd 会查找链接所请求目录下的 <code>.htaccess</code> 文件，并且再査找它的上级目录中的 <code>.htaccess</code> 文件以使 <code>.htaccess </code>文件内的设置都能生效。这些査找会让httpd 性能降低很多。另外还有安全方面的问题，<code>.htaccess</code> 文件可以修改和覆盖服务器的指令，因此会产生一些未被限制的修改，而这些修改将会导致一些安全问题的出现。</p><h2 id=如何对httpd配置优化>如何对httpd配置优化？<a hidden class=anchor aria-hidden=true href=#如何对httpd配置优化>#</a></h2><ul><li>配置软件软件轮训Apache访问日志</li><li>优化访问日志记录的信息</li><li>配置HTTP错误页面优雅显示</li><li>配置 httpd 对站点文件压缩</li><li>Mod_Expires缓存功能</li><li>更改 httpd 默认用户</li><li>调整 httpd 的工作模式</li><li>屏蔽 httpd 对外显示的版本等敏感信息</li><li>屏蔽 httpd 对外显示的版本等敏感信息</li><li>最小化 httpd 目录及文件权限设置</li><li>最小化 httpd 日志目录权限</li><li>加大 httpd 并发连接数</li><li>配置 httpd 防盗链功能</li><li>禁止 httpd 目录索引浏览功能</li><li>禁止 httpd 用户重载功能</li><li>避免使用.htaccess文件</li><li>关闭无用的CGI功能配置</li><li>禁止资源目录解析PHP程序</li><li>使用TMPFS文件系统替代频繁访问的目录</li><li>尽可能减少HTTP请求</li><li>使用CDN左网站加速</li><li>httpd 程序架构优化</li><li>httpd 的安全模块</li><li>正确途径取得源代码，勤打 httpd 补丁</li><li>系统内核参数优化</li><li>配置Mod_Pagespeed优化Web性能</li><li>防止用户请求跳出Web站点目录</li></ul></div><div class=pe-copyright><hr><blockquote><p>本文为原创内容，版权归作者所有。如需转载，请在文章中声明本文标题及链接。</p><p>文章标题：Apache httpd配置集锦</p><p>文章链接：<a href=https://www.oomkill.com/2016/10/apache-httpd/ target=_blank>https://www.oomkill.com/2016/10/apache-httpd/</a></p><p>许可协议：<a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.oomkill.com/tags/web-middleware/>Web Middleware</a></li></ul><nav class=paginav><a class=prev href=https://www.oomkill.com/2016/10/ch7-iptables-kernel-parameter/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></polyline></svg>&nbsp;</span>
<span>ch7 关于iptables的内核参数</span>
</a><a class=next href=https://www.oomkill.com/2016/10/php-ini/><span class=title></span>
<span>php.ini优化&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span></a></nav></footer><div class=pe-comments-decoration><p class=pe-comments-title></p><p class=pe-comments-subtitle></p></div><div id=pe-comments></div><script src=/js/pe-go-comment.min.86a214102576ba5f9b7bdc29eed8d58dd56e34aef80b3c65c73ea9cc88443696.js integrity="sha256-hqIUECV2ul+be9wp7tjVjdVuNK74Czxlxz6pzIhENpY="></script><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const s={src:"https://giscus.app/client.js","data-repo":"cylonchau/cylonchau.github.io","data-repo-id":"R_kgDOIRlNSQ","data-category":"Announcements","data-category-id":"DIC_kwDOIRlNSc4CXy1U","data-mapping":"pathname","data-term":"posts/apache httpd","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"top","data-theme":getStoredTheme(),"data-lang":"zh-TW","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(s).forEach(([t,n])=>e.setAttribute(t,n)),document.querySelector("#pe-comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme);const n=document.querySelector("#theme-toggle-float");n&&n.addEventListener("click",setGiscusTheme)})</script></article></main><footer class=footer><span>&copy; 2024 <a href=https://www.oomkill.com/>Cylon's Collection</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> on
<a href=https://pages.github.com/ rel=noopener target=_blank>GitHub Pages</a> & Theme
        <a href=https://github.com/tofuwine/PaperMod-PE rel=noopener target=_blank>PaperMod-PE</a></span></footer><div class=pe-right-sidebar><a href=javascript:void(0); id=theme-toggle-float class=pe-float-btn><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a href=#top class=pe-float-btn id=top-link><span id=pe-read-progress></span></a></div><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>