<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ch2 从零开始安装OpenVPN | Cylon's Collection</title><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NP3JNCPR" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><meta name=keywords content="VPN"><meta name=description content="OpenVPN安装环境需求 设备 IP 笔记本或PC
(adsl上网) 10.0.0.0/24 办公室（DHCP） OpenVPN Server双网卡 eth0:10.0.0.4/24（外网）
eth1:192.168.100.4（内网） IDC机房内部局域网服务器 192.168.100.0/24
IDC机房内网服务器无外网IP，又希望ADSL上网笔记本（运维人员），在不同的网络能够直接访问 实现需求：在远端通过VPN客户端(笔记本)拨号到VPN，然后在笔记本电脑上可以直接访问vpnserver所在局域网内的多个servers，进行维护管理 环境 VPN-Server eth0:10.0.0.4(外网IP)。GW:10.0.0.1, dns:10.0.0.1。
eth1:172.0.0.1(内网IP)。GW:不配
提示：检查是否可以ping通client eth0 IP。
App client Server:ethO:172.0.0.2。GW:路由器。提示：检查是否可以ping通VPN-Server eth1 IP。 OpenVPN 解决方案图解部署OpenVPN Server Reference download lzo
installing-openvpn
openvpn offical releases
openvpn github
安装前准备
openvpn支持的平台：
Linux kernel 2.6+ OpenBSD 5.1+ Mac OS X Darwin 10.5+ FreeBSD 7.4+ Windows (WinXP and higher) 下载地址：
openvpn-releases openvpn github 安装openvpn的依赖项：
0.9.8版或更高版本的OpenSSL库，对于加密是必需的 PolarSSL库，是加密的替代版本1.1或更高版本 LZO实时压缩库，连接压缩所需 bash 1 yum install openssl-devel lzo-devel pam-devel -y bash 1 2 3 4 5 6 ."><meta name=author content="cylon"><link rel=canonical href=https://www.oomkill.com/2019/11/ch2-install-and-configuration/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://www.oomkill.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.oomkill.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.oomkill.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.oomkill.com/favicon.ico><link rel=mask-icon href=https://www.oomkill.com/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://www.oomkill.com/2019/11/ch2-install-and-configuration/><noscript><style>#theme-toggle,#top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link crossorigin=anonymous href=/assets/css/pe.min.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/pe.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/all.min.css><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/v4-shims.min.css><script defer src=https://cdn.staticfile.net/jquery/3.5.1/jquery.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/fancybox/3.5.7/jquery.fancybox.min.css><script defer src=https://cdn.staticfile.net/fancybox/3.5.7/jquery.fancybox.min.js></script><script id=MathJax-script async src=https://cdn.staticfile.net/mathjax/3.2.2/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["$$","$$"]],inlineMath:[["\\$","\\$"]]}}</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-NP3JNCPR")</script><meta property="og:title" content="ch2 从零开始安装OpenVPN"><meta property="og:description" content="OpenVPN安装环境需求 设备 IP 笔记本或PC
(adsl上网) 10.0.0.0/24 办公室（DHCP） OpenVPN Server双网卡 eth0:10.0.0.4/24（外网）
eth1:192.168.100.4（内网） IDC机房内部局域网服务器 192.168.100.0/24
IDC机房内网服务器无外网IP，又希望ADSL上网笔记本（运维人员），在不同的网络能够直接访问 实现需求：在远端通过VPN客户端(笔记本)拨号到VPN，然后在笔记本电脑上可以直接访问vpnserver所在局域网内的多个servers，进行维护管理 环境 VPN-Server eth0:10.0.0.4(外网IP)。GW:10.0.0.1, dns:10.0.0.1。
eth1:172.0.0.1(内网IP)。GW:不配
提示：检查是否可以ping通client eth0 IP。
App client Server:ethO:172.0.0.2。GW:路由器。提示：检查是否可以ping通VPN-Server eth1 IP。 OpenVPN 解决方案图解部署OpenVPN Server Reference download lzo
installing-openvpn
openvpn offical releases
openvpn github
安装前准备
openvpn支持的平台：
Linux kernel 2.6+ OpenBSD 5.1+ Mac OS X Darwin 10.5+ FreeBSD 7.4+ Windows (WinXP and higher) 下载地址：
openvpn-releases openvpn github 安装openvpn的依赖项：
0.9.8版或更高版本的OpenSSL库，对于加密是必需的 PolarSSL库，是加密的替代版本1.1或更高版本 LZO实时压缩库，连接压缩所需 bash 1 yum install openssl-devel lzo-devel pam-devel -y bash 1 2 3 4 5 6 ."><meta property="og:type" content="article"><meta property="og:url" content="https://www.oomkill.com/2019/11/ch2-install-and-configuration/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-11-18T00:00:00+00:00"><meta property="article:modified_time" content="2023-03-22T23:10:36+08:00"><meta property="og:site_name" content="Cylon's Collection"><meta name=twitter:card content="summary"><meta name=twitter:title content="ch2 从零开始安装OpenVPN"><meta name=twitter:description content="OpenVPN安装环境需求 设备 IP 笔记本或PC
(adsl上网) 10.0.0.0/24 办公室（DHCP） OpenVPN Server双网卡 eth0:10.0.0.4/24（外网）
eth1:192.168.100.4（内网） IDC机房内部局域网服务器 192.168.100.0/24
IDC机房内网服务器无外网IP，又希望ADSL上网笔记本（运维人员），在不同的网络能够直接访问 实现需求：在远端通过VPN客户端(笔记本)拨号到VPN，然后在笔记本电脑上可以直接访问vpnserver所在局域网内的多个servers，进行维护管理 环境 VPN-Server eth0:10.0.0.4(外网IP)。GW:10.0.0.1, dns:10.0.0.1。
eth1:172.0.0.1(内网IP)。GW:不配
提示：检查是否可以ping通client eth0 IP。
App client Server:ethO:172.0.0.2。GW:路由器。提示：检查是否可以ping通VPN-Server eth1 IP。 OpenVPN 解决方案图解部署OpenVPN Server Reference download lzo
installing-openvpn
openvpn offical releases
openvpn github
安装前准备
openvpn支持的平台：
Linux kernel 2.6+ OpenBSD 5.1+ Mac OS X Darwin 10.5+ FreeBSD 7.4+ Windows (WinXP and higher) 下载地址：
openvpn-releases openvpn github 安装openvpn的依赖项：
0.9.8版或更高版本的OpenSSL库，对于加密是必需的 PolarSSL库，是加密的替代版本1.1或更高版本 LZO实时压缩库，连接压缩所需 bash 1 yum install openssl-devel lzo-devel pam-devel -y bash 1 2 3 4 5 6 ."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.oomkill.com/posts/"},{"@type":"ListItem","position":2,"name":"ch2 从零开始安装OpenVPN","item":"https://www.oomkill.com/2019/11/ch2-install-and-configuration/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ch2 从零开始安装OpenVPN","name":"ch2 从零开始安装OpenVPN","description":"OpenVPN安装环境需求 设备 IP 笔记本或PC\n(adsl上网) 10.0.0.0/24 办公室（DHCP） OpenVPN Server双网卡 eth0:10.0.0.4/24（外网）\neth1:192.168.100.4（内网） IDC机房内部局域网服务器 192.168.100.0/24\nIDC机房内网服务器无外网IP，又希望ADSL上网笔记本（运维人员），在不同的网络能够直接访问 实现需求：在远端通过VPN客户端(笔记本)拨号到VPN，然后在笔记本电脑上可以直接访问vpnserver所在局域网内的多个servers，进行维护管理 环境 VPN-Server eth0:10.0.0.4(外网IP)。GW:10.0.0.1, dns:10.0.0.1。\neth1:172.0.0.1(内网IP)。GW:不配\n提示：检查是否可以ping通client eth0 IP。\nApp client Server:ethO:172.0.0.2。GW:路由器。提示：检查是否可以ping通VPN-Server eth1 IP。 OpenVPN 解决方案图解\r部署OpenVPN Server Reference download lzo\ninstalling-openvpn\nopenvpn offical releases\nopenvpn github\n安装前准备\nopenvpn支持的平台：\nLinux kernel 2.6+ OpenBSD 5.1+ Mac OS X Darwin 10.5+ FreeBSD 7.4+ Windows (WinXP and higher) 下载地址：\nopenvpn-releases openvpn github 安装openvpn的依赖项：\n0.9.8版或更高版本的OpenSSL库，对于加密是必需的 PolarSSL库，是加密的替代版本1.1或更高版本 LZO实时压缩库，连接压缩所需 bash 1 yum install openssl-devel lzo-devel pam-devel -y bash 1 2 3 4 5 6 .","keywords":["VPN"],"articleBody":"OpenVPN安装环境需求 设备 IP 笔记本或PC\n(adsl上网) 10.0.0.0/24 办公室（DHCP） OpenVPN Server双网卡 eth0:10.0.0.4/24（外网）\neth1:192.168.100.4（内网） IDC机房内部局域网服务器 192.168.100.0/24\nIDC机房内网服务器无外网IP，又希望ADSL上网笔记本（运维人员），在不同的网络能够直接访问 实现需求：在远端通过VPN客户端(笔记本)拨号到VPN，然后在笔记本电脑上可以直接访问vpnserver所在局域网内的多个servers，进行维护管理 环境 VPN-Server eth0:10.0.0.4(外网IP)。GW:10.0.0.1, dns:10.0.0.1。\neth1:172.0.0.1(内网IP)。GW:不配\n提示：检查是否可以ping通client eth0 IP。\nApp client Server:ethO:172.0.0.2。GW:路由器。提示：检查是否可以ping通VPN-Server eth1 IP。 OpenVPN 解决方案图解\r部署OpenVPN Server Reference download lzo\ninstalling-openvpn\nopenvpn offical releases\nopenvpn github\n安装前准备\nopenvpn支持的平台：\nLinux kernel 2.6+ OpenBSD 5.1+ Mac OS X Darwin 10.5+ FreeBSD 7.4+ Windows (WinXP and higher) 下载地址：\nopenvpn-releases openvpn github 安装openvpn的依赖项：\n0.9.8版或更高版本的OpenSSL库，对于加密是必需的 PolarSSL库，是加密的替代版本1.1或更高版本 LZO实时压缩库，连接压缩所需 bash 1 yum install openssl-devel lzo-devel pam-devel -y bash 1 2 3 4 5 6 ./configure \\ --sbindir=/usr/sbin/ --sysconfdir=/etc/openvpn/ --libdir=/usr/lib/ --includedir=/usr/include/ --docdir=/usr/doc 使用rpmbuild安装：openvpn.spec\n配置OpenVPN Server openvpn的配配置文件在下面目录中\nsample/sample-config-files/client.conf\nsample/sample-config-files/server.conf\nbash 1 cp sample-config-files/server.conf /etc/openvpn/ 建立CA证书 easy-rsa是一个基于OpenSSL命令行工具的小型RSA密钥管理包。虽然它主要关注SSL VPN应用程序空间的密钥管理，但它也可用于构建Web证书。它最初被包含在OpenVPN中，但现在是一个单独的项目。\nopenvpn在2.3-alpha1 -\u003e 2.3-alpha2版本迭代是将easy-rsa分割为单独的子项目。在2.3版本之前easy-rsa包含在openvpn内，在openvpn-2.2.2/easy-rsa/2.0目录下。\n证书也可以使用openssl进行生成，easy-rsa可以简化证书生成流程。\n设置并签署第一个请求 ./easyrsa help [commond] 查看帮助\n./easyrsa init-pki 初始化公钥基础设施，（初始化单独的PKI目录）\n./easyrsa build-ca nopass 创建ca\n./easyrsa gen-req {name} nopass 创建CSR，{name}只是一个名字，不代表任何。\n./easyrsa import-req pki/{name}.req 将请求文件.req，导入CA\n./easyrsa sign-req {server|client} {name} 签署请求\n./easyrsa revoke {name} 吊销证书\n./easyrsa gen-dh 生成Diffie-Hellman\nReference easyrsa readme\nEasyRSA的配置源 在easyrsa生成证书时，需要提供证书的配置，来设置证书对应的详情。此时就需要easyrsa获取外部的配置来替换证书默认的参数。\neasyrsa有四种方式获得外部配置\n命令行选项\n环境变量 ：覆盖全局选项\nenv-vars列表，任何设置/覆盖它的（CLI）以及可能的简洁描述如下所示：\nEASYRSA easyrsa脚本所在的Easy-RSA顶级目录。 EASYRSA_PKI 保存PKI的文件的目录，默认为$PWD/pki。 EASYRSA_DN：设置为字符串cn_only或org更改要包含在请求DN中的字段 EASYRSA_REQ_COUNTRY：DN国家 EASYRSA_REQ_PROVINCE：DN状态/省 EASYRSA_REQ_CITY：DN城市/位置 EASYRSA_REQ_ORG：DN组织 EASYRSA_REQ_EMAIL：DN电子邮件 EASYRSA_REQ_OU：DN组织单位 EASYRSA_KEY_SIZE：设置密钥大小单位 EASYRSA_ALGO：设置要使用的加密算法：rsa或ec EASYRSA_CA_EXPIRE：设置CA到期时间 EASYRSA_CERT_EXPIRE：设置已颁发证书的到期时间：单位天 EASYRSA_REQ_CN：默认CN，批量配置时可设置。 vars 文件：无扩展名的vars文件是为Easy-RSA提供配置的文件，该文件优先级低于环境变量与命令行参数。easyrsa对vars文件的检测顺序为：\n--vars 参数引用的文件 环境变量值EASYRSA_VARS_FILE 环境变量设置的pki目录 EASYRSA_PKI 执行默认目录 $PWD/pki 内部默认值\n生成服务端证书和密钥KEY文件\n与上一步类似，其中“Common Name”项需要填写VPN服务器的FQDN，其他均可默认为default值。还会出现：“Sign the certificate? [y/n]”和“1 out of 1 certificate requests certified, commit? [y/n]”。都输入y然后回车，其它可参照如下。\nbash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 ### 准备生成证书用的CSR相关配置 export EASYRSA_REQ_COUNTRY=\"HK\" export EASYRSA_REQ_PROVINCE=\"HK\" export EASYRSA_REQ_CITY=\"HongKong\" export EASYRSA_REQ_ORG=\"china mobile\" export EASYRSA_REQ_EMAIL=\"10086.chinamobile.cn\" #证书有效期 export EASYRSA_CA_EXPIRE=3650 export EASYRSA_CERT_EXPIRE=3650 # 默认cn export EASYRSA_REQ_CN=\"csol\" # 批处理模式 export EASYRSA_BATCH=\"enable\" ## 初始化pki ./easyrsa init-pki ## 创建CA ./easyrsa build-ca nopass ## 申请csr ./easyrsa gen-req csol nopass ## 导入csr ./easyrsa import-req ./pki/reqs/csol.req csol ## 签发证书 ./easyrsa sign-req server csol 注意：easyrsa在执行是也是通过openssl进行，需要openssl-easyrsa.cnf 与 x509-types\n加强OpenVPN安全性 TLS-auth 参数增加所有 SSL/TLS 握手了额外的HMAC签名的完整性验证。任何没有正确HMAC签名的UDP数据包都被丢弃，而无需进一步处理。TLS-AUTH 可以防止：\nOpenVPN UDP端口上的DDoS攻击或Flood DDoS 。 端口扫描以确定哪些UDP端口处于侦听状态。 SSL/TLS缓冲区溢出漏洞。 切断来自未经授权的机器的SSL/TLS握手。 生成随机共享密钥（仅适用于非TLS静态密钥加密模式）\nbash 1 openvpn --genkey secret ta.key 在服务器配置中，添加：\ntext 1 tls-auth ta.key 0 在客户端配置中，添加：\ntext 1 tls-auth ta.key 1 Reference openvpn-security\n调试OpenVPN服务端 取消服务器上防火墙iptables对Openvpn(默认1194)的拦截。以及允许服务进行转发。\ncentos7+ firewalld\nbash 1 2 firewall-cmd --add-port=1194/udp --permanent firewall-cmd --permanent --direct --passthrough ipv4 -t nat -A POSTROUTING -s 192.168.100.0/24 -o eth1 -j MASQUERADE iptables\ntext 1 2 iptables -A INPUT -i eth0 -m state --state NEW -p udp --dport 1194 -j ACCEPT iptables -t nat -A POSTROUTING -o eth1 -s 192.168.100.0/24 -j MASQUERADE 开启内核转发功能：\ntext 1 2 sysctl net.ipv4.ip_forward |grep 1 \u003e /dev/null \u0026\u0026 \\ echo net.ipv4.ip_forward=1 \u003e\u003e /etc/sysctl.conf 启动OpenVPN server\ntext 1 openvpn --config server.conf 默认情况下，openvpn客户端不能访问客户端上具相同子网的IP的主机。\n服务端 server.conf参数详解 openvpn默认配置文件在 sample/sample-config-files/server.conf 目录下。\nbash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 ##################################################### # 多客户端服务器的OpenVPN 2.0配置文件示例\t# # # # 本文件用于多客户端\u003c-\u003e单服务器端的 # # OpenVPN服务器端配置 # # # # OpenVPN也支持单机\u003c-\u003e单机的配置 # # (在网站上的示例页面更多信息) # # # # 这个配置可以在Windows或Linux/BSD系统上工作\t# # Windows的路径名需要加双引号并使用双反斜杠 如\t# # \"C:\\\\Program Files\\\\OpenVPN\\\\config\\\\foo.key\"\t# # # # 前面加'#'或';'的是注释 # ##################################################### # OpenVPN应该监听哪个本地IP地址（可选） # 如果不设置，默认监听所有IP ;local a.b.c.d # OpenVPN应该监听哪个端口(TCP/UDP) # 如果想在同一台计算机上运行多个OpenVPN实例，可以使用不同的端口号来区分它们 # 在防火墙上打开这个端口 port 1194 # 服务器使用TCP还是UDP协议 ;proto tcp proto udp # 指定OpenVPN创建的通信隧道类型 # \"dev tun\"将会创建一个路由IP隧道 # \"dev tap\"将会创建一个以太网隧道 # 如果是以太网桥接模式，并且提前创建了一个名为\"tap0\"的与以太网接口进行桥接的虚拟接口，则你可以使用\"dev tap0\" # 如果想控制VPN的访问策略，必须为TUN/TAP接口创建防火墙规则 # 在非Windows系统中，可以给出明确的单位编号，如\"tun0\" # 在Windows中，也可以使用\"dev-node\" # 在大多数系统上，除非部分或完全禁用了TUN/TAP接口的防火墙，否则VPN将不起作用。 ;dev tap dev tun # 如果想配置多个隧道，需要用到网络连接面板中TAP-Win32适配器的名称(如\"MyTap\") # 在XP SP2或更高版本的系统中，可能需要有选择地禁用掉针对TAP适配器的防火墙 # 通常情况下，非Windows系统则不需要该指令。 ;dev-node MyTap # 设置SSL/TLS根证书(ca)、证书(cert)和私钥(key)。 # 每个客户端和服务器端都需要它们各自的证书和私钥文件。 # 服务器端和所有的客户端都将使用相同的CA证书文件。 # # 通过easy-rsa目录下的一系列脚本可以生成所需的证书和私钥。 # 服务器端和每个客户端的证书必须使用唯一的Common Name。 # # 也可以使用遵循X509标准的任何密钥管理系统来生成证书和私钥。 # OpenVPN也支持使用一个PKCS #12格式的密钥文件(详情查看站点手册页面的\"pkcs12\"指令) ca ca.crt cert server.crt key server.key # 该文件应该保密 # 迪菲·赫尔曼参数 # 使用如下命令生成： # openssl dhparam -out dh2048.pem 2048 dh dh2048.pem # 网络拓扑结构 # 应该为子网(通过IP寻址) # 除非必须支持Windows客户端v2.0.9及更低版本(net30即每个客户端/30) # 默认为\"net30\"(不建议) ;topology subnet # 设置服务器端模式，并提供一个VPN子网，以从中为客户端分配IP地址 # 本例中服务器端自身占用10.8.0.1，其他的将分配给客户端使用 # 每个客户端将能够通过10.8.0.1访问服务器 # 如果使用的是以太网桥接模式，注释掉本行。更多信息请查看官方手册页面。 server 10.255.255.255.0 # 在此文件中维护客户端与虚拟IP地址之间的关联记录 # 如果OpenVPN重启，重新连接的客户端可以被分配到先前分配的虚拟IP地址 ifconfig-pool-persist ipp.txt # 该指令仅针对以太网桥接模式 # 首先，必须使用操作系统的桥接能力将以太网网卡接口和TAP接口进行桥接 # 然后，需要手动设置桥接接口的IP地址、子网掩码，这里假设为10.8.0.4和255.255.255.0 # 最后，必须指定子网的一个IP范围(例如从10.8.0.50开始，到10.8.0.100结束)，以便于分配给连接的客户端 # 如果不是以太网桥接模式，直接注释掉这行指令即可 ;server-bridge 10.255.255.2510.8.0.50 10.8.0.100 # 该指令仅针对使用DHCP代理的以太网桥接模式 # 此时客户端将请求服务器端的DHCP服务器，从而获得分配给它的IP地址和DNS服务器地址 # 在此之前，也需要先将以太网网卡接口和TAP接口进行桥接 # 注意：该指令仅用于OpenVPN客户端(如Windows)，并且该客户端的TAP适配器需要绑定到一个DHCP客户端上 ;server-bridge # 推送路由信息到客户端，以允许客户端能够连接到服务器后的其他私有子网 # 即允许客户端访问VPN服务器可访问的其他局域网 # 记住，这些私有子网还需要将OpenVPN客户端地址池（10.8.0.0/255.255.255.0）路由回到OpenVPN服务器 ;push \"route 192.168.1255.255.255.0\" ;push \"route 192.168.2255.255.255.0\" # 要为指定的客户端分配特定的IP地址，或者客户端后的私有子网也要访问VPN # 可以针对该客户端的配置文件使用ccd子目录 # 请参阅手册页获取更多信息 # 示例1：假设有个Common Name为\"Thelonious\"的客户端后有一个小型子网也要连接到VPN # 该子网为192.168.40.128/255.255.255.248 # 首先，去掉下面两行指令的注释： ;client-config-dir ccd ;route 192.168.40.128 255.255.255.248 # 然后创建一个文件ccd/Thelonious，该文件的内容为(没有\"#\")： # iroute 192.168.40.128 255.255.255.248 # 客户端所在的子网就可以访问VPN了 # 注意，这个指令只能在基于路由模式而不是基于桥接模式下才能生效 # 比如，你使用了\"dev tun\"和\"server\"指令 # 示例1：假设要给Thelonious分配一个固定的IP地址10.9.0.1 # 首先，去掉下面两行指令的注释： ;client-config-dir ccd ;route 10.255.255.255.252 # 然后在文件ccd/Thelonious中添加如下指令(没有\"#\")： # ifconfig-push 10.10.9.0.2 # 如果想要为不同群组的客户端启用不同的防火墙访问策略，你可以使用如下两种方法： # (1)运行多个OpenVPN守护进程，每个进程对应一个群组，并为每个进程(群组)启用适当的防火墙规则 # (2)(进阶)创建一个脚本来动态地修改响应于来自不同客户的防火墙规则 # 关于learn-address脚本的更多信息请参考官方手册页面 ;learn-address ./script # 如果启用该行指令，所有客户端的默认网关都将重定向到VPN # 这将导致诸如web浏览器、DNS查询等所有客户端流量都经过VPN # (为确保能正常工作，OpenVPN服务器所在计算机可能需要在TUN/TAP接口与以太网之间使用NAT或桥接技术进行连接) ;push \"redirect-gateway def1 bypass-dhcp\" # 某些具体的Windows网络设置可以被推送到客户端，例如DNS或WINS服务器地址 # 下列地址来自opendns.com提供的Public DNS服务器 ;push \"dhcp-option DNS 208.67.222.222\" ;push \"dhcp-option DNS 208.67.220.220\" # 去掉该行指令的注释将允许不同的客户端之间互相访问 # 默认情况，客户端只能访问服务器 # 为了确保客户端只能看见服务器，还可以在服务器端的TUN/TAP接口上设置适当的防火墙规则 ;client-to-client # 如果多个客户端可能使用相同的证书/私钥文件或Common Name进行连接，那么可以取消该指令的注释 # 建议该指令仅用于测试目的。对于生产环境使用而言，每个客户端都应该拥有自己的证书和私钥 # 如果没有为每个客户端分别生成Common Name唯一的证书/私钥，可以取消该行的注释(不推荐这样做) ;duplicate-cn # keepalive指令将导致类似于ping命令的消息被来回发送，以便于服务器端和客户端知道对方何时被关闭 # 每10秒钟ping一次，如果120秒内都没有收到对方的回复，则表示远程连接已经关闭 keepalive 10 120 # 出于SSL/TLS之外更多的安全考虑，创建一个\"HMAC 防火墙\"可以帮助抵御DoS攻击和UDP端口淹没攻击 # 可以使用以下命令来生成： # openvpn --genkey --secret ta.key # # 服务器和每个客户端都需要拥有该密钥的一个拷贝 # 第二个参数在服务器端应该为'0'，在客户端应该为'1' tls-auth ta.key 0 # 该文件应该保密 # 选择一个密码加密算法，该配置项也必须复制到每个客户端配置文件中 # 注意，v2.4客户端/服务器将自动以TLS模式协商AES-256-GCM，请参阅手册中的ncp-cipher选项 cipher AES-256-CBC # 在VPN链接上启用压缩并将选项推送到客户端（仅适用于v+，对于早期版本，请参阅下文） ;compress lz4-v2 ;push \"compress lz4-v2\" # 对于与旧客户端兼容的压缩，使用comp-lzo # 如果在此启用，还必须在客户端配置文件中启用它 ;comp-lzo # 允许并发连接的客户端的最大数量 ;max-clients 100 # 初始化后减少OpenVPN守护进程的权限是一个好主意 # 该指令仅限于非Windows系统中使用 ;user nobody ;group nobody # 持久化选项可以尽量避免访问那些在重启之后由于用户权限降低而无法访问的某些资源 persist-key persist-tun # 输出一个简短的状态文件，用于显示当前的连接状态，该文件每分钟都会清空并重写一次 status openvpn-status.log # 默认情况下，日志消息将写入syslog(在Windows系统中，如果以服务方式运行，日志消息将写入OpenVPN安装目录的log文件夹中) # 可以使用log或者log-append来改变这种默认设置 # \"log\"方式在每次启动时都会清空之前的日志文件 # \"log-append\"是在之前的日志内容后进行追加 # 你可以使用两种方式之一(不要同时使用) ;log openvpn.log ;log-append openvpn.log # 为日志文件设置适当的冗余级别(0~9) # 冗余级别越高，输出的信息越详细 # # 0 表示静默运行，只记录致命错误 # 4 表示合理的常规用法 # 5和6 可以帮助调试连接错误 # 9 表示极度冗余，输出非常详细的日志信息 verb 3 # 忽略过多的重复信息 # 相同类别的信息只有前20条会输出到日志文件中 ;mute 20 # 通知客户端，当服务器重新启动时，可以自动重新连接 # 只能是UDP协议使用，TCP使用的话不能启动服务 explicit-exit-notify 1 # （如果不添加该指令则）默认值3600，也就是一个小时进行一次TSL重新协商 # 这个参数在服务端和客户端设置都有效 # 如果两边都设置了，就按照时间短的设定优先 # 当两边同时设置成0，表示禁用TSL重协商。使用OTP认证需要禁用 reneg-sec 0 可用的服务端配置\nconf local 10.0.0.4\rport 1194\rproto udp\rdev tun\rca ca.crt\rcert server.crt\rkey server.key\rdh dh2048.pem\r# 分配给客户端的地址池，与dhcp类似\rserver 192.168.10255.255.255.0\rifconfig-pool-persist ipp.txt\rpush \"route 192.168.10255.255.255.0\"\rclient-to-client\rduplicate-cn\rkeepalive 10 120\rcomp-lzo\rmax-clients 100\rpersist-key\rpersist-tun\rlog-append /var/log/openvpn.log\rverb 3\rmute 20\rexplicit-exit-notify 1\rreneg-sec 360\rtls-auth ta.key 0 相关证书文件说明 文件名 需要使用者 目的 默认是否加密 ca.crt server + all clients Root CA certificate NO ca.key key signing machine only Root CA key YES dh{n}.pem server only Diffie Hellman parameters NO server.crt server only Server Certificate NO server.key server only Server Key YES client1.crt client1 only Client1 Certificate NO client1.key client1 only Client1 Key YES reference explanation of the relevant files\nOpenVPN客户端配置使用 下载并安装openvpn客户端 在windows上需要下载与Server版本一致的带有GUI的Windows端。下载地址：community\n配置并下载客户端证书 生成客户端证书和key文件\n生成client证书和key文件。若建立多个客户证书，则重复如下步骤即可.只需修改Common Name项oldboy的名称。\n在OpenVPN中，这种配置方法是每一个登陆的VPN客户端需要有一个证书，每个证书在同一时刻只能供一个客户端连接（如果有两个机器安装相同证书，同时拨服务器，都能拨上，但是只有第一个拨上的才能连通网络）。所以，如果有多个人，每个人需要建立一份证书。\n将ca.crt、redis.crt、redis.key复制到OpenVPN\\config。（不同用户使用不同的证书，每个证书包括.crt和.key两个文件。如test.crt和test.key)\n在 sample-config-files/client.conf的基础上建立客户端配置文件，改名为client.oven，即先在服务器上建立配置文件，然后再下载改名到客户机上。\nbash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 client dev tun proto udp remote 10.1194 nobind resolv-retry infinite persist-key persist-tun mute-replay-warnings cipher AES-256-CBC comp-lzo verb 3 ca ca.crt cert test.crt key test.key tls-auth ta.key 1 客户端远程连接OpenVPN服务 当配置文件的扩展名为.ovpn，配置文件存放至客户端配置的目录中。ca、证书 与配置文件放置同一个文件夹内。每一组为一个用户。\n连接成功后如图所示：\nReference 证书认证\nopenvpn配置文件说明\neasyrsa签发证书\n","wordCount":"1180","inLanguage":"zh","datePublished":"2019-11-18T00:00:00Z","dateModified":"2023-03-22T23:10:36+08:00","author":{"@type":"Person","name":"cylon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.oomkill.com/2019/11/ch2-install-and-configuration/"},"publisher":{"@type":"Organization","name":"Cylon's Collection","logo":{"@type":"ImageObject","url":"https://www.oomkill.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.oomkill.com/><img src=https://www.oomkill.com/favicon.ico alt aria-label=logo height=20>Cylon's Collection</a><div class=logo-switches><button id=theme-toggle><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.oomkill.com/archives><span>归档</span></a></li><li><a href=https://www.oomkill.com/tags><span>标签</span></a></li><li><a href=https://www.oomkill.com/search><span>搜索</span></a></li><li><a href=https://www.oomkill.com/about accesskey=/><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">ch2 从零开始安装OpenVPN</h1><div class=post-meta><span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2019-11-18</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg><span>1180 字</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>6 分钟</span></span>
<span class=pe-post-meta-item>&nbsp;·&nbsp;<svg t="1714036239378" fill="currentcolor" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="6659" width="256" height="256"><path d="M690 78.2c-18.6-18.8-49-19-67.8-.4s-19 49-.4 67.8l255.4 258.6c67.8 68.6 67.8 178.8.0 247.4L653.4 878.2c-18.6 18.8-18.4 49.2.4 67.8s49.2 18.4 67.8-.4l224-226.4c104.8-106 104.8-276.4.0-382.4L690 78.2zM485.4 101.4c-24-24-56.6-37.4-90.6-37.4H96C43 64 0 107 0 160v299c0 34 13.4 66.6 37.4 90.6l336 336c50 50 131 50 181 0l267-267c50-50 50-131 0-181l-336-336zM96 160h299c8.4.0 16.6 3.4 22.6 9.4l336 336c12.4 12.4 12.4 32.8.0 45.2l-267 267c-12.4 12.4-32.8 12.4-45.2.0l-336-336c-6-6-9.4-14.2-9.4-22.6V160zm192 128a64 64 0 10-128 0 64 64 0 10128 0z" p-id="6660"/></svg></span><ul class=pe-post-meta-item><a href=https://www.oomkill.com/tags/vpn/>#VPN</a></ul></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details><summary><span class=details>目录</span></summary><div class=inner><ul><li><a href=#openvpn%e5%ae%89%e8%a3%85%e7%8e%af%e5%a2%83%e9%9c%80%e6%b1%82 aria-label=OpenVPN安装环境需求>OpenVPN安装环境需求</a><li><a href=#%e9%83%a8%e7%bd%b2openvpn-server aria-label="部署OpenVPN Server">部署OpenVPN Server</a><li><a href=#reference aria-label=Reference>Reference</a><li><a href=#%e9%85%8d%e7%bd%aeopenvpn-server aria-label="配置OpenVPN Server">配置OpenVPN Server</a><li><a href=#%e5%bb%ba%e7%ab%8bca%e8%af%81%e4%b9%a6 aria-label=建立CA证书>建立CA证书</a><ul><li><a href=#%e8%ae%be%e7%bd%ae%e5%b9%b6%e7%ad%be%e7%bd%b2%e7%ac%ac%e4%b8%80%e4%b8%aa%e8%af%b7%e6%b1%82 aria-label=设置并签署第一个请求>设置并签署第一个请求</a></ul><li><a href=#reference-1 aria-label=Reference>Reference</a><ul><li><a href=#easyrsa%e7%9a%84%e9%85%8d%e7%bd%ae%e6%ba%90 aria-label=EasyRSA的配置源>EasyRSA的配置源</a></ul><li><a href=#%e5%8a%a0%e5%bc%baopenvpn%e5%ae%89%e5%85%a8%e6%80%a7 aria-label=加强OpenVPN安全性>加强OpenVPN安全性</a><li><a href=#reference-2 aria-label=Reference>Reference</a><li><a href=#%e8%b0%83%e8%af%95openvpn%e6%9c%8d%e5%8a%a1%e7%ab%af aria-label=调试OpenVPN服务端>调试OpenVPN服务端</a><li><a href=#%e6%9c%8d%e5%8a%a1%e7%ab%af-serverconf%e5%8f%82%e6%95%b0%e8%af%a6%e8%a7%a3 aria-label="服务端 server.conf参数详解">服务端 server.conf参数详解</a><li><a href=#%e7%9b%b8%e5%85%b3%e8%af%81%e4%b9%a6%e6%96%87%e4%bb%b6%e8%af%b4%e6%98%8e aria-label=相关证书文件说明>相关证书文件说明</a><li><a href=#openvpn%e5%ae%a2%e6%88%b7%e7%ab%af%e9%85%8d%e7%bd%ae%e4%bd%bf%e7%94%a8 aria-label=OpenVPN客户端配置使用>OpenVPN客户端配置使用</a><ul><li><a href=#%e4%b8%8b%e8%bd%bd%e5%b9%b6%e5%ae%89%e8%a3%85openvpn%e5%ae%a2%e6%88%b7%e7%ab%af aria-label=下载并安装openvpn客户端>下载并安装openvpn客户端</a><li><a href=#%e9%85%8d%e7%bd%ae%e5%b9%b6%e4%b8%8b%e8%bd%bd%e5%ae%a2%e6%88%b7%e7%ab%af%e8%af%81%e4%b9%a6 aria-label=配置并下载客户端证书>配置并下载客户端证书</a><li><a href=#%e5%ae%a2%e6%88%b7%e7%ab%af%e8%bf%9c%e7%a8%8b%e8%bf%9e%e6%8e%a5openvpn%e6%9c%8d%e5%8a%a1 aria-label=客户端远程连接OpenVPN服务>客户端远程连接OpenVPN服务</a></ul><li><a href=#reference-3 aria-label=Reference>Reference</a></li></div></details></div></aside><script src=/js/pe-toc.min.445eb1bfc5e85dd13b9519fcc2a806522e9629b6224a2974052789ba00ab78af.js integrity="sha256-RF6xv8XoXdE7lRn8wqgGUi6WKbYiSil0BSeJugCreK8="></script><div class=post-content><h2 id=openvpn安装环境需求>OpenVPN安装环境需求<a hidden class=anchor aria-hidden=true href=#openvpn安装环境需求>#</a></h2><table><thead><tr><th>设备</th><th>IP</th></tr></thead><tbody><tr><td>笔记本或PC<br>(adsl上网)</td><td>10.0.0.0/24 办公室（DHCP）</td></tr><tr><td>OpenVPN Server双网卡</td><td>eth0:10.0.0.4/24（外网）<br>eth1:192.168.100.4（内网）</td></tr><tr><td>IDC机房内部局域网服务器</td><td>192.168.100.0/24<br>IDC机房内网服务器无外网IP，又希望ADSL上网笔记本（运维人员），在不同的网络能够直接访问</td></tr><tr><td></td><td>实现需求：在远端通过VPN客户端(笔记本)拨号到VPN，然后在笔记本电脑上可以直接访问vpnserver所在局域网内的多个servers，进行维护管理</td></tr><tr><td>环境</td><td>VPN-Server eth0:10.0.0.4(外网IP)。GW:10.0.0.1, dns:10.0.0.1。<br><br>eth1:172.0.0.1(内网IP)。GW:不配<br><br><strong>提示</strong>：检查是否可以ping通client eth0 IP。<br><br>App client Server:ethO:172.0.0.2。GW:路由器。<br><br><strong>提示</strong>：检查是否可以ping通VPN-Server eth1 IP。</td></tr></tbody></table><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221024214947488.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221024214947488.png#center alt=image-20221024214947488 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><center>OpenVPN 解决方案图解</center><h2 id=部署openvpn-server>部署OpenVPN Server<a hidden class=anchor aria-hidden=true href=#部署openvpn-server>#</a></h2><h2 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h2><blockquote><p><a href=http://www.oberhumer.com/opensource/lzo/download/ target=_blank rel="noopener nofollow noreferrer">download lzo</a></p><p><a href=https://openvpn.net/community-resources/installing-openvpn/ target=_blank rel="noopener nofollow noreferrer">installing-openvpn</a></p><p><a href=http://build.openvpn.net/downloads/releases/ target=_blank rel="noopener nofollow noreferrer">openvpn offical releases</a></p><p><a href=https://github.com/OpenVPN/openvpn/releases target=_blank rel="noopener nofollow noreferrer">openvpn github</a></p></blockquote><p><strong>安装前准备</strong></p><ul><li><p><strong>openvpn支持的平台</strong>：</p><ul><li>Linux kernel 2.6+</li><li>OpenBSD 5.1+</li><li>Mac OS X Darwin 10.5+</li><li>FreeBSD 7.4+</li><li>Windows (WinXP and higher)</li></ul></li><li><p><strong>下载地址</strong>：</p><ul><li><a href=http://build.openvpn.net/downloads/releases/ target=_blank rel="noopener nofollow noreferrer">openvpn-releases</a></li><li><a href=https://github.com/OpenVPN/openvpn/releases target=_blank rel="noopener nofollow noreferrer">openvpn github</a></li></ul></li><li><p><strong>安装openvpn的依赖项</strong>：</p><ul><li>0.9.8版或更高版本的OpenSSL库，对于加密是必需的</li><li>PolarSSL库，是加密的替代版本1.1或更高版本</li><li>LZO实时压缩库，连接压缩所需</li></ul></li></ul><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yum install openssl-devel lzo-devel pam-devel -y</span></span></code></pre></td></tr></table></div></div></div></div><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./configure <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--sbindir<span class=o>=</span>/usr/sbin/
</span></span><span class=line><span class=cl>--sysconfdir<span class=o>=</span>/etc/openvpn/
</span></span><span class=line><span class=cl>--libdir<span class=o>=</span>/usr/lib/
</span></span><span class=line><span class=cl>--includedir<span class=o>=</span>/usr/include/
</span></span><span class=line><span class=cl>--docdir<span class=o>=</span>/usr/doc</span></span></code></pre></td></tr></table></div></div></div></div><p>使用<code>rpmbuild</code>安装：<a href=..%5c..%5cimages%5copenvpn%5copenvpn.spec>openvpn.spec</a></p><h2 id=配置openvpn-server>配置OpenVPN Server<a hidden class=anchor aria-hidden=true href=#配置openvpn-server>#</a></h2><p>openvpn的配配置文件在下面目录中</p><ul><li><p><code>sample/sample-config-files/client.conf</code></p></li><li><p><code>sample/sample-config-files/server.conf</code></p></li></ul><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cp sample-config-files/server.conf /etc/openvpn/</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=建立ca证书>建立CA证书<a hidden class=anchor aria-hidden=true href=#建立ca证书>#</a></h2><p>easy-rsa是一个基于OpenSSL命令行工具的小型RSA密钥管理包。虽然它主要关注SSL VPN应用程序空间的密钥管理，但它也可用于构建Web证书。它最初被包含在OpenVPN中，但现在是一个单独的项目。</p><p>openvpn在2.3-alpha1 -> 2.3-alpha2版本迭代是将easy-rsa分割为单独的子项目。在2.3版本之前easy-rsa包含在openvpn内，在<code>openvpn-2.2.2/easy-rsa/2.0</code>目录下。</p><p>证书也可以使用openssl进行生成，<a href=https://github.com/OpenVPN/easy-rsa target=_blank rel="noopener nofollow noreferrer">easy-rsa</a>可以简化证书生成流程。</p><h3 id=设置并签署第一个请求>设置并签署第一个请求<a hidden class=anchor aria-hidden=true href=#设置并签署第一个请求>#</a></h3><p><code>./easyrsa help [commond]</code> 查看帮助</p><p><code>./easyrsa init-pki</code> 初始化公钥基础设施，（初始化单独的PKI目录）</p><p><code>./easyrsa build-ca nopass</code> 创建ca</p><p><code>./easyrsa gen-req {name} nopass</code> 创建CSR，{name}只是一个名字，不代表任何。</p><p><code>./easyrsa import-req pki/{name}.req</code> 将请求文件<code>.req</code>，导入CA</p><p><code>./easyrsa sign-req {server|client} {name}</code> 签署请求</p><p><code>./easyrsa revoke {name}</code> 吊销证书</p><p><code>./easyrsa gen-dh</code> 生成Diffie-Hellman</p><h2 id=reference-1>Reference<a hidden class=anchor aria-hidden=true href=#reference-1>#</a></h2><blockquote><p><a href=https://github.com/OpenVPN/easy-rsa/blob/master/doc/EasyRSA-Readme.md target=_blank rel="noopener nofollow noreferrer">easyrsa readme</a></p></blockquote><h3 id=easyrsa的配置源>EasyRSA的配置源<a hidden class=anchor aria-hidden=true href=#easyrsa的配置源>#</a></h3><p>在easyrsa生成证书时，需要提供证书的配置，来设置证书对应的详情。此时就需要easyrsa获取外部的配置来替换证书默认的参数。</p><p>easyrsa有四种方式获得外部配置</p><ul><li><p><em><strong>命令行选项</strong></em></p></li><li><p><em><strong>环境变量</strong></em> ：覆盖全局选项</p></li><li><p>env-vars列表，任何设置/覆盖它的（CLI）以及可能的简洁描述如下所示：</p><ul><li><code>EASYRSA</code> easyrsa脚本所在的Easy-RSA顶级目录。</li><li><code>EASYRSA_PKI</code> 保存PKI的文件的目录，默认为<code>$PWD/pki</code>。</li><li><code>EASYRSA_DN</code>：设置为字符串<code>cn_only</code>或<code>org</code>更改要包含在请求DN中的字段</li><li><code>EASYRSA_REQ_COUNTRY</code>：DN国家</li><li><code>EASYRSA_REQ_PROVINCE</code>：DN状态/省</li><li><code>EASYRSA_REQ_CITY</code>：DN城市/位置</li><li><code>EASYRSA_REQ_ORG</code>：DN组织</li><li><code>EASYRSA_REQ_EMAIL</code>：DN电子邮件</li><li><code>EASYRSA_REQ_OU</code>：DN组织单位</li><li><code>EASYRSA_KEY_SIZE</code>：设置密钥大小单位</li><li><code>EASYRSA_ALGO</code>：设置要使用的加密算法：rsa或ec</li><li><code>EASYRSA_CA_EXPIRE</code>：设置CA到期时间</li><li><code>EASYRSA_CERT_EXPIRE</code>：设置已颁发证书的到期时间：单位天</li><li><code>EASYRSA_REQ_CN</code>：默认CN，批量配置时可设置。</li></ul></li><li><p><em><strong>vars 文件</strong></em>：无扩展名的vars文件是为Easy-RSA提供配置的文件，该文件优先级低于环境变量与命令行参数。easyrsa对vars文件的检测顺序为：</p><ul><li><code>--vars</code> 参数引用的文件</li><li>环境变量值<code>EASYRSA_VARS_FILE</code></li><li>环境变量设置的pki目录 <code>EASYRSA_PKI</code></li><li>执行默认目录 <code>$PWD/pki</code></li></ul></li><li><p><em><strong>内部默认值</strong></em></p></li></ul><blockquote><p><strong>生成服务端证书和密钥KEY文件</strong></p></blockquote><p>与上一步类似，其中“Common Name”项需要填写VPN服务器的FQDN，其他均可默认为default值。还会出现：“Sign the certificate? [y/n]”和“1 out of 1 certificate requests certified, commit? [y/n]”。都输入y然后回车，其它可参照如下。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>### 准备生成证书用的CSR相关配置</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>EASYRSA_REQ_COUNTRY</span><span class=o>=</span><span class=s2>&#34;HK&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>EASYRSA_REQ_PROVINCE</span><span class=o>=</span><span class=s2>&#34;HK&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>EASYRSA_REQ_CITY</span><span class=o>=</span><span class=s2>&#34;HongKong&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>EASYRSA_REQ_ORG</span><span class=o>=</span><span class=s2>&#34;china mobile&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>EASYRSA_REQ_EMAIL</span><span class=o>=</span><span class=s2>&#34;10086.chinamobile.cn&#34;</span>
</span></span><span class=line><span class=cl><span class=c1>#证书有效期</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>EASYRSA_CA_EXPIRE</span><span class=o>=</span><span class=m>3650</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>EASYRSA_CERT_EXPIRE</span><span class=o>=</span><span class=m>3650</span>
</span></span><span class=line><span class=cl><span class=c1># 默认cn</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>EASYRSA_REQ_CN</span><span class=o>=</span><span class=s2>&#34;csol&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># 批处理模式</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>EASYRSA_BATCH</span><span class=o>=</span><span class=s2>&#34;enable&#34;</span>
</span></span><span class=line><span class=cl><span class=c1>## 初始化pki</span>
</span></span><span class=line><span class=cl>./easyrsa init-pki
</span></span><span class=line><span class=cl><span class=c1>## 创建CA</span>
</span></span><span class=line><span class=cl>./easyrsa build-ca nopass
</span></span><span class=line><span class=cl><span class=c1>## 申请csr</span>
</span></span><span class=line><span class=cl>./easyrsa gen-req csol nopass
</span></span><span class=line><span class=cl><span class=c1>## 导入csr</span>
</span></span><span class=line><span class=cl>./easyrsa import-req ./pki/reqs/csol.req csol
</span></span><span class=line><span class=cl><span class=c1>## 签发证书</span>
</span></span><span class=line><span class=cl>./easyrsa sign-req server csol</span></span></code></pre></td></tr></table></div></div></div></div><hr><p>注意：easyrsa在执行是也是通过openssl进行，需要<code>openssl-easyrsa.cnf</code> 与 <code>x509-types</code></p><hr><h2 id=加强openvpn安全性>加强OpenVPN安全性<a hidden class=anchor aria-hidden=true href=#加强openvpn安全性>#</a></h2><p><code>TLS-auth</code> 参数增加所有 <code>SSL/TLS</code> 握手了额外的HMAC签名的完整性验证。任何没有正确HMAC签名的UDP数据包都被丢弃，而无需进一步处理。<strong>TLS-AUTH</strong> 可以防止：</p><ul><li>OpenVPN UDP端口上的DDoS攻击或Flood DDoS 。</li><li>端口扫描以确定哪些UDP端口处于侦听状态。</li><li>SSL/TLS缓冲区溢出漏洞。</li><li>切断来自未经授权的机器的<code>SSL/TLS</code>握手。</li></ul><p>生成随机共享密钥（仅适用于非TLS静态密钥加密模式）</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>openvpn --genkey secret ta.key</span></span></code></pre></td></tr></table></div></div></div></div><p>在服务器配置中，添加：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>tls-auth ta.key 0</span></span></code></pre></td></tr></table></div></div></div></div><p>在客户端配置中，添加：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>tls-auth ta.key 1</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=reference-2>Reference<a hidden class=anchor aria-hidden=true href=#reference-2>#</a></h2><blockquote><p><a href=https://openvpn.net/community-resources/hardening-openvpn-security/ target=_blank rel="noopener nofollow noreferrer">openvpn-security</a></p></blockquote><h2 id=调试openvpn服务端>调试OpenVPN服务端<a hidden class=anchor aria-hidden=true href=#调试openvpn服务端>#</a></h2><ol><li><p>取消服务器上防火墙iptables对Openvpn(默认1194)的拦截。以及允许服务进行转发。</p><p>centos7+ firewalld</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>firewall-cmd --add-port<span class=o>=</span>1194/udp  --permanent
</span></span><span class=line><span class=cl>firewall-cmd --permanent --direct --passthrough ipv4 -t nat -A POSTROUTING -s 192.168.100.0/24 -o eth1 -j MASQUERADE</span></span></code></pre></td></tr></table></div></div></div></div><p>iptables</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>iptables -A INPUT -i eth0 -m state --state NEW -p udp --dport 1194 -j ACCEPT
</span></span><span class=line><span class=cl>iptables -t nat -A POSTROUTING -o eth1 -s 192.168.100.0/24 -j MASQUERADE</span></span></code></pre></td></tr></table></div></div></div></div></li><li><p>开启内核转发功能：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>sysctl net.ipv4.ip_forward |grep 1 &gt; /dev/null &amp;&amp; \
</span></span><span class=line><span class=cl>echo net.ipv4.ip_forward=1 &gt;&gt; /etc/sysctl.conf </span></span></code></pre></td></tr></table></div></div></div></div></li><li><p>启动OpenVPN server</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>openvpn --config server.conf</span></span></code></pre></td></tr></table></div></div></div></div></li><li><p>默认情况下，openvpn客户端不能访问客户端上具相同子网的IP的主机。</p></li></ol><h2 id=服务端-serverconf参数详解>服务端 server.conf参数详解<a hidden class=anchor aria-hidden=true href=#服务端-serverconf参数详解>#</a></h2><p>openvpn默认配置文件在 <code>sample/sample-config-files/server.conf</code> 目录下。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#####################################################</span>
</span></span><span class=line><span class=cl><span class=c1># 多客户端服务器的OpenVPN 2.0配置文件示例				   #</span>
</span></span><span class=line><span class=cl><span class=c1>#                                                   #</span>
</span></span><span class=line><span class=cl><span class=c1># 本文件用于多客户端&lt;-&gt;单服务器端的                       #</span>
</span></span><span class=line><span class=cl><span class=c1># OpenVPN服务器端配置                                 #</span>
</span></span><span class=line><span class=cl><span class=c1>#                                                   #</span>
</span></span><span class=line><span class=cl><span class=c1># OpenVPN也支持单机&lt;-&gt;单机的配置                        #</span>
</span></span><span class=line><span class=cl><span class=c1># (在网站上的示例页面更多信息)                       	#</span>
</span></span><span class=line><span class=cl><span class=c1>#                                               	#</span>
</span></span><span class=line><span class=cl><span class=c1># 这个配置可以在Windows或Linux/BSD系统上工作				#</span>
</span></span><span class=line><span class=cl><span class=c1># Windows的路径名需要加双引号并使用双反斜杠 如			 #</span>
</span></span><span class=line><span class=cl><span class=c1># &#34;C:\\Program Files\\OpenVPN\\config\\foo.key&#34;		#</span>
</span></span><span class=line><span class=cl><span class=c1>#                                               	#</span>
</span></span><span class=line><span class=cl><span class=c1># 前面加&#39;#&#39;或&#39;;&#39;的是注释                         	   #</span>
</span></span><span class=line><span class=cl><span class=c1>#####################################################</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># OpenVPN应该监听哪个本地IP地址（可选）</span>
</span></span><span class=line><span class=cl><span class=c1># 如果不设置，默认监听所有IP</span>
</span></span><span class=line><span class=cl><span class=p>;</span><span class=nb>local</span> a.b.c.d
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># OpenVPN应该监听哪个端口(TCP/UDP)</span>
</span></span><span class=line><span class=cl><span class=c1># 如果想在同一台计算机上运行多个OpenVPN实例，可以使用不同的端口号来区分它们</span>
</span></span><span class=line><span class=cl><span class=c1># 在防火墙上打开这个端口</span>
</span></span><span class=line><span class=cl>port <span class=m>1194</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 服务器使用TCP还是UDP协议</span>
</span></span><span class=line><span class=cl><span class=p>;</span>proto tcp
</span></span><span class=line><span class=cl>proto udp
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 指定OpenVPN创建的通信隧道类型</span>
</span></span><span class=line><span class=cl><span class=c1># &#34;dev tun&#34;将会创建一个路由IP隧道</span>
</span></span><span class=line><span class=cl><span class=c1># &#34;dev tap&#34;将会创建一个以太网隧道</span>
</span></span><span class=line><span class=cl><span class=c1># 如果是以太网桥接模式，并且提前创建了一个名为&#34;tap0&#34;的与以太网接口进行桥接的虚拟接口，则你可以使用&#34;dev tap0&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># 如果想控制VPN的访问策略，必须为TUN/TAP接口创建防火墙规则</span>
</span></span><span class=line><span class=cl><span class=c1># 在非Windows系统中，可以给出明确的单位编号，如&#34;tun0&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># 在Windows中，也可以使用&#34;dev-node&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># 在大多数系统上，除非部分或完全禁用了TUN/TAP接口的防火墙，否则VPN将不起作用。</span>
</span></span><span class=line><span class=cl><span class=p>;</span>dev tap
</span></span><span class=line><span class=cl>dev tun
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 如果想配置多个隧道，需要用到网络连接面板中TAP-Win32适配器的名称(如&#34;MyTap&#34;)</span>
</span></span><span class=line><span class=cl><span class=c1># 在XP SP2或更高版本的系统中，可能需要有选择地禁用掉针对TAP适配器的防火墙</span>
</span></span><span class=line><span class=cl><span class=c1># 通常情况下，非Windows系统则不需要该指令。</span>
</span></span><span class=line><span class=cl><span class=p>;</span>dev-node MyTap
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 设置SSL/TLS根证书(ca)、证书(cert)和私钥(key)。</span>
</span></span><span class=line><span class=cl><span class=c1># 每个客户端和服务器端都需要它们各自的证书和私钥文件。</span>
</span></span><span class=line><span class=cl><span class=c1># 服务器端和所有的客户端都将使用相同的CA证书文件。</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># 通过easy-rsa目录下的一系列脚本可以生成所需的证书和私钥。</span>
</span></span><span class=line><span class=cl><span class=c1># 服务器端和每个客户端的证书必须使用唯一的Common Name。</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># 也可以使用遵循X509标准的任何密钥管理系统来生成证书和私钥。</span>
</span></span><span class=line><span class=cl><span class=c1># OpenVPN也支持使用一个PKCS #12格式的密钥文件(详情查看站点手册页面的&#34;pkcs12&#34;指令)</span>
</span></span><span class=line><span class=cl>ca ca.crt
</span></span><span class=line><span class=cl>cert server.crt
</span></span><span class=line><span class=cl>key server.key  <span class=c1># 该文件应该保密</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 迪菲·赫尔曼参数</span>
</span></span><span class=line><span class=cl><span class=c1># 使用如下命令生成：</span>
</span></span><span class=line><span class=cl><span class=c1>#   openssl dhparam -out dh2048.pem 2048</span>
</span></span><span class=line><span class=cl>dh dh2048.pem
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 网络拓扑结构</span>
</span></span><span class=line><span class=cl><span class=c1># 应该为子网(通过IP寻址)</span>
</span></span><span class=line><span class=cl><span class=c1># 除非必须支持Windows客户端v2.0.9及更低版本(net30即每个客户端/30)</span>
</span></span><span class=line><span class=cl><span class=c1># 默认为&#34;net30&#34;(不建议)</span>
</span></span><span class=line><span class=cl><span class=p>;</span>topology subnet
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 设置服务器端模式，并提供一个VPN子网，以从中为客户端分配IP地址</span>
</span></span><span class=line><span class=cl><span class=c1># 本例中服务器端自身占用10.8.0.1，其他的将分配给客户端使用</span>
</span></span><span class=line><span class=cl><span class=c1># 每个客户端将能够通过10.8.0.1访问服务器</span>
</span></span><span class=line><span class=cl><span class=c1># 如果使用的是以太网桥接模式，注释掉本行。更多信息请查看官方手册页面。</span>
</span></span><span class=line><span class=cl>server 10.255.255.255.0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 在此文件中维护客户端与虚拟IP地址之间的关联记录</span>
</span></span><span class=line><span class=cl><span class=c1># 如果OpenVPN重启，重新连接的客户端可以被分配到先前分配的虚拟IP地址</span>
</span></span><span class=line><span class=cl>ifconfig-pool-persist ipp.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 该指令仅针对以太网桥接模式</span>
</span></span><span class=line><span class=cl><span class=c1># 首先，必须使用操作系统的桥接能力将以太网网卡接口和TAP接口进行桥接</span>
</span></span><span class=line><span class=cl><span class=c1># 然后，需要手动设置桥接接口的IP地址、子网掩码，这里假设为10.8.0.4和255.255.255.0</span>
</span></span><span class=line><span class=cl><span class=c1># 最后，必须指定子网的一个IP范围(例如从10.8.0.50开始，到10.8.0.100结束)，以便于分配给连接的客户端</span>
</span></span><span class=line><span class=cl><span class=c1># 如果不是以太网桥接模式，直接注释掉这行指令即可</span>
</span></span><span class=line><span class=cl><span class=p>;</span>server-bridge 10.255.255.2510.8.0.50 10.8.0.100
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 该指令仅针对使用DHCP代理的以太网桥接模式</span>
</span></span><span class=line><span class=cl><span class=c1># 此时客户端将请求服务器端的DHCP服务器，从而获得分配给它的IP地址和DNS服务器地址</span>
</span></span><span class=line><span class=cl><span class=c1># 在此之前，也需要先将以太网网卡接口和TAP接口进行桥接</span>
</span></span><span class=line><span class=cl><span class=c1># 注意：该指令仅用于OpenVPN客户端(如Windows)，并且该客户端的TAP适配器需要绑定到一个DHCP客户端上</span>
</span></span><span class=line><span class=cl><span class=p>;</span>server-bridge
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 推送路由信息到客户端，以允许客户端能够连接到服务器后的其他私有子网</span>
</span></span><span class=line><span class=cl><span class=c1># 即允许客户端访问VPN服务器可访问的其他局域网</span>
</span></span><span class=line><span class=cl><span class=c1># 记住，这些私有子网还需要将OpenVPN客户端地址池（10.8.0.0/255.255.255.0）路由回到OpenVPN服务器</span>
</span></span><span class=line><span class=cl><span class=p>;</span>push <span class=s2>&#34;route 192.168.1255.255.255.0&#34;</span>
</span></span><span class=line><span class=cl><span class=p>;</span>push <span class=s2>&#34;route 192.168.2255.255.255.0&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 要为指定的客户端分配特定的IP地址，或者客户端后的私有子网也要访问VPN</span>
</span></span><span class=line><span class=cl><span class=c1># 可以针对该客户端的配置文件使用ccd子目录</span>
</span></span><span class=line><span class=cl><span class=c1># 请参阅手册页获取更多信息</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 示例1：假设有个Common Name为&#34;Thelonious&#34;的客户端后有一个小型子网也要连接到VPN</span>
</span></span><span class=line><span class=cl><span class=c1># 该子网为192.168.40.128/255.255.255.248</span>
</span></span><span class=line><span class=cl><span class=c1># 首先，去掉下面两行指令的注释：</span>
</span></span><span class=line><span class=cl><span class=p>;</span>client-config-dir ccd
</span></span><span class=line><span class=cl><span class=p>;</span>route 192.168.40.128 255.255.255.248
</span></span><span class=line><span class=cl><span class=c1># 然后创建一个文件ccd/Thelonious，该文件的内容为(没有&#34;#&#34;)：</span>
</span></span><span class=line><span class=cl><span class=c1>#   iroute 192.168.40.128 255.255.255.248</span>
</span></span><span class=line><span class=cl><span class=c1># 客户端所在的子网就可以访问VPN了</span>
</span></span><span class=line><span class=cl><span class=c1># 注意，这个指令只能在基于路由模式而不是基于桥接模式下才能生效</span>
</span></span><span class=line><span class=cl><span class=c1># 比如，你使用了&#34;dev tun&#34;和&#34;server&#34;指令</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 示例1：假设要给Thelonious分配一个固定的IP地址10.9.0.1</span>
</span></span><span class=line><span class=cl><span class=c1># 首先，去掉下面两行指令的注释：</span>
</span></span><span class=line><span class=cl><span class=p>;</span>client-config-dir ccd
</span></span><span class=line><span class=cl><span class=p>;</span>route 10.255.255.255.252
</span></span><span class=line><span class=cl><span class=c1># 然后在文件ccd/Thelonious中添加如下指令(没有&#34;#&#34;)：</span>
</span></span><span class=line><span class=cl><span class=c1>#   ifconfig-push 10.10.9.0.2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 如果想要为不同群组的客户端启用不同的防火墙访问策略，你可以使用如下两种方法：</span>
</span></span><span class=line><span class=cl><span class=c1># (1)运行多个OpenVPN守护进程，每个进程对应一个群组，并为每个进程(群组)启用适当的防火墙规则</span>
</span></span><span class=line><span class=cl><span class=c1># (2)(进阶)创建一个脚本来动态地修改响应于来自不同客户的防火墙规则</span>
</span></span><span class=line><span class=cl><span class=c1># 关于learn-address脚本的更多信息请参考官方手册页面</span>
</span></span><span class=line><span class=cl><span class=p>;</span>learn-address ./script
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 如果启用该行指令，所有客户端的默认网关都将重定向到VPN</span>
</span></span><span class=line><span class=cl><span class=c1># 这将导致诸如web浏览器、DNS查询等所有客户端流量都经过VPN</span>
</span></span><span class=line><span class=cl><span class=c1># (为确保能正常工作，OpenVPN服务器所在计算机可能需要在TUN/TAP接口与以太网之间使用NAT或桥接技术进行连接)</span>
</span></span><span class=line><span class=cl><span class=p>;</span>push <span class=s2>&#34;redirect-gateway def1 bypass-dhcp&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 某些具体的Windows网络设置可以被推送到客户端，例如DNS或WINS服务器地址</span>
</span></span><span class=line><span class=cl><span class=c1># 下列地址来自opendns.com提供的Public DNS服务器</span>
</span></span><span class=line><span class=cl><span class=p>;</span>push <span class=s2>&#34;dhcp-option DNS 208.67.222.222&#34;</span>
</span></span><span class=line><span class=cl><span class=p>;</span>push <span class=s2>&#34;dhcp-option DNS 208.67.220.220&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 去掉该行指令的注释将允许不同的客户端之间互相访问</span>
</span></span><span class=line><span class=cl><span class=c1># 默认情况，客户端只能访问服务器</span>
</span></span><span class=line><span class=cl><span class=c1># 为了确保客户端只能看见服务器，还可以在服务器端的TUN/TAP接口上设置适当的防火墙规则</span>
</span></span><span class=line><span class=cl><span class=p>;</span>client-to-client
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 如果多个客户端可能使用相同的证书/私钥文件或Common Name进行连接，那么可以取消该指令的注释</span>
</span></span><span class=line><span class=cl><span class=c1># 建议该指令仅用于测试目的。对于生产环境使用而言，每个客户端都应该拥有自己的证书和私钥</span>
</span></span><span class=line><span class=cl><span class=c1># 如果没有为每个客户端分别生成Common Name唯一的证书/私钥，可以取消该行的注释(不推荐这样做)</span>
</span></span><span class=line><span class=cl><span class=p>;</span>duplicate-cn
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># keepalive指令将导致类似于ping命令的消息被来回发送，以便于服务器端和客户端知道对方何时被关闭</span>
</span></span><span class=line><span class=cl><span class=c1># 每10秒钟ping一次，如果120秒内都没有收到对方的回复，则表示远程连接已经关闭</span>
</span></span><span class=line><span class=cl>keepalive <span class=m>10</span> <span class=m>120</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 出于SSL/TLS之外更多的安全考虑，创建一个&#34;HMAC 防火墙&#34;可以帮助抵御DoS攻击和UDP端口淹没攻击</span>
</span></span><span class=line><span class=cl><span class=c1># 可以使用以下命令来生成：</span>
</span></span><span class=line><span class=cl><span class=c1>#   openvpn --genkey --secret ta.key</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># 服务器和每个客户端都需要拥有该密钥的一个拷贝</span>
</span></span><span class=line><span class=cl><span class=c1># 第二个参数在服务器端应该为&#39;0&#39;，在客户端应该为&#39;1&#39;</span>
</span></span><span class=line><span class=cl>tls-auth ta.key <span class=m>0</span>  <span class=c1># 该文件应该保密</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 选择一个密码加密算法，该配置项也必须复制到每个客户端配置文件中</span>
</span></span><span class=line><span class=cl><span class=c1># 注意，v2.4客户端/服务器将自动以TLS模式协商AES-256-GCM，请参阅手册中的ncp-cipher选项</span>
</span></span><span class=line><span class=cl>cipher AES-256-CBC
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 在VPN链接上启用压缩并将选项推送到客户端（仅适用于v+，对于早期版本，请参阅下文）</span>
</span></span><span class=line><span class=cl><span class=p>;</span>compress lz4-v2
</span></span><span class=line><span class=cl><span class=p>;</span>push <span class=s2>&#34;compress lz4-v2&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 对于与旧客户端兼容的压缩，使用comp-lzo</span>
</span></span><span class=line><span class=cl><span class=c1># 如果在此启用，还必须在客户端配置文件中启用它</span>
</span></span><span class=line><span class=cl><span class=p>;</span>comp-lzo
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 允许并发连接的客户端的最大数量</span>
</span></span><span class=line><span class=cl><span class=p>;</span>max-clients <span class=m>100</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 初始化后减少OpenVPN守护进程的权限是一个好主意</span>
</span></span><span class=line><span class=cl><span class=c1># 该指令仅限于非Windows系统中使用</span>
</span></span><span class=line><span class=cl><span class=p>;</span>user nobody
</span></span><span class=line><span class=cl><span class=p>;</span>group nobody
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 持久化选项可以尽量避免访问那些在重启之后由于用户权限降低而无法访问的某些资源</span>
</span></span><span class=line><span class=cl>persist-key
</span></span><span class=line><span class=cl>persist-tun
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 输出一个简短的状态文件，用于显示当前的连接状态，该文件每分钟都会清空并重写一次</span>
</span></span><span class=line><span class=cl>status openvpn-status.log
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 默认情况下，日志消息将写入syslog(在Windows系统中，如果以服务方式运行，日志消息将写入OpenVPN安装目录的log文件夹中)</span>
</span></span><span class=line><span class=cl><span class=c1># 可以使用log或者log-append来改变这种默认设置</span>
</span></span><span class=line><span class=cl><span class=c1># &#34;log&#34;方式在每次启动时都会清空之前的日志文件</span>
</span></span><span class=line><span class=cl><span class=c1># &#34;log-append&#34;是在之前的日志内容后进行追加</span>
</span></span><span class=line><span class=cl><span class=c1># 你可以使用两种方式之一(不要同时使用)</span>
</span></span><span class=line><span class=cl><span class=p>;</span>log         openvpn.log
</span></span><span class=line><span class=cl><span class=p>;</span>log-append  openvpn.log
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 为日志文件设置适当的冗余级别(0~9)</span>
</span></span><span class=line><span class=cl><span class=c1># 冗余级别越高，输出的信息越详细</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># 0 表示静默运行，只记录致命错误</span>
</span></span><span class=line><span class=cl><span class=c1># 4 表示合理的常规用法</span>
</span></span><span class=line><span class=cl><span class=c1># 5和6 可以帮助调试连接错误</span>
</span></span><span class=line><span class=cl><span class=c1># 9 表示极度冗余，输出非常详细的日志信息</span>
</span></span><span class=line><span class=cl>verb <span class=m>3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 忽略过多的重复信息</span>
</span></span><span class=line><span class=cl><span class=c1># 相同类别的信息只有前20条会输出到日志文件中</span>
</span></span><span class=line><span class=cl><span class=p>;</span>mute <span class=m>20</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 通知客户端，当服务器重新启动时，可以自动重新连接</span>
</span></span><span class=line><span class=cl><span class=c1># 只能是UDP协议使用，TCP使用的话不能启动服务</span>
</span></span><span class=line><span class=cl>explicit-exit-notify <span class=m>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># （如果不添加该指令则）默认值3600，也就是一个小时进行一次TSL重新协商</span>
</span></span><span class=line><span class=cl><span class=c1># 这个参数在服务端和客户端设置都有效</span>
</span></span><span class=line><span class=cl><span class=c1># 如果两边都设置了，就按照时间短的设定优先</span>
</span></span><span class=line><span class=cl><span class=c1># 当两边同时设置成0，表示禁用TSL重协商。使用OTP认证需要禁用</span>
</span></span><span class=line><span class=cl>reneg-sec <span class=m>0</span></span></span></code></pre></td></tr></table></div></div></div></div><p>可用的服务端配置</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>local 10.0.0.4
port 1194
proto udp
dev tun
ca ca.crt
cert server.crt
key server.key
dh dh2048.pem
# 分配给客户端的地址池，与dhcp类似
server 192.168.10255.255.255.0
ifconfig-pool-persist ipp.txt

push &#34;route 192.168.10255.255.255.0&#34;
client-to-client
duplicate-cn
keepalive 10 120
comp-lzo
max-clients 100
persist-key
persist-tun
log-append  /var/log/openvpn.log
verb 3
mute 20
explicit-exit-notify 1
reneg-sec 360
tls-auth ta.key 0</code></pre></div></div><h2 id=相关证书文件说明>相关证书文件说明<a hidden class=anchor aria-hidden=true href=#相关证书文件说明>#</a></h2><table><thead><tr><th>文件名</th><th>需要使用者</th><th>目的</th><th>默认是否加密</th></tr></thead><tbody><tr><td>ca.crt</td><td>server + all clients</td><td>Root CA certificate</td><td>NO</td></tr><tr><td>ca.key</td><td>key signing machine only</td><td>Root CA key</td><td>YES</td></tr><tr><td>dh{n}.pem</td><td>server only</td><td>Diffie Hellman parameters</td><td>NO</td></tr><tr><td>server.crt</td><td>server only</td><td>Server Certificate</td><td>NO</td></tr><tr><td>server.key</td><td>server only</td><td>Server Key</td><td>YES</td></tr><tr><td>client1.crt</td><td>client1 only</td><td>Client1 Certificate</td><td>NO</td></tr><tr><td>client1.key</td><td>client1 only</td><td>Client1 Key</td><td>YES</td></tr></tbody></table><p>reference <a href=https://openvpn.net/community-resources/how-to/#openvpn-quickstart target=_blank rel="noopener nofollow noreferrer">explanation of the relevant files</a></p><h2 id=openvpn客户端配置使用>OpenVPN客户端配置使用<a hidden class=anchor aria-hidden=true href=#openvpn客户端配置使用>#</a></h2><h3 id=下载并安装openvpn客户端>下载并安装openvpn客户端<a hidden class=anchor aria-hidden=true href=#下载并安装openvpn客户端>#</a></h3><p>在windows上需要下载与Server版本一致的带有GUI的Windows端。下载地址：<a href=https://openvpn.net/community-downloads/ target=_blank rel="noopener nofollow noreferrer">community</a></p><h3 id=配置并下载客户端证书>配置并下载客户端证书<a hidden class=anchor aria-hidden=true href=#配置并下载客户端证书>#</a></h3><p><strong>生成客户端证书和key文件</strong></p><p>生成client证书和key文件。若建立多个客户证书，则重复如下步骤即可.只需修改Common Name项oldboy的名称。</p><p>在OpenVPN中，这种配置方法是每一个登陆的VPN客户端需要有一个证书，每个证书在同一时刻只能供一个客户端连接（如果有两个机器安装相同证书，同时拨服务器，都能拨上，但是只有第一个拨上的才能连通网络）。所以，如果有多个人，每个人需要建立一份证书。</p><p>将ca.crt、redis.crt、redis.key复制到OpenVPN\config。（不同用户使用不同的证书，每个证书包括.crt和.key两个文件。如test.crt和test.key)</p><p>在 <code>sample-config-files/client.conf</code>的基础上建立客户端配置文件，改名为client.oven，即先在服务器上建立配置文件，然后再下载改名到客户机上。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>client
</span></span><span class=line><span class=cl>dev tun
</span></span><span class=line><span class=cl>proto udp
</span></span><span class=line><span class=cl>remote 10.1194
</span></span><span class=line><span class=cl>nobind
</span></span><span class=line><span class=cl>resolv-retry infinite
</span></span><span class=line><span class=cl>persist-key
</span></span><span class=line><span class=cl>persist-tun
</span></span><span class=line><span class=cl>mute-replay-warnings
</span></span><span class=line><span class=cl>cipher AES-256-CBC
</span></span><span class=line><span class=cl>comp-lzo
</span></span><span class=line><span class=cl>verb <span class=m>3</span>
</span></span><span class=line><span class=cl>ca ca.crt
</span></span><span class=line><span class=cl>cert test.crt
</span></span><span class=line><span class=cl>key test.key
</span></span><span class=line><span class=cl>tls-auth ta.key <span class=m>1</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=客户端远程连接openvpn服务>客户端远程连接OpenVPN服务<a hidden class=anchor aria-hidden=true href=#客户端远程连接openvpn服务>#</a></h3><p>当配置文件的扩展名为<code>.ovpn</code>，配置文件存放至客户端配置的目录中。ca、证书 与配置文件放置同一个文件夹内。每一组为一个用户。</p><p>连接成功后如图所示：</p><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221024215346067.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221024215346067.png#center alt=image-20221024215346067 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><h2 id=reference-3>Reference<a hidden class=anchor aria-hidden=true href=#reference-3>#</a></h2><ul><li><p><a href=https://blog.dianduidian.com/post/openvpn-server%E6%90%AD%E5%BB%BA%E5%B9%B6%E4%BD%BF%E7%94%A8%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AF%81%E4%B9%A6%E8%AE%A4%E8%AF%81/ target=_blank rel="noopener nofollow noreferrer">证书认证</a></p></li><li><p><a href=http://blog.joylau.cn/2020/05/28/OpenVPN-Config/#21-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6 target=_blank rel="noopener nofollow noreferrer">openvpn配置文件说明</a></p></li><li><p><a href=https://sexywp.com/use-easyrsa-create-self-signed-cert.htm#%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85_EasyRSA target=_blank rel="noopener nofollow noreferrer">easyrsa签发证书</a></p></li></ul></div><div class=pe-copyright><hr><blockquote><p>本文为原创内容，版权归作者所有。如需转载，请在文章中声明本文标题及链接。</p><p>文章标题：ch2 从零开始安装OpenVPN</p><p>文章链接：<a href=https://www.oomkill.com/2019/11/ch2-install-and-configuration/ target=_blank>https://www.oomkill.com/2019/11/ch2-install-and-configuration/</a></p><p>许可协议：<a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></p></blockquote></div><div class=comments-separator></div><h3 class=relatedContentTitle>相关阅读</h3><ul class=relatedContent><li><a href=/2019/11/ch1-introduction/><span>ch1 VPN与OpenVPN应用场景分析</span></a></li><li><a href=/2019/11/ch3-high-availability/><span>ch3 OpenVPN的高可用配置</span></a></li><li><a href=/2019/11/ch4-authentication/><span>ch4 OpenVPN的统一身份认证方案及实现方法</span></a></li></ul><div class=comments-separator></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.oomkill.com/tags/vpn/>VPN</a></li></ul><nav class=paginav><a class=prev href=https://www.oomkill.com/2019/11/ch1-introduction/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></polyline></svg>&nbsp;</span>
<span>ch1 VPN与OpenVPN应用场景分析</span>
</a><a class=next href=https://www.oomkill.com/2019/11/ch3-high-availability/><span class=title></span>
<span>ch3 OpenVPN的高可用配置&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span></a></nav></footer><div class=pe-comments-decoration><p class=pe-comments-title></p><p class=pe-comments-subtitle></p></div><div id=pe-comments></div><script src=/js/pe-go-comment.min.86a214102576ba5f9b7bdc29eed8d58dd56e34aef80b3c65c73ea9cc88443696.js integrity="sha256-hqIUECV2ul+be9wp7tjVjdVuNK74Czxlxz6pzIhENpY="></script><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const s={src:"https://giscus.app/client.js","data-repo":"cylonchau/cylonchau.github.io","data-repo-id":"R_kgDOIRlNSQ","data-category":"Announcements","data-category-id":"DIC_kwDOIRlNSc4CXy1U","data-mapping":"pathname","data-term":"posts/ch2 install and configuration","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"top","data-theme":getStoredTheme(),"data-lang":"zh-TW","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(s).forEach(([t,n])=>e.setAttribute(t,n)),document.querySelector("#pe-comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme);const n=document.querySelector("#theme-toggle-float");n&&n.addEventListener("click",setGiscusTheme)})</script></article></main><footer class=footer><span>&copy; 2024 <a href=https://www.oomkill.com/>Cylon's Collection</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> on
<a href=https://pages.github.com/ rel=noopener target=_blank>GitHub Pages</a> & Theme
        <a href=https://github.com/tofuwine/PaperMod-PE rel=noopener target=_blank>PaperMod-PE</a></span></footer><div class=pe-right-sidebar><a href=javascript:void(0); id=theme-toggle-float class=pe-float-btn><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a href=#top class=pe-float-btn id=top-link><span id=pe-read-progress></span></a></div><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>