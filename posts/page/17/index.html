<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Posts | Cylon's Collection</title>
<meta name=keywords content><meta name=description content="Posts - Cylon's Collection"><meta name=author content="cylon"><link rel=canonical href=https://www.oomkill.com/posts/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://www.oomkill.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.oomkill.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.oomkill.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.oomkill.com/favicon.ico><link rel=mask-icon href=https://www.oomkill.com/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://www.oomkill.com/posts/index.xml><link rel=alternate hreflang=zh href=https://www.oomkill.com/posts/><noscript><style>#theme-toggle,#top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link crossorigin=anonymous href=/assets/css/pe.min.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/pe.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/all.min.css><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/v4-shims.min.css><script id=MathJax-script async src=https://cdn.staticfile.net/mathjax/3.2.2/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["$$","$$"]],inlineMath:[["\\$","\\$"]]}}</script><meta property="og:title" content="Posts"><meta property="og:description" content="ExampleSite description"><meta property="og:type" content="website"><meta property="og:url" content="https://www.oomkill.com/posts/"><meta property="og:site_name" content="Cylon's Collection"><meta name=twitter:card content="summary"><meta name=twitter:title content="Posts"><meta name=twitter:description content="ExampleSite description"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.oomkill.com/posts/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.oomkill.com/><img src=https://www.oomkill.com/favicon.ico alt aria-label=logo height=20>Cylon's Collection</a><div class=logo-switches><button id=theme-toggle><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.oomkill.com/archives><span>å½’æ¡£</span></a></li><li><a href=https://www.oomkill.com/tags><span>æ ‡ç­¾</span></a></li><li><a href=https://www.oomkill.com/search><span>æœç´¢</span></a></li><li><a href=https://www.oomkill.com/about accesskey=/><span>å…³äº</span></a></li></ul></nav></header><main class=main><link crossorigin=anonymous href=/css/pe/posts.min.a1b2ca75ff9fb44ed04c20845a9aeb69486b6e2b9040fd157a3903be2a241539.css integrity="sha256-obLKdf+ftE7QTCCEWprraUhrbiuQQP0VejkDviokFTk=" rel="preload stylesheet" as=style><header class=page-header></header><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>çº¢ç±³æ‰‹æœºå®‰è£… Pixel Experience</h2></header><div class=entry-content><p>å‰è¨€ MIUI13 çŸ³é”¤äº†å†…ç½®åè¯ˆAPPåï¼Œæˆ‘çš„æ˜¯MIUI12, æ¥åˆ°å…¬å®‰çš„ç§äººç”µè¯ï¼Œç³»ç»Ÿç›´æ¥å¼¹å‡ºå›½å®¶åè¯ˆçš„å¼¹çª—ï¼Œå…³é”®æˆ‘æ˜¯å°åº¦ç‰ˆçš„Romï¼Œä¸€èº«å†·æ±—ï¼Œä¼°è®¡å½“å±€å®¡æŸ¥æ˜¯é€šè¿‡ç³»ç»Ÿç»„ä»¶æ›´æ–°äº†ï¼Œç›´æ¥è£…Pixel Experienceï¼Œä»¥åæ¢è®¾å¤‡æ°¸è¿œä¸æ¢æœ€æ–°çš„ï¼Œè®©ç½‘å‹ä»¬è¸©å‘å§
æ³¨ï¼šéšç§æ˜¯ä¸€ç§æƒåˆ©ï¼Œç”µä¿¡è¯ˆéª—è¯·é—® éª—å­æ€ä¹ˆçŸ¥é“æˆ‘çš„é‡‘èä¿¡æ¯ï¼Œæ€ä¹ˆçŸ¥é“æˆ‘çš„å‡ºå…¥å¢ƒä¿¡æ¯ã€‚ä¸Šæµ·å…¬å®‰10äº¿ä¿¡æ¯æ³„éœ²æ˜¯æ€ä¹ˆæƒ…å†µï¼Œå½“å…¬æƒåŠ›æ— æ³•ä¿è¯ç”¨æˆ·éšç§æ—¶ï¼Œè¯·ä¸è¦å®ååˆ¶ï¼Œå‚è€ƒéŸ©å›½ã€‚éšç§æƒå‚è€ƒæ¬§æ´²
æ“ä½œ è¿›å…¥fastboot(power button + volume button up)ï¼Œç„¶åä½¿ç”¨æ•°æ®çº¿è¿æ¥è‡³PC(windows),ç„¶åä¸‹è½½MiFlash é¦–æ¬¡å¼¹å‡ºæ—¶éœ€è¦å®‰è£…é©±åŠ¨ï¼Œä»¥ä¾¿PCå¯ä»¥è¯†åˆ«åˆ°æ‰‹æœº
ç»™æ‰‹æœºå®‰è£…TWRP [1]ï¼Œé€šè¿‡æœç´¢æ‰¾åˆ°ä½ çš„æ‰‹æœºå‹å· ä¾‹å¦‚ Redmi Note5ã€‚(å¯ä»¥å»å°ç±³ROMç½‘ä¸Šå¯¹ç…§ä¸‹ä½ çš„æ‰‹æœºä»£å·æ—¶ä»€ä¹ˆä¾‹å¦‚ Note7 Pro ä»£å·ä¸º ç´«ç½—å…° violet)
åœ¨ä¸‹è½½æ—¶TWRPç½‘ç«™ä¸Šä¼šæç¤ºä½ å…ˆå®‰è£… Play Stroe(è¿™æ˜¯åŒ…å«äº†adb fastbootç­‰å·¥å…·çš„å·¥å…·åŒ…ï¼Œæœ‰çš„è¯å¯ä»¥ä¸è£…) å®‰è£…æ­¥éª¤å¯ä»¥å‚è€ƒ [2]
é€‰æ‹© Wipe â€“ Advance Wipe â€“ é€‰ä¸Š System, Data, Dalvik, Cache å››ä¸ªæ“¦é™¤
ä¸‹è½½ firmware ä¸ PixelExperience
å» https://download.pixelexperience.org/ ä¸‹è½½ PixelExperience æ‰¾åˆ°è‡ªå·±çš„æ‰‹æœºå‹å·ï¼Œå‚è€ƒ1 å» https://xiaomifirmwareupdater.com/firmware/ ä¸‹è½½ fireware æ‰¾åˆ°è‡ªå·±çš„æ‰‹æœºå‹å·ï¼Œå‚è€ƒ1 æ³¨ï¼šå»ºè®®ç›´æ¥æœä»£å·å¦‚violetï¼Œæœå‹å·å¤ªå¤šä¸å¥½æ‰¾ å‘æ‰‹æœºå¤åˆ¶ firmware [3] å’Œå›ºä»¶
fw_violet_miui_VIOLET_9.9.3_79d3ccd33b_9.0.zip PixelExperience_violet-10.0-20191021-1744-BETA-OFFICIAL.zip å¤åˆ¶å‘½ä»¤å‚è€ƒ [10] æŒ‰å…ˆåé¡ºåºå®‰è£…åï¼Œé‡å¯å°±å®‰è£…å¥½google pixel experienceäº† enjoy ğŸ¤...</p></div><footer class=entry-footer><span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2023-02-25</span></span>&nbsp;Â·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg><span>170 å­—</span></span>&nbsp;Â·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>1 åˆ†é’Ÿ</span></span></footer><a class=entry-link aria-label="post link to çº¢ç±³æ‰‹æœºå®‰è£… Pixel Experience" href=https://www.oomkill.com/2023/02/xiaomi-install-pixelexperience/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>æ·±å…¥ç†è§£Kubernetes service - å¦‚ä½•æ‰©å±•ç°æœ‰çš„kube-proxyæ¶æ„ï¼Ÿ</h2></header><div class=entry-content><p>æœ¬æ–‡æ˜¯å…³äºKubernetes serviceè§£æçš„ç¬¬å››ç« 
æ·±å…¥ç†è§£Kubernetes service - ä½ çœŸçš„ç†è§£serviceå—? æ·±å…¥ç†è§£Kubernetes service - EndpointSlicesåšäº†ä»€ä¹ˆï¼Ÿ æ·±å…¥ç†è§£Kubernetes service - kube-proxyæ¶æ„åˆ†æ æ·±å…¥ç†è§£Kubernetes service - å¦‚ä½•æ‰©å±•ç°æœ‰çš„kube-proxyæ¶æ„ï¼Ÿ æ‰€æœ‰å…³äºKubernetes service éƒ¨åˆ†ä»£ç ä¸Šä¼ è‡³ä»“åº“ github.com/cylonchau/kube-haproxy
Overview åœ¨å‰ä¸¤éƒ¨åˆ†ä¸­ï¼Œå­¦ä¹ äº†ä¸€äº› service,äºkube-proxyåœ¨è®¾è®¡æ¶æ„ï¼Œä½†å­˜åœ¨æ‰©å±•é—®é¢˜å°†å¼•å…¥äº†ä¸€äº›é—®é¢˜ï¼š
ä¸ºä»€ä¹ˆéœ€è¦äº†è§£è¿™éƒ¨åˆ†å†…å®¹å‘¢ï¼Ÿ ä¸ä¼ ç»Ÿæ¶æ„æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ äºeBPF çš„ ciliumåˆæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ æ—¢ç„¶eBPFå¯ä»¥åšåˆ°ï¼Œé‚£ä¸ºä»€ä¹ˆè¦è¿™éƒ¨åˆ†å†…å®¹å‘¢ï¼Ÿ æ¥ä¸‹æ¥çš„å†…å®¹å°†å›´ç»•è¿™å››ä¸ªé—®é¢˜å±•å¼€æ¥è®²ï¼Œè€Œä¸æ˜¯ä»£ç çš„è®²è§£ï¼Œä»£ç å¯ä»¥çœ‹ç½®é¡¶
IPVSä¸iptablesåœ¨kubernetesä¸­åº”ç”¨æ—¶çš„é—®é¢˜ å¯¹äºåœ¨ä½¿ç”¨äº†kubernetesç”¨æˆ·ä»¥åŠäº†è§£ kube-proxy æ¶æ„åï¼ŒçŸ¥é“å½“é›†ç¾¤è§„æ¨¡è¿‡å¤§æ—¶ï¼Œserviceå¿…å°†å¢å¤šï¼Œè€Œä¸€ä¸ªserviceæœªå¿…æ˜¯ä¸€æ¡iptables/ipvsè§„åˆ™ï¼Œå¯¹äºkubernetesè¿™ç§åˆ†å¸ƒå¼æ¶æ„æ¥è¯´ï¼Œé›†ç¾¤è§„æ¨¡è¶Šå¤§ï¼Œé›†ç¾¤çŠ¶æ€å°±è¶Šä¸å¯æ§ï¼Œå°¤å…¶æ—¶kube-proxyã€‚
ä¸ºä»€ä¹ˆå•æŒ‡kube-proxyå‘¢ï¼Ÿæƒ³æƒ³å¯ä»¥çŸ¥é“ï¼Œpodçš„æ•…éšœ æˆ– node çš„æ•…éšœå¯¹äºkubernetesé›†ç¾¤æ¥è¯´å´ä¸æ˜¯è‡´å‘½çš„ï¼Œå› ä¸º è¿™äº›èµ„æºé›†ç¾¤ä¸­å­˜åœ¨ é¿å…æ–¹æ¡ˆï¼Œä¾‹å¦‚Podçš„é©±é€ã€‚è€Œkube-proxyæˆ–iptables/IPVSé—®é¢˜å°†å¯¼è‡´æœåŠ¡çš„ä¸å¯æ§ ã€æŠ–åŠ¨ã€ä¾‹å¦‚è§„åˆ™ç”Ÿæˆçš„å¿«æ…¢å’ŒPodå°±ç»ªçš„å¿«æ…¢ä¸ä¸€è‡´ï¼Œéƒ¨åˆ†èŠ‚ç‚¹ä¸å­˜åœ¨ service æ­¤æ—¶æœåŠ¡å¿…ç„¶æŠ–åŠ¨ã€‚
å†ä¾‹å¦‚ iptables/IPVS æ’æŸ¥çš„éš¾åº¦å¯¹äºæ™®é€šè¿ç»´å·¥ç¨‹å¸ˆæˆ–å¼€å‘å·¥ç¨‹å¸ˆçš„æŠ€æœ¯æ°´å¹³æœ‰å¾ˆé«˜çš„è¦æ±‚ï¼Œç½‘ä¸Šéšå¤„å¯è§åˆ†æè¯¥ç±»é—®é¢˜çš„å¸–å­ï¼š
kube-proxyæºç åˆ†æä¸é—®é¢˜å®šä½
æ¡ˆä¾‹åˆ†æï¼šæ€ä¹ˆè§£å†³æµ·é‡IPVSè§„åˆ™å¸¦æ¥çš„ç½‘ç»œå»¶æ—¶æŠ–åŠ¨é—®é¢˜ï¼Ÿ
ipvs è¿æ¥å¤ç”¨å¼•å‘çš„ç³»åˆ—é—®é¢˜
Investigating Causes of Jitter in Container Networking
ContainerNative network LoadBalancer IPVS jitter
å¯¹äºä¸Šè¿°é—®é¢˜ï¼Œç›¸ä¿¡é‡åˆ°äº†å¾ˆéš¾å®šä½å¤„ç†ï¼Œè™½ç„¶ç°åœ¨å·²fixedï¼Œå¹¶æœ‰eBPFæŠ€æœ¯çš„åŠ å…¥å‡å°‘äº†æ­¤ç±»é—®é¢˜çš„å‘ç”Ÿï¼Œä½†æ˜¯eBPFå®é™…åŒç†äºIPVS éƒ½æ˜¯éœ€è¦å¯¹Linuxå†…æ ¸æœ‰ä¸€å®šäº†è§£åæ‰å¯ä»¥ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆéœ€è¦äº†è§£è¿™éƒ¨åˆ†
å¦‚æœéœ€è¦è‡ªå®šä¹‰proxierä¸ºä»€ä¹ˆä¼šè§£å†³è¿™ä¸ªé—®é¢˜ è¿™é‡Œå°±æ˜¯æ”¾å¤§åˆ°kubernetesæ„å¤–çš„ä¼ ç»Ÿæ¶æ„ä¸­ï¼Œå½“ç›´æ¥éƒ¨ç½²äºLinuxç³»ç»Ÿä¸Šä½¿ç”¨nginxç­‰ä¼ ç»ŸLBæ—¶å°±å¾ˆå°‘æœ‰äººæåˆ°è¿™äº›é—®é¢˜äº†ï¼Œè€Œè¿™äº›é—®é¢˜å­˜åœ¨ä¸€ä¸ªå…³é”®å­—ã€ŒContainerã€ï¼›è€Œå¼•å‘è¿™ä¸ªé—®é¢˜çš„åˆ™æ˜¯ serviceã€‚å»é™¤ service çš„åŠŸèƒ½ï¼Œä¼ ç»Ÿæ¶æ„äºKubernetesæ¶æ„éƒ¨ç½²çš„åº”ç”¨åˆ™æ˜¯ç›¸åŒçš„ï¼Œåªæ˜¯åŒºåˆ†äº†åç§°ç©ºé—´ã€‚...</p></div><footer class=entry-footer><span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2023-02-12</span></span>&nbsp;Â·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg><span>261 å­—</span></span>&nbsp;Â·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>2 åˆ†é’Ÿ</span></span></footer><a class=entry-link aria-label="post link to æ·±å…¥ç†è§£Kubernetes service - å¦‚ä½•æ‰©å±•ç°æœ‰çš„kube-proxyæ¶æ„ï¼Ÿ" href=https://www.oomkill.com/2023/02/ch23-extend-kube-proxy/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>æ·±å…¥ç†è§£Kubernetes service - ä½ çœŸçš„ç†è§£serviceå—ï¼Ÿ</h2></header><div class=entry-content><p>æœ¬æ–‡æ˜¯å…³äºKubernetes serviceè§£æçš„ç¬¬ä¸€ç« 
æ·±å…¥ç†è§£Kubernetes service - ä½ çœŸçš„ç†è§£serviceå—? æ·±å…¥ç†è§£Kubernetes service - EndpointSlicesåšäº†ä»€ä¹ˆï¼Ÿ æ·±å…¥ç†è§£Kubernetes service - kube-proxyæ¶æ„åˆ†æ æ·±å…¥ç†è§£Kubernetes service - å¦‚ä½•æ‰©å±•ç°æœ‰çš„kube-proxyæ¶æ„ æ‰€æœ‰å…³äºKubernetes service éƒ¨åˆ†ä»£ç ä¸Šä¼ è‡³ä»“åº“ github.com/cylonchau/kube-haproxy
å‰æ™¯ å¯¹äºäº†è§£kubernetesæ¶æ„æ—¶ï¼Œå·²çŸ¥çš„æ˜¯ service æ˜¯kubernetesåœ¨è®¾è®¡æ—¶ä¸ºäº†é¿å…Podåœ¨é¢‘ç¹åˆ›å»ºå’Œé”€æ¯æ—¶IPå˜æ›´é—®é¢˜ï¼Œä»è€Œç»™é›†ç¾¤å†…æœåŠ¡ï¼ˆä¸€ç»„Podï¼‰æä¾›è®¿é—®çš„ä¸€ä¸ªå…¥å£ã€‚è€ŒPodåœ¨è¿™é‡Œçš„è§’è‰²æ˜¯ ã€åç«¯ã€( backend ) ï¼Œè€Œ service çš„è§’è‰²æ˜¯ ã€å‰ç«¯ã€( frontend )ã€‚æœ¬æ–‡å°†é˜è¿°serviceçš„ç”Ÿå‘½å‘¨æœŸ
ä¸ºä»€ä¹ˆéœ€è¦äº†è§£è¿™éƒ¨åˆ†å†…å®¹å‘¢ å¯¹äº without kube-proxyæ¥è¯´ï¼Œè¿™éƒ¨åˆ†æ˜¯æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œå› ä¸ºserviceçš„ç”Ÿæˆä¸æ˜¯kube-proxyæ¥å®Œæˆçš„ï¼Œè€Œè¿™éƒ¨åˆ†ä¹Ÿå°±æ˜¯service ipå®šä¹‰çš„æ ¸å¿ƒã€‚
æ§åˆ¶å™¨ serviceçš„èµ„æºåˆ›å»ºå¾ˆå¥‡å¦™ï¼Œç»§ä¸å±äº controller-manager ç»„ä»¶ï¼Œä¹Ÿä¸å±äº kube-proxy ç»„ä»¶ï¼Œè€Œæ˜¯å­˜åœ¨äº apiserver ä¸­çš„ä¸€ä¸ªè¢«æˆä¸ºæ§åˆ¶å™¨çš„ç»„ä»¶ï¼›è€Œè¿™ä¸ªæ§åˆ¶å™¨åˆåŒºåˆ«äºå‡†å…¥æ§åˆ¶å™¨ã€‚æ›´å‡†ç¡®æ¥è¯´ï¼Œå‡†å…¥æ§åˆ¶å™¨æ˜¯ä½äºkubeapiserverä¸­çš„ç»„ä»¶ï¼Œè€Œ æ§åˆ¶å™¨ åˆ™æ˜¯å­˜åœ¨äºå•ç‹¬çš„ä¸€ä¸ªåŒ…ï¼Œè¿™é‡ŒåŒ…å«äº†å¾ˆå¤škubernetesé›†ç¾¤çš„å…¬å…±ç»„ä»¶çš„åŠŸèƒ½ï¼Œå…¶ä¸­å°±æœ‰serviceã€‚è¿™ä¹Ÿå°±æ˜¯åœ¨æ“ä½œkubernetesæ—¶ å½“ controller-manager äº kube-proxy æœªå·¥ä½œæ—¶ï¼Œä¹Ÿå¯ä»¥å‡†ç¡®çš„ä¸ºserviceåˆ†é…IPã€‚
é¦–å…ˆåœ¨æ„å»ºå‡ºapiserveræ—¶ï¼Œä¹Ÿå°±æ˜¯ä»£ç  cmd/kube-apiserver/app/server.go
go 1 2 3 4 serviceIPRange, apiServerServiceIP, err := master.ServiceIPRange(s.PrimaryServiceClusterIPRange) if err !...</p></div><footer class=entry-footer><span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2023-02-06</span></span>&nbsp;Â·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg><span>235 å­—</span></span>&nbsp;Â·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>2 åˆ†é’Ÿ</span></span></footer><a class=entry-link aria-label="post link to æ·±å…¥ç†è§£Kubernetes service - ä½ çœŸçš„ç†è§£serviceå—ï¼Ÿ" href=https://www.oomkill.com/2023/02/ch17-service-controller/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>æ·±å…¥ç†è§£Kubernetes service - kube-proxyæ¶æ„åˆ†æ</h2></header><div class=entry-content><p>å‰ææ¦‚è¿° kubernetesé›†ç¾¤ä¸­è¿è¡Œåœ¨æ¯ä¸ªWorkerèŠ‚ç‚¹ä¸Šçš„ç»„ä»¶ kube-proxyï¼Œæœ¬æ–‡è®²è§£çš„æ˜¯å¦‚ä½•å¿«é€Ÿçš„äº†è§£ kube-proxy çš„è½¯ä»¶æ¶æ„ï¼Œè€Œä¸æ˜¯æµç¨‹çš„åˆ†æï¼Œä¸“æ³¨äº proxy å±‚é¢çš„è®¾è®¡è®²è§£ï¼Œè€Œä¸ä¼šè´´å¤§é‡çš„ä»£ç 
kube-proxyè½¯ä»¶è®¾è®¡ kube-proxy åœ¨è®¾è®¡ä¸Šåˆ†ä¸ºä¸‰ä¸ªæ¨¡å— server äº proxyï¼š
server: æ˜¯ä¸€ä¸ªå¸¸é©»è¿›ç¨‹ç”¨äºå¤„ç†serviceçš„äº‹ä»¶ proxy: æ˜¯ kube-proxy çš„å·¥ä½œæ ¸å¿ƒï¼Œå®é™…ä¸Šçš„è§’è‰²æ˜¯ä¸€ä¸ª service controllerï¼Œé€šè¿‡ç›‘å¬ node, service, endpoint è€Œç”Ÿæˆè§„åˆ™ proxier: æ˜¯å®ç°serviceçš„ç»„ä»¶ï¼Œä¾‹å¦‚iptables, ipvsâ€¦. å¦‚ä½•å¿«é€Ÿè¯»æ‡‚kube-proxyæºç  è¦æƒ³å¿«é€Ÿè¯»æ‡‚ kube-proxy æºç å°±éœ€è¦å¯¹ kube-proxy è®¾è®¡æœ‰æ·±åˆ»çš„äº†è§£ï¼Œä¾‹å¦‚éœ€è¦çœ‹ kube-proxy çš„å®ç°ï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹ proxyçš„éƒ¨åˆ†ï¼Œä¸‹åˆ—æ˜¯ proxy éƒ¨åˆ†çš„ç›®å½•ç»“æ„
bash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 $ tree -L 1 . â”œâ”€â”€ BUILD â”œâ”€â”€ OWNERS â”œâ”€â”€ apis â”œâ”€â”€ config â”œâ”€â”€ healthcheck â”œâ”€â”€ iptables â”œâ”€â”€ ipvs â”œâ”€â”€ metaproxier â”œâ”€â”€ metrics â”œâ”€â”€ userspace â”œâ”€â”€ util â”œâ”€â”€ winuserspace â”œâ”€â”€ winkernel â”œâ”€â”€ doc....</p></div><footer class=entry-footer><span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2023-02-06</span></span>&nbsp;Â·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg><span>4454 å­—</span></span>&nbsp;Â·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>21 åˆ†é’Ÿ</span></span></footer><a class=entry-link aria-label="post link to æ·±å…¥ç†è§£Kubernetes service - kube-proxyæ¶æ„åˆ†æ" href=https://www.oomkill.com/2023/02/ch19-kube-proxy-code/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>haproxy ä¸­ http ä»£ç†çš„è¿æ¥æ¨¡å¼</h2></header><div class=entry-content><p>haproxyä½œä¸ºä¸€ä¸ªã€ä»£ç†è½¯ä»¶ã€å¦‚æœå½“å·¥ä½œä¸ HTTP æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰ç»ç”±haproxyçš„çš„è¿æ¥çš„è¯·æ±‚å’Œå“åº”éƒ½å–å†³äº frondend ä¸­é…ç½®çš„ ã€http_connection_modeã€ å³ haproxy ä¸­ frontend ä¸ backend çš„ç»„åˆï¼Œè€Œhaproxy æ”¯æŒ 3 ç§è¿æ¥æ¨¡å¼ï¼š
KAL keep alive: frontend ä¸­é…ç½®ä¸º http-keep-alive ; è¿™æ˜¯é»˜è®¤æ¨¡å¼ï¼Œè¿™ä¹Ÿæ˜¯httpä¸­çš„keepalive è¡¨ç¤ºæ‰€æœ‰è¯·æ±‚å’Œå“åº”éƒ½å¾—åˆ°å¤„ç†ï¼Œè¿æ¥ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œä½†åœ¨å“åº”å’Œæ–°è¯·æ±‚ä¹‹é—´å¤„äºç©ºé—²çŠ¶æ€ã€‚ SCL server close : frontend ä¸­é…ç½®ä¸º http-server-close ; æ¥æ”¶åˆ°å“åº”ç»“æŸåï¼Œé¢å‘æœåŠ¡å™¨çš„è¿æ¥å…³é—­ï¼Œä½†é¢å‘å®¢æˆ·ç«¯çš„è¿æ¥ä¿æŒæ‰“å¼€çŠ¶æ€ CLO close: frontend ä¸­é…ç½®ä¸º httpclose ï¼›è¿æ¥åœ¨å“åº”ç»“æŸåå…³é—­ï¼Œå¹¶åœ¨ä¸¤ä¸ªæ–¹å‘ä¸Šé™„åŠ  â€œConnection: closeâ€ ã€‚ ä¸‹åˆ—çŸ©é˜µè¡¨ç¤ºçš„æ˜¯é€šè¿‡ frondend ä¸ backend ä¹‹é—´ä¸¤ç«¯çš„ä»£ç†æ¨¡å¼ï¼Œè¿™ä¸ªæ¨¡å¼æ˜¯å¯¹ç§°çš„
text 1 2 3 4 5 6 7 | KAL | SCL | CLO ----+-----+-----+---- KAL | KAL | SCL | CLO ----+-----+-----+---- mode SCL | SCL | SCL | CLO ----+-----+-----+---- CLO | CLO | CLO | CLO å¯¹äºhttpé€‰é¡¹çš„è¯´æ˜ é€‰é¡¹ è¯´æ˜ forwardfor è¿™ä¸ªé€‰é¡¹åŒæ—¶å­˜åœ¨äºbackend ä¸ frontendç«¯ï¼Œä½†backendä¸­çš„ä¼˜å…ˆçº§è¶…è¿‡frontend å¦‚æœåŒæ—¶è®¾ç½®äº†è¿™ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆ backendæ®µçš„å­å‚æ•°å°†ä¼˜å…ˆä¸ frontend ä¸€ç«¯ httpchk å¯ç”¨httpåè®®æ£€æŸ¥æ¥æ£€æµ‹serverçš„å¥åº·çŠ¶æ€ï¼Œé»˜è®¤æƒ…å†µä¸‹çŠ¶æ€æ£€æŸ¥æ˜¯ä»…å»ºç«‹ä¸€ä¸ªtcpè¿æ¥ httpclose è¿™ä¸ªé€‰é¡¹ä»£è¡¨äº†haproxy å¯¹äºhttpåè®®æŒä¹…è¿æ¥æ–¹ä¾¿çš„é…ç½® Referenceï¼šconfiguration....</p></div><footer class=entry-footer><span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2023-01-31</span></span>&nbsp;Â·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg><span>104 å­—</span></span>&nbsp;Â·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>1 åˆ†é’Ÿ</span></span></footer><a class=entry-link aria-label="post link to haproxy ä¸­ http ä»£ç†çš„è¿æ¥æ¨¡å¼" href=https://www.oomkill.com/2023/01/haproxy-http-connection-mode/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=https://www.oomkill.com/posts/page/16/>ä¸Šä¸€é¡µ
</a><a class=next href=https://www.oomkill.com/posts/page/18/>ä¸‹ä¸€é¡µ</a></nav></footer></main><footer class=footer><span>&copy; 2024 <a href=https://www.oomkill.com/>Cylon's Collection</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> on
<a href=https://pages.github.com/ rel=noopener target=_blank>GitHub Pages</a> & Theme
        <a href=https://github.com/tofuwine/PaperMod-PE rel=noopener target=_blank>PaperMod-PE</a></span></footer><div class=pe-right-sidebar><a href=javascript:void(0); id=theme-toggle-float class=pe-float-btn><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a href=#top class=pe-float-btn id=top-link><span id=pe-read-progress></span></a></div><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>