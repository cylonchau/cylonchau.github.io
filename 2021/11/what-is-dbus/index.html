<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Linux高级IPC - DBus | Cylon's Collection</title>
<meta name=keywords content="dbus"><meta name=description content="What is IPC IPC [Inter-Process Communication] 进程间通信，指至少两个进程或线程间传送数据或信号的一些技术或方法。在Linux/Unix中，提供了许多IPC。Unix七大IPC：
Pipe：无名管道，最基本的IPC，单向通信，仅在父/子进程之间，也就是将一个程序的输出直接交给另一个程序的输入。常见使用为 ps -ef|grep xxx FIFO [(First in, First out)] 或 有名管道（named pipe）:与Pipe不同，FIFO可以让两个不相关的进程可以使用FIFO。单向。 Socket 和 Unix Domain Socket：socket和Unix套接字，双向。适用于网络通信，但也可以在本地使用。适用于不同的协议。 消息队列 Message Queue: SysV 消息队列、POSIX 消息队列。 Signal: 信号，是发送到正在运行的进程通知以触发其事件的特定行为，是IPC的一种有限形式。 Semaphore：信号量，通常用于IPC或同一进程内的线程间通信。他们之间使用队列进行消息传递、控制或内容的传递。（常见SysV 信号量、POSIX 信号量） Shared memory：（常见SysV 共享内存、POSIX 共享内存）。共享内存，是在进程（程序）之间传递数据的有效方式，目的是在其之间提供通信。 每种IPC都有不通的特点，每种方式对资源的使用及性能都是不通的
管道 I/O是最快的，但为单向通信，需要工作在 父/子 进程关系之间。 UNIX 套接字可以在本地连接不同的进程，并且具有更高的带宽，并且没有固有的消息边界。 TCP/IP套接字可以连接任何进程。并且可以通过网络连接，但是对资源会有更多的开销，同样的没有固定的消息边界。 Reference comparsion Unix/Linux IPC
What is D-Bus 提到，D-Bus就不能不提一下freedesktop，而 D-Bus 仅仅作为freedesktop.org的一部分。
D-Bus 桌面总线 (Desktop Bus)，的简写，也是Linux- IPC机制，不同于Unix 7大基础IPC的是，D-Bus是在这些IPC类型之上实现的中间件IPC，D-Bus使用了基础IPC中一种过多种，其设计的目的是在Linux桌面环境，提供服务的标准化。但目前并没有合入主线内核中。
作为中间件IPC，D-Bus的性能较低与其他IPC模式，因为在通信过程中会进行很多上下文切换，如果通过Dbus来发送消息，会先将其发送到内核，然后将其送回D-Bus。AF_BUS 补丁是新的套接字类型，用来减少D-Bus上下文的切换。
更多可参考：https://en.wikipedia.org/wiki/D-Bus
D-Bus组成 D-Bus是 一个IPC的实现方式，在架构上分位三层。
Layer 1 libdbus：freedesktop机构提供的一个免费开源的一个由C语言编写的 low-level API 。是提供dbus功能的库。是高级API绑定的低级API。 Layer 2 dbus daemon：dbus实现的IPC守护进行，随Linux启动，通过不通进程对其的连接，实现了多进程间消息的路由（包含内核、网络、桌面等） Layer 3 Wapper libraries （high-level API）： 对 low-level API libdbus的封装 ，例如 libdbus-qt libdbus-python github."><meta name=author content="cylon"><link rel=canonical href=https://www.oomkill.com/2021/11/what-is-dbus/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://www.oomkill.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.oomkill.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.oomkill.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.oomkill.com/favicon.ico><link rel=mask-icon href=https://www.oomkill.com/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://www.oomkill.com/2021/11/what-is-dbus/><noscript><style>#theme-toggle,#top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link crossorigin=anonymous href=/assets/css/pe.min.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/pe.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/all.min.css><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/v4-shims.min.css><script defer src=https://cdn.staticfile.net/jquery/3.5.1/jquery.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/fancybox/3.5.7/jquery.fancybox.min.css><script defer src=https://cdn.staticfile.net/fancybox/3.5.7/jquery.fancybox.min.js></script><script id=MathJax-script async src=https://cdn.staticfile.net/mathjax/3.2.2/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["$$","$$"]],inlineMath:[["\\$","\\$"]]}}</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><meta property="og:title" content="Linux高级IPC - DBus"><meta property="og:description" content="What is IPC IPC [Inter-Process Communication] 进程间通信，指至少两个进程或线程间传送数据或信号的一些技术或方法。在Linux/Unix中，提供了许多IPC。Unix七大IPC：
Pipe：无名管道，最基本的IPC，单向通信，仅在父/子进程之间，也就是将一个程序的输出直接交给另一个程序的输入。常见使用为 ps -ef|grep xxx FIFO [(First in, First out)] 或 有名管道（named pipe）:与Pipe不同，FIFO可以让两个不相关的进程可以使用FIFO。单向。 Socket 和 Unix Domain Socket：socket和Unix套接字，双向。适用于网络通信，但也可以在本地使用。适用于不同的协议。 消息队列 Message Queue: SysV 消息队列、POSIX 消息队列。 Signal: 信号，是发送到正在运行的进程通知以触发其事件的特定行为，是IPC的一种有限形式。 Semaphore：信号量，通常用于IPC或同一进程内的线程间通信。他们之间使用队列进行消息传递、控制或内容的传递。（常见SysV 信号量、POSIX 信号量） Shared memory：（常见SysV 共享内存、POSIX 共享内存）。共享内存，是在进程（程序）之间传递数据的有效方式，目的是在其之间提供通信。 每种IPC都有不通的特点，每种方式对资源的使用及性能都是不通的
管道 I/O是最快的，但为单向通信，需要工作在 父/子 进程关系之间。 UNIX 套接字可以在本地连接不同的进程，并且具有更高的带宽，并且没有固有的消息边界。 TCP/IP套接字可以连接任何进程。并且可以通过网络连接，但是对资源会有更多的开销，同样的没有固定的消息边界。 Reference comparsion Unix/Linux IPC
What is D-Bus 提到，D-Bus就不能不提一下freedesktop，而 D-Bus 仅仅作为freedesktop.org的一部分。
D-Bus 桌面总线 (Desktop Bus)，的简写，也是Linux- IPC机制，不同于Unix 7大基础IPC的是，D-Bus是在这些IPC类型之上实现的中间件IPC，D-Bus使用了基础IPC中一种过多种，其设计的目的是在Linux桌面环境，提供服务的标准化。但目前并没有合入主线内核中。
作为中间件IPC，D-Bus的性能较低与其他IPC模式，因为在通信过程中会进行很多上下文切换，如果通过Dbus来发送消息，会先将其发送到内核，然后将其送回D-Bus。AF_BUS 补丁是新的套接字类型，用来减少D-Bus上下文的切换。
更多可参考：https://en.wikipedia.org/wiki/D-Bus
D-Bus组成 D-Bus是 一个IPC的实现方式，在架构上分位三层。
Layer 1 libdbus：freedesktop机构提供的一个免费开源的一个由C语言编写的 low-level API 。是提供dbus功能的库。是高级API绑定的低级API。 Layer 2 dbus daemon：dbus实现的IPC守护进行，随Linux启动，通过不通进程对其的连接，实现了多进程间消息的路由（包含内核、网络、桌面等） Layer 3 Wapper libraries （high-level API）： 对 low-level API libdbus的封装 ，例如 libdbus-qt libdbus-python github."><meta property="og:type" content="article"><meta property="og:url" content="https://www.oomkill.com/2021/11/what-is-dbus/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-11-18T00:00:00+00:00"><meta property="article:modified_time" content="2024-08-23T23:00:36+08:00"><meta property="og:site_name" content="Cylon's Collection"><meta name=twitter:card content="summary"><meta name=twitter:title content="Linux高级IPC - DBus"><meta name=twitter:description content="What is IPC IPC [Inter-Process Communication] 进程间通信，指至少两个进程或线程间传送数据或信号的一些技术或方法。在Linux/Unix中，提供了许多IPC。Unix七大IPC：
Pipe：无名管道，最基本的IPC，单向通信，仅在父/子进程之间，也就是将一个程序的输出直接交给另一个程序的输入。常见使用为 ps -ef|grep xxx FIFO [(First in, First out)] 或 有名管道（named pipe）:与Pipe不同，FIFO可以让两个不相关的进程可以使用FIFO。单向。 Socket 和 Unix Domain Socket：socket和Unix套接字，双向。适用于网络通信，但也可以在本地使用。适用于不同的协议。 消息队列 Message Queue: SysV 消息队列、POSIX 消息队列。 Signal: 信号，是发送到正在运行的进程通知以触发其事件的特定行为，是IPC的一种有限形式。 Semaphore：信号量，通常用于IPC或同一进程内的线程间通信。他们之间使用队列进行消息传递、控制或内容的传递。（常见SysV 信号量、POSIX 信号量） Shared memory：（常见SysV 共享内存、POSIX 共享内存）。共享内存，是在进程（程序）之间传递数据的有效方式，目的是在其之间提供通信。 每种IPC都有不通的特点，每种方式对资源的使用及性能都是不通的
管道 I/O是最快的，但为单向通信，需要工作在 父/子 进程关系之间。 UNIX 套接字可以在本地连接不同的进程，并且具有更高的带宽，并且没有固有的消息边界。 TCP/IP套接字可以连接任何进程。并且可以通过网络连接，但是对资源会有更多的开销，同样的没有固定的消息边界。 Reference comparsion Unix/Linux IPC
What is D-Bus 提到，D-Bus就不能不提一下freedesktop，而 D-Bus 仅仅作为freedesktop.org的一部分。
D-Bus 桌面总线 (Desktop Bus)，的简写，也是Linux- IPC机制，不同于Unix 7大基础IPC的是，D-Bus是在这些IPC类型之上实现的中间件IPC，D-Bus使用了基础IPC中一种过多种，其设计的目的是在Linux桌面环境，提供服务的标准化。但目前并没有合入主线内核中。
作为中间件IPC，D-Bus的性能较低与其他IPC模式，因为在通信过程中会进行很多上下文切换，如果通过Dbus来发送消息，会先将其发送到内核，然后将其送回D-Bus。AF_BUS 补丁是新的套接字类型，用来减少D-Bus上下文的切换。
更多可参考：https://en.wikipedia.org/wiki/D-Bus
D-Bus组成 D-Bus是 一个IPC的实现方式，在架构上分位三层。
Layer 1 libdbus：freedesktop机构提供的一个免费开源的一个由C语言编写的 low-level API 。是提供dbus功能的库。是高级API绑定的低级API。 Layer 2 dbus daemon：dbus实现的IPC守护进行，随Linux启动，通过不通进程对其的连接，实现了多进程间消息的路由（包含内核、网络、桌面等） Layer 3 Wapper libraries （high-level API）： 对 low-level API libdbus的封装 ，例如 libdbus-qt libdbus-python github."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.oomkill.com/posts/"},{"@type":"ListItem","position":2,"name":"Linux高级IPC - DBus","item":"https://www.oomkill.com/2021/11/what-is-dbus/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Linux高级IPC - DBus","name":"Linux高级IPC - DBus","description":"What is IPC IPC [Inter-Process Communication] 进程间通信，指至少两个进程或线程间传送数据或信号的一些技术或方法。在Linux/Unix中，提供了许多IPC。Unix七大IPC：\nPipe：无名管道，最基本的IPC，单向通信，仅在父/子进程之间，也就是将一个程序的输出直接交给另一个程序的输入。常见使用为 ps -ef|grep xxx FIFO [(First in, First out)] 或 有名管道（named pipe）:与Pipe不同，FIFO可以让两个不相关的进程可以使用FIFO。单向。 Socket 和 Unix Domain Socket：socket和Unix套接字，双向。适用于网络通信，但也可以在本地使用。适用于不同的协议。 消息队列 Message Queue: SysV 消息队列、POSIX 消息队列。 Signal: 信号，是发送到正在运行的进程通知以触发其事件的特定行为，是IPC的一种有限形式。 Semaphore：信号量，通常用于IPC或同一进程内的线程间通信。他们之间使用队列进行消息传递、控制或内容的传递。（常见SysV 信号量、POSIX 信号量） Shared memory：（常见SysV 共享内存、POSIX 共享内存）。共享内存，是在进程（程序）之间传递数据的有效方式，目的是在其之间提供通信。 每种IPC都有不通的特点，每种方式对资源的使用及性能都是不通的\n管道 I/O是最快的，但为单向通信，需要工作在 父/子 进程关系之间。 UNIX 套接字可以在本地连接不同的进程，并且具有更高的带宽，并且没有固有的消息边界。 TCP/IP套接字可以连接任何进程。并且可以通过网络连接，但是对资源会有更多的开销，同样的没有固定的消息边界。 Reference comparsion Unix/Linux IPC\nWhat is D-Bus 提到，D-Bus就不能不提一下freedesktop，而 D-Bus 仅仅作为freedesktop.org的一部分。\nD-Bus 桌面总线 (Desktop Bus)，的简写，也是Linux- IPC机制，不同于Unix 7大基础IPC的是，D-Bus是在这些IPC类型之上实现的中间件IPC，D-Bus使用了基础IPC中一种过多种，其设计的目的是在Linux桌面环境，提供服务的标准化。但目前并没有合入主线内核中。\n作为中间件IPC，D-Bus的性能较低与其他IPC模式，因为在通信过程中会进行很多上下文切换，如果通过Dbus来发送消息，会先将其发送到内核，然后将其送回D-Bus。AF_BUS 补丁是新的套接字类型，用来减少D-Bus上下文的切换。\n更多可参考：https://en.wikipedia.org/wiki/D-Bus\nD-Bus组成 D-Bus是 一个IPC的实现方式，在架构上分位三层。\nLayer 1 libdbus：freedesktop机构提供的一个免费开源的一个由C语言编写的 low-level API 。是提供dbus功能的库。是高级API绑定的低级API。 Layer 2 dbus daemon：dbus实现的IPC守护进行，随Linux启动，通过不通进程对其的连接，实现了多进程间消息的路由（包含内核、网络、桌面等） Layer 3 Wapper libraries （high-level API）： 对 low-level API libdbus的封装 ，例如 libdbus-qt libdbus-python github.","keywords":["dbus"],"articleBody":"What is IPC IPC [Inter-Process Communication] 进程间通信，指至少两个进程或线程间传送数据或信号的一些技术或方法。在Linux/Unix中，提供了许多IPC。Unix七大IPC：\nPipe：无名管道，最基本的IPC，单向通信，仅在父/子进程之间，也就是将一个程序的输出直接交给另一个程序的输入。常见使用为 ps -ef|grep xxx FIFO [(First in, First out)] 或 有名管道（named pipe）:与Pipe不同，FIFO可以让两个不相关的进程可以使用FIFO。单向。 Socket 和 Unix Domain Socket：socket和Unix套接字，双向。适用于网络通信，但也可以在本地使用。适用于不同的协议。 消息队列 Message Queue: SysV 消息队列、POSIX 消息队列。 Signal: 信号，是发送到正在运行的进程通知以触发其事件的特定行为，是IPC的一种有限形式。 Semaphore：信号量，通常用于IPC或同一进程内的线程间通信。他们之间使用队列进行消息传递、控制或内容的传递。（常见SysV 信号量、POSIX 信号量） Shared memory：（常见SysV 共享内存、POSIX 共享内存）。共享内存，是在进程（程序）之间传递数据的有效方式，目的是在其之间提供通信。 每种IPC都有不通的特点，每种方式对资源的使用及性能都是不通的\n管道 I/O是最快的，但为单向通信，需要工作在 父/子 进程关系之间。 UNIX 套接字可以在本地连接不同的进程，并且具有更高的带宽，并且没有固有的消息边界。 TCP/IP套接字可以连接任何进程。并且可以通过网络连接，但是对资源会有更多的开销，同样的没有固定的消息边界。 Reference comparsion Unix/Linux IPC\nWhat is D-Bus 提到，D-Bus就不能不提一下freedesktop，而 D-Bus 仅仅作为freedesktop.org的一部分。\nD-Bus 桌面总线 (Desktop Bus)，的简写，也是Linux- IPC机制，不同于Unix 7大基础IPC的是，D-Bus是在这些IPC类型之上实现的中间件IPC，D-Bus使用了基础IPC中一种过多种，其设计的目的是在Linux桌面环境，提供服务的标准化。但目前并没有合入主线内核中。\n作为中间件IPC，D-Bus的性能较低与其他IPC模式，因为在通信过程中会进行很多上下文切换，如果通过Dbus来发送消息，会先将其发送到内核，然后将其送回D-Bus。AF_BUS 补丁是新的套接字类型，用来减少D-Bus上下文的切换。\n更多可参考：https://en.wikipedia.org/wiki/D-Bus\nD-Bus组成 D-Bus是 一个IPC的实现方式，在架构上分位三层。\nLayer 1 libdbus：freedesktop机构提供的一个免费开源的一个由C语言编写的 low-level API 。是提供dbus功能的库。是高级API绑定的低级API。 Layer 2 dbus daemon：dbus实现的IPC守护进行，随Linux启动，通过不通进程对其的连接，实现了多进程间消息的路由（包含内核、网络、桌面等） Layer 3 Wapper libraries （high-level API）： 对 low-level API libdbus的封装 ，例如 libdbus-qt libdbus-python github.com/godbus/dbus，这些不同编程语言实现的Wapper是不同开发者应该使用的lib，其简化了D-Bus的开发难度。 dbus 基本概念 总线 在 D-Bus 中，bus是一个核心概念。它是应用程序可以进行方法调用、发送信号和侦听信号的通道。有两种预定义的bus：会话总线和系统总线。\n会话总线（Session Bus）：普通进程创建，可同时存在多条。会话总线属于某个进程私有，它用于进程间传递消息。\n系统总线（System Bus）：在引导时就会启动，它由操作系统和后台进程使用，安全性非常好，以使得任意的应用程序不能欺骗系统事件。当然，如果一个应用程序需要接受来自系统总线的消息，他也可以直接连接到系统总线中，但是他能发送的消息是受限的。系统总线最常见的用途是在系统范围事件发生时发送系统范围的通知。添加新的存储设备、网络连接更改事件和关闭相关事件都是系统总线何时更适合通信总线的示例。\n通常情况下只存在一个System Bus，但可以存在多个Session Bus（每个桌面会话一个）。\n总线以dbus-daemon的形式存在与系统中，该进程专门将消息从一个进程传递到另一个进程。该守护进程还将向总线上的所有应用程序转发通知。\nbus name 总线名称 Bus Name，不能单单以字面意思 总线名称 来理解，官方对其解释为**：Connections have one or more bus names associated with them. A connection has exactly one bus name that is a unique connection name.**，可以出bus name其实是用来连接名称。主要是用来标识一个应用和消息总线的连接。总线名称主要分为两类：唯一名称与公共名称。\n唯一连接名称 unique connection names ：以冒号（’：’）字符开头的 bus name是唯一的连接名称。例如 :1.0。每个连接都有一个唯一名。在一个 消息总线的生命期内，不会有两个连接有相同的唯一名。 公共连接名称 well-known bus names：公共名称是以反向DNS域名（小写）例如：org.fedoraproject.FirewallD1。 如果DNS 域名包含连字符/减号，则应将其替换为下划线，如果包含数字，则应通过添加下划线进行转义。例如： 7-zip.org的bus name应该定义为 org._7_zip.Archiver。 对象路径 对象路径(Object Paths) 是用于引用对象实例的名称（类似于 C++ 或 Java 对象）。从概念上来说，D-Bus在消息交换中每个参与者都有任意个对象实例，如文件系统一样，Dbus中的参与者中的对象实例也会形成一个层次树。如，在CentOS7中 firewalld开发的D-Bus API 使用了/org/fedoraproject/FirewallD1的层次结构。\n在定义一个对象路径时，需要注意以下：\n路径可以是任意长度 路径必须以 ASCII ‘/’（整数 47）字符开头，并且必须由以斜杠字符分隔的元素组成。 每个元素只能包含 ASCII 字符 [AZ][az][0-9]_ 不允许出现 空字符串 多个 / 字符不能依次出现。 除非路径是根路径（单个/字符），否则不允许尾随 /字符。 接口名称 interface，在每个 Object Path都包含多个接口，一般情况下接口名称应以==反向 DNS 域名开头==（小写），（同 Java 中的接口名称）。在命名规则上，与bus name相同。\n例如：CentOS7中 firewalld开发的D-Bus API 定义的管理zone的接口 org.fedoraproject.FirewallD1.config.zone。如果DNS名称中包含-，则应将其替换为下划线 _。如果DNS 域名包含紧跟在 . 之后的数字，则接口名称应在数字之前添加一个下划线。例如，如果 7-zip.org 插件定义了一个接口，应该被命名为org._7_zip.Plugin.\n成员方法名称 成员方法名称，Member names ,对于定义了接口后，需要实现其接口的放法，如需要获得firewalld的zone时，就可以调用 org.fedoraproject.FirewallD1.getDefaultZone 。在D-Bus中Member names通常由“驼峰式”（camel-case）命名 。\ndbus 在Linux中，如CentOS dbus包括 dbus daemon及一些cli commad。这些包dbuslib\nD-Bus的消息 最基本的D-Bus协议是一对一的通信协议。与直接使用socket不同，D-Bus是面向消息的协议。 D-Bus的所有功能都是通过在连接上流动的消息完成的。\n而在D-Bus中有四种类型的消息\nMETHOD_CALL 方法调用 METHOD_RETURN 方法返回 ERROR 错误 SIGNAL 信号：与方法调用不同，信号发射没有响应。信号发射只是一个类型为 SIGNAL 的消息。它必须具有三个标头字段：PATH给出发出信号的对象，加上INTERFACE并MEMBER给出信号的完全限定名称。 消息返回的类型\nConventional name 十进制值 说明 INVALID 0 这是个无效类型 METHOD_CALL 1 方法调用，该方法会有提示 METHOD_RETURN 2 方法返回的数据 ERROR 3 错误返回，第一个是其错误的信息 SIGNAL 4 信号的发射 CentOS的dbus服务管理 在CentOS7中，作为systemd的一部分D-BUS会从Systemd获取套接字文件描述符，并使用D-Bus交换当前进程生成的socket信息。而PID 1 不使用 PolicyKit 来控制对特权操作的访问，而是完全依赖于 low-level API D-Bus 。（这样做是为了避免 PolicyKit 和 systemd/PID 1 之间的循环依赖。）而有些特权进程（例如关机/重启/挂起/登陆）可以通过logind进行管理的。\n由此，可以知道在CentOS中，dbus相关的服务大概有 dbus,与 logind。\ndbus包含：\ndbus-daemon：dbus架构中 layer 2的 dbus-damon\ndbus-send: dbus提供的命令行工具，可以用dbus-send来发送消息。\ndbus-monitor: dbus提供的命令行工具，用于监视总线上流动的消息。\ndbus-launch： shell脚本启动消息总线的命令行工具\ndbus配置文件说明 dbus-daemon守护进程，有两个配置文件，一个为 session bus，另外一个为 system bus。\n标准的system bus文件 /usr/local/share/dbus-1/system.conf session bus配置 /usr/local/share/dbus-1/session.conf中配置。在一般情况下，不会操作这两个文件，因其会引入 /etc/dbus-1 中的system.conf 或 session.conf。\n配置文件包含的标签：\n更多的注释可以参考：dbus-daemon\nxml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 # 根元素 system dbus //usr/libexec/dbus-1/dbus-daemon-launch-helper /run/dbus/messagebus.pid EXTERNAL unix:path=/run/dbus/system_bus_socket unix:path=/tmp/foo tcp:host=localhost,port=1234 ","wordCount":"941","inLanguage":"zh","datePublished":"2021-11-18T00:00:00Z","dateModified":"2024-08-23T23:00:36+08:00","author":{"@type":"Person","name":"cylon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.oomkill.com/2021/11/what-is-dbus/"},"publisher":{"@type":"Organization","name":"Cylon's Collection","logo":{"@type":"ImageObject","url":"https://www.oomkill.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.oomkill.com/><img src=https://www.oomkill.com/favicon.ico alt aria-label=logo height=20>Cylon's Collection</a><div class=logo-switches><button id=theme-toggle><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.oomkill.com/archives><span>归档</span></a></li><li><a href=https://www.oomkill.com/tags><span>标签</span></a></li><li><a href=https://www.oomkill.com/search><span>搜索</span></a></li><li><a href=https://www.oomkill.com/about accesskey=/><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Linux高级IPC - DBus</h1><div class=post-meta><span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2021-11-18</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg><span>941 字</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>5 分钟</span></span>
<span class=pe-post-meta-item>&nbsp;·&nbsp;<svg t="1714036239378" fill="currentcolor" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="6659" width="256" height="256"><path d="M690 78.2c-18.6-18.8-49-19-67.8-.4s-19 49-.4 67.8l255.4 258.6c67.8 68.6 67.8 178.8.0 247.4L653.4 878.2c-18.6 18.8-18.4 49.2.4 67.8s49.2 18.4 67.8-.4l224-226.4c104.8-106 104.8-276.4.0-382.4L690 78.2zM485.4 101.4c-24-24-56.6-37.4-90.6-37.4H96C43 64 0 107 0 160v299c0 34 13.4 66.6 37.4 90.6l336 336c50 50 131 50 181 0l267-267c50-50 50-131 0-181l-336-336zM96 160h299c8.4.0 16.6 3.4 22.6 9.4l336 336c12.4 12.4 12.4 32.8.0 45.2l-267 267c-12.4 12.4-32.8 12.4-45.2.0l-336-336c-6-6-9.4-14.2-9.4-22.6V160zm192 128a64 64 0 10-128 0 64 64 0 10128 0z" p-id="6660"/></svg></span><ul class=pe-post-meta-item><a href=https://www.oomkill.com/tags/dbus/>#Dbus</a></ul>&nbsp;·&nbsp;<span id=busuanzi_container_page_pv>本文阅读量 <span id=busuanzi_value_page_pv></span> 次</span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details><summary><span class=details>目录</span></summary><div class=inner><ul><li><a href=#what-is-ipc aria-label="What is IPC">What is IPC</a><li><a href=#reference aria-label=Reference>Reference</a><li><a href=#what-is-d-bus aria-label="What is D-Bus">What is D-Bus</a><ul><li><a href=#d-bus%e7%bb%84%e6%88%90 aria-label=D-Bus组成>D-Bus组成</a></ul><li><a href=#dbus-%e5%9f%ba%e6%9c%ac%e6%a6%82%e5%bf%b5 aria-label="dbus 基本概念">dbus 基本概念</a><ul><li><a href=#%e6%80%bb%e7%ba%bf aria-label=总线>总线</a><li><a href=#bus-name aria-label="bus name">bus name</a><li><a href=#%e5%af%b9%e8%b1%a1%e8%b7%af%e5%be%84 aria-label=对象路径>对象路径</a><li><a href=#%e6%8e%a5%e5%8f%a3%e5%90%8d%e7%a7%b0 aria-label=接口名称>接口名称</a><li><a href=#%e6%88%90%e5%91%98%e6%96%b9%e6%b3%95%e5%90%8d%e7%a7%b0 aria-label=成员方法名称>成员方法名称</a><li><a href=#dbus aria-label=dbus>dbus</a><li><a href=#d-bus%e7%9a%84%e6%b6%88%e6%81%af aria-label=D-Bus的消息>D-Bus的消息</a></ul><li><a href=#centos%e7%9a%84dbus%e6%9c%8d%e5%8a%a1%e7%ae%a1%e7%90%86 aria-label=CentOS的dbus服务管理>CentOS的dbus服务管理</a><ul><li><a href=#dbus%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e8%af%b4%e6%98%8e aria-label=dbus配置文件说明>dbus配置文件说明</a><li><a href=#%e9%80%9a%e8%bf%87%e5%91%bd%e4%bb%a4%e8%a1%8c%e5%8f%91%e9%80%81dbus%e6%b6%88%e6%81%af aria-label=通过命令行发送dbus消息>通过命令行发送dbus消息</a></ul><li><a href=#%e4%bd%bf%e7%94%a8dbus-api%e6%93%8d%e4%bd%9clinux%e9%98%b2%e7%81%ab%e5%a2%99 aria-label="使用dbus api操作linux防火墙">使用dbus api操作linux防火墙</a><li><a href=#reference-1 aria-label=Reference>Reference</a></li></div></details></div></aside><script src=/js/pe-toc.min.445eb1bfc5e85dd13b9519fcc2a806522e9629b6224a2974052789ba00ab78af.js integrity="sha256-RF6xv8XoXdE7lRn8wqgGUi6WKbYiSil0BSeJugCreK8="></script><div class=post-content><h2 id=what-is-ipc>What is IPC<a hidden class=anchor aria-hidden=true href=#what-is-ipc>#</a></h2><p>IPC [<em>Inter-Process Communication</em>] <strong>进程间通信</strong>，指至少两个进程或线程间传送数据或信号的一些技术或方法。在Linux/Unix中，提供了许多IPC。Unix七大IPC：</p><ul><li><strong>Pipe</strong>：无名管道，最基本的IPC，单向通信，仅在父/子进程之间，也就是将一个程序的输出直接交给另一个程序的输入。常见使用为 <code>ps -ef|grep xxx</code></li><li><strong>FIFO [<code>(First in, First out)</code>] 或 有名管道（<code>named pipe</code>）</strong>:与Pipe不同，<strong>FIFO</strong>可以让两个不相关的进程可以使用FIFO。单向。</li><li><strong>Socket 和 Unix Domain Socket</strong>：socket和Unix套接字，双向。适用于网络通信，但也可以在本地使用。适用于不同的协议。</li><li><strong>消息队列 <code>Message Queue</code></strong>: SysV 消息队列、POSIX 消息队列。</li><li><strong>Signal</strong>: 信号，是发送到正在运行的进程通知以触发其事件的特定行为，是IPC的一种有限形式。</li><li><strong>Semaphore</strong>：信号量，通常用于IPC或同一进程内的线程间通信。他们之间使用队列进行消息传递、控制或内容的传递。（常见SysV 信号量、POSIX 信号量）</li><li><strong>Shared memory</strong>：（常见SysV 共享内存、POSIX 共享内存）。共享内存，是在进程（程序）之间传递数据的有效方式，目的是在其之间提供通信。</li></ul><p>每种IPC都有不通的特点，每种方式对资源的使用及性能都是不通的</p><ul><li>管道 I/O是最快的，但为单向通信，需要工作在 父/子 进程关系之间。</li><li>UNIX 套接字可以在本地连接不同的进程，并且具有更高的带宽，并且没有固有的消息边界。</li><li>TCP/IP套接字可以连接任何进程。并且可以通过网络连接，但是对资源会有更多的开销，同样的没有固定的消息边界。</li></ul><h2 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h2><blockquote><p><a href=https://stackoverflow.com/questions/404604/comparing-unix-linux-ipc target=_blank rel="noopener nofollow noreferrer">comparsion Unix/Linux IPC</a></p></blockquote><h2 id=what-is-d-bus>What is D-Bus<a hidden class=anchor aria-hidden=true href=#what-is-d-bus>#</a></h2><p>提到，D-Bus就不能不提一下freedesktop，而 D-Bus 仅仅作为<code>freedesktop.org</code>的一部分。</p><p>D-Bus 桌面总线 (<code>Desktop Bus</code>)，的简写，也是Linux- IPC机制，不同于Unix 7大基础IPC的是，D-Bus是在这些IPC类型之上实现的中间件IPC，D-Bus使用了基础IPC中一种过多种，其设计的目的是在Linux桌面环境，提供服务的标准化。但目前并没有合入主线内核中。</p><p>作为中间件IPC，D-Bus的性能较低与其他IPC模式，因为在通信过程中会进行很多上下文切换，如果通过Dbus来发送消息，会先将其发送到内核，然后将其送回D-Bus。<code>AF_BUS </code>补丁是新的套接字类型，用来减少D-Bus上下文的切换。</p><p>更多可参考：https://en.wikipedia.org/wiki/D-Bus</p><h3 id=d-bus组成>D-Bus组成<a hidden class=anchor aria-hidden=true href=#d-bus组成>#</a></h3><p>D-Bus是 一个IPC的实现方式，在架构上分位三层。</p><ul><li><strong>Layer 1 libdbus</strong>：freedesktop机构提供的一个免费开源的一个由C语言编写的 <code>low-level API</code> 。是提供dbus功能的库。是高级API绑定的低级API。</li><li><strong>Layer 2 dbus daemon</strong>：dbus实现的IPC守护进行，随Linux启动，通过不通进程对其的连接，实现了多进程间消息的路由（包含内核、网络、桌面等）</li><li><strong>Layer 3 Wapper libraries （high-level API）</strong>： 对 <code>low-level API</code> <em>libdbus</em>的封装 ，例如<code> libdbus-qt</code> <code>libdbus-python</code> <code>github.com/godbus/dbus</code>，这些不同编程语言实现的Wapper是不同开发者应该使用的lib，其简化了D-Bus的开发难度。</li></ul><p><div class=pe-fancybox><a data-fancybox=gallery href=https://www.softprayog.in/images/interprocess-communication-using-dbus.png><img src=https://www.softprayog.in/images/interprocess-communication-using-dbus.png#center alt="使用 D-Bus 进行进程间通信" onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><h2 id=dbus-基本概念>dbus 基本概念<a hidden class=anchor aria-hidden=true href=#dbus-基本概念>#</a></h2><h3 id=总线>总线<a hidden class=anchor aria-hidden=true href=#总线>#</a></h3><p>在 D-Bus 中，bus是一个核心概念。它是应用程序可以进行方法调用、发送信号和侦听信号的通道。有两种预定义的bus：<em>会话总线</em>和<em>系统总线</em>。</p><ul><li><p><strong>会话总线（Session Bus）</strong>：普通进程创建，可同时存在多条。会话总线属于某个进程私有，它用于进程间传递消息。</p></li><li><p><strong>系统总线（System Bus）</strong>：在引导时就会启动，它由操作系统和后台进程使用，安全性非常好，以使得任意的应用程序不能欺骗系统事件。当然，如果一个应用程序需要接受来自系统总线的消息，他也可以直接连接到系统总线中，但是他能发送的消息是受限的。系统总线最常见的用途是在系统范围事件发生时发送系统范围的通知。添加新的存储设备、网络连接更改事件和关闭相关事件都是系统总线何时更适合通信总线的示例。</p></li></ul><p>通常情况下只存在一个<code>System Bus</code>，但可以存在多个<code>Session Bus</code>（每个桌面会话一个）。</p><p>总线以dbus-daemon的形式存在与系统中，该进程专门将消息从一个进程传递到另一个进程。该守护进程还将向总线上的所有应用程序转发通知。</p><h3 id=bus-name>bus name<a hidden class=anchor aria-hidden=true href=#bus-name>#</a></h3><p>总线名称 Bus Name，不能单单以字面意思 <em>总线名称</em> 来理解，官方对其解释为**：<em>Connections have one or more bus names associated with them. A connection has exactly one bus name that is a unique connection name.</em>**，可以出bus name其实是用来连接名称。主要是用来标识一个应用和消息总线的连接。总线名称主要分为两类：唯一名称与公共名称。</p><ul><li>唯一连接名称 <code>unique connection names</code> ：以冒号（&rsquo;：&rsquo;）字符开头的 bus name是唯一的连接名称。例如 <code>:1.0</code>。每个连接都有一个唯一名。在一个 消息总线的生命期内，不会有两个连接有相同的唯一名。</li><li>公共连接名称 <code>well-known bus names</code>：公共名称是以反向DNS域名（小写）例如：<code>org.fedoraproject.FirewallD1</code>。<ul><li>如果DNS 域名包含连字符/减号，则应将其替换为下划线，如果包含数字，则应通过添加下划线进行转义。例如： 7-zip.org的bus name应该定义为 <code>org._7_zip.Archiver</code>。</li></ul></li></ul><h3 id=对象路径>对象路径<a hidden class=anchor aria-hidden=true href=#对象路径>#</a></h3><p>对象路径(<code>Object Paths</code>) 是用于引用对象实例的名称（类似于 C++ 或 Java 对象）。从概念上来说，D-Bus在消息交换中每个参与者都有任意个对象实例，如文件系统一样，Dbus中的参与者中的对象实例也会形成一个层次树。如，在CentOS7中 firewalld开发的D-Bus API 使用了<code>/org/fedoraproject/FirewallD1</code>的层次结构。</p><p>在定义一个对象路径时，需要注意以下：</p><ul><li>路径可以是任意长度</li><li>路径必须以 ASCII &lsquo;/&rsquo;（整数 47）字符开头，并且必须由以斜杠字符分隔的元素组成。</li><li>每个元素只能包含 ASCII 字符 <code>[AZ][az][0-9]_</code></li><li>不允许出现 空字符串</li><li>多个 <code>/</code> 字符不能依次出现。 除非路径是根路径（单个<code>/</code>字符），否则不允许尾随 <code>/</code>字符。</li></ul><h3 id=接口名称>接口名称<a hidden class=anchor aria-hidden=true href=#接口名称>#</a></h3><p><code>interface</code>，在每个 <code>Object Path</code>都包含多个接口，一般情况下接口名称应以==反向 DNS 域名开头==（小写），（同 Java 中的接口名称）。在命名规则上，与bus name相同。</p><p>例如：CentOS7中 firewalld开发的D-Bus API 定义的管理zone的接口 <code>org.fedoraproject.FirewallD1.config.zone</code>。如果DNS名称中包含<code>-</code>，则应将其替换为下划线 <code>_</code>。如果DNS 域名包含紧跟在 <code>.</code> 之后的数字，则接口名称应在数字之前添加一个下划线。例如，如果 <code>7-zip.org</code> 插件定义了一个接口，应该被命名为<code>org._7_zip.Plugin</code>.</p><h3 id=成员方法名称>成员方法名称<a hidden class=anchor aria-hidden=true href=#成员方法名称>#</a></h3><p>成员方法名称，<code>Member names</code> ,对于定义了接口后，需要实现其接口的放法，如需要获得firewalld的zone时，就可以调用 <code>org.fedoraproject.FirewallD1.getDefaultZone</code> 。在D-Bus中<code>Member names</code>通常由“驼峰式”（<code>camel-case</code>）命名 。</p><h3 id=dbus>dbus<a hidden class=anchor aria-hidden=true href=#dbus>#</a></h3><p>在Linux中，如CentOS dbus包括 dbus daemon及一些cli commad。这些包dbuslib</p><h3 id=d-bus的消息>D-Bus的消息<a hidden class=anchor aria-hidden=true href=#d-bus的消息>#</a></h3><p>最基本的D-Bus协议是一对一的通信协议。与直接使用socket不同，D-Bus是面向消息的协议。 D-Bus的所有功能都是通过在连接上流动的消息完成的。</p><p>而在D-Bus中有四种类型的消息</p><ul><li>METHOD_CALL 方法调用</li><li>METHOD_RETURN 方法返回</li><li>ERROR 错误</li><li>SIGNAL 信号：与方法调用不同，信号发射没有响应。信号发射只是一个类型为 <code>SIGNAL</code> 的消息。它必须具有三个标头字段：<code>PATH</code>给出发出信号的对象，加上<code>INTERFACE</code>并<code>MEMBER</code>给出信号的完全限定名称。</li></ul><p>消息返回的类型</p><table><thead><tr><th>Conventional name</th><th>十进制值</th><th>说明</th></tr></thead><tbody><tr><td><code>INVALID</code></td><td>0</td><td>这是个无效类型</td></tr><tr><td><code>METHOD_CALL</code></td><td>1</td><td>方法调用，该方法会有提示</td></tr><tr><td><code>METHOD_RETURN</code></td><td>2</td><td>方法返回的数据</td></tr><tr><td><code>ERROR</code></td><td>3</td><td>错误返回，第一个是其错误的信息</td></tr><tr><td><code>SIGNAL</code></td><td>4</td><td>信号的发射</td></tr></tbody></table><h2 id=centos的dbus服务管理>CentOS的dbus服务管理<a hidden class=anchor aria-hidden=true href=#centos的dbus服务管理>#</a></h2><p>在CentOS7中，作为systemd的一部分D-BUS会从Systemd获取套接字文件描述符，并使用D-Bus交换当前进程生成的socket信息。而PID 1 不使用 PolicyKit 来控制对特权操作的访问，而是完全依赖于 low-level API D-Bus 。（这样做是为了避免 PolicyKit 和 systemd/PID 1 之间的循环依赖。）而有些特权进程（例如关机/重启/挂起/登陆）可以通过logind进行管理的。</p><p>由此，可以知道在CentOS中，dbus相关的服务大概有 <code>dbus</code>,与 <code>logind</code>。</p><p>dbus包含：</p><ul><li><p><a href=https://dbus.freedesktop.org/doc/dbus-daemon.1.html target=_blank rel="noopener nofollow noreferrer">dbus-daemon</a>：dbus架构中 layer 2的 dbus-damon</p></li><li><p><a href=https://dbus.freedesktop.org/doc/dbus-send.1.html target=_blank rel="noopener nofollow noreferrer">dbus-send</a>: dbus提供的命令行工具，可以用dbus-send来发送消息。</p></li><li><p><a href=https://dbus.freedesktop.org/doc/dbus-monitor.1.html target=_blank rel="noopener nofollow noreferrer">dbus-monitor</a>: dbus提供的命令行工具，用于监视总线上流动的消息。</p></li><li><p><a href=https://dbus.freedesktop.org/doc/dbus-launch.1.html target=_blank rel="noopener nofollow noreferrer">dbus-launch</a>： shell脚本启动消息总线的命令行工具</p></li></ul><h3 id=dbus配置文件说明>dbus配置文件说明<a hidden class=anchor aria-hidden=true href=#dbus配置文件说明>#</a></h3><p>dbus-daemon守护进程，有两个配置文件，一个为 session bus，另外一个为 system bus。</p><p>标准的system bus文件 <code>/usr/local/share/dbus-1/system.conf</code> session bus配置 <code>/usr/local/share/dbus-1/session.conf</code>中配置。在一般情况下，不会操作这两个文件，因其会引入 <code>/etc/dbus-1</code> 中的<code>system.conf</code> 或 <code>session.conf</code>。</p><p>配置文件包含的标签：</p><p>更多的注释可以参考：<a href=https://dbus.freedesktop.org/doc/dbus-daemon.1.html target=_blank rel="noopener nofollow noreferrer">dbus-daemon</a></p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>xml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl># 根元素
</span></span><span class=line><span class=cl><span class=nt>&lt;busconfig&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!-- 根据指定的 -system或 -session 来选择的配置文件 --&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;type&gt;</span>system<span class=nt>&lt;/type&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!-- dbus-daemon运行的用户 --&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;user&gt;</span>dbus<span class=nt>&lt;/user&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!-- Fork into daemon mode --&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;fork/&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!-- We use system service launching using a helper --&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;standard_system_servicedirs/&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!-- This is a setuid helper that is used to launch system services --&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;servicehelper&gt;</span>//usr/libexec/dbus-1/dbus-daemon-launch-helper<span class=nt>&lt;/servicehelper&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!-- Write a pid file --&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;pidfile&gt;</span>/run/dbus/messagebus.pid<span class=nt>&lt;/pidfile&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!-- Enable logging to syslog --&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;syslog/&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!-- 指定授权机制。如果不存在，所有的机制都被允许。 --&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;auth&gt;</span>EXTERNAL<span class=nt>&lt;/auth&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!-- 总线监听的地址，支持unix socket，tcp，system等
</span></span></span><span class=line><span class=cl><span class=c>		--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;listen&gt;</span>unix:path=/run/dbus/system_bus_socket<span class=nt>&lt;/listen&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;listen&gt;</span>unix:path=/tmp/foo<span class=nt>&lt;/listen&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;listen&gt;</span>tcp:host=localhost,port=1234<span class=nt>&lt;/listen&gt;</span>  
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>  <span class=nt>&lt;policy</span> <span class=na>context=</span><span class=s>&#34;default&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- All users can connect to system bus --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;allow</span> <span class=na>user=</span><span class=s>&#34;*&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Holes must be punched in service configuration files for
</span></span></span><span class=line><span class=cl><span class=c>         name ownership and sending method calls --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;deny</span> <span class=na>own=</span><span class=s>&#34;*&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;deny</span> <span class=na>send_type=</span><span class=s>&#34;method_call&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Signals and reply messages (method returns, errors) are allowed
</span></span></span><span class=line><span class=cl><span class=c>         by efault --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;allow</span> <span class=na>send_type=</span><span class=s>&#34;signal&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;allow</span> <span class=na>send_requested_reply=</span><span class=s>&#34;true&#34;</span> <span class=na>send_type=</span><span class=s>&#34;method_return&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;allow</span> <span class=na>send_requested_reply=</span><span class=s>&#34;true&#34;</span> <span class=na>send_type=</span><span class=s>&#34;error&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- All messages may be received by default --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;allow</span> <span class=na>receive_type=</span><span class=s>&#34;method_call&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;allow</span> <span class=na>receive_type=</span><span class=s>&#34;method_return&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;allow</span> <span class=na>receive_type=</span><span class=s>&#34;error&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;allow</span> <span class=na>receive_type=</span><span class=s>&#34;signal&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Allow anyone to talk to the message bus --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;allow</span> <span class=na>send_destination=</span><span class=s>&#34;org.freedesktop.DBus&#34;</span>
</span></span><span class=line><span class=cl>           <span class=na>send_interface=</span><span class=s>&#34;org.freedesktop.DBus&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;allow</span> <span class=na>send_destination=</span><span class=s>&#34;org.fedoraproject.FirewallD1&#34;</span> 
</span></span><span class=line><span class=cl>	<span class=na>send_interface=</span><span class=s>&#34;org.fedorapproject.FirewallD1&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;allow</span> <span class=na>send_destination=</span><span class=s>&#34;org.freedesktop.DBus&#34;</span>
</span></span><span class=line><span class=cl>           <span class=na>send_interface=</span><span class=s>&#34;org.freedesktop.DBus.Introspectable&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- But disallow some specific bus services --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;deny</span> <span class=na>send_destination=</span><span class=s>&#34;org.freedesktop.DBus&#34;</span>
</span></span><span class=line><span class=cl>          <span class=na>send_interface=</span><span class=s>&#34;org.freedesktop.DBus&#34;</span>
</span></span><span class=line><span class=cl>          <span class=na>send_member=</span><span class=s>&#34;UpdateActivationEnvironment&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;deny</span> <span class=na>send_destination=</span><span class=s>&#34;org.freedesktop.DBus&#34;</span>
</span></span><span class=line><span class=cl>          <span class=na>send_interface=</span><span class=s>&#34;org.freedesktop.DBus.Debug.Stats&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;deny</span> <span class=na>send_destination=</span><span class=s>&#34;org.freedesktop.DBus&#34;</span>
</span></span><span class=line><span class=cl>          <span class=na>send_interface=</span><span class=s>&#34;org.freedesktop.systemd1.Activator&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/policy&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!-- Only systemd, which runs as root, may report activation failures. --&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;policy</span> <span class=na>user=</span><span class=s>&#34;root&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;allow</span> <span class=na>send_destination=</span><span class=s>&#34;org.freedesktop.DBus&#34;</span>
</span></span><span class=line><span class=cl>           <span class=na>send_interface=</span><span class=s>&#34;org.freedesktop.systemd1.Activator&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/policy&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!-- root may monitor the system bus. --&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;policy</span> <span class=na>user=</span><span class=s>&#34;root&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;allow</span> <span class=na>send_destination=</span><span class=s>&#34;org.freedesktop.DBus&#34;</span>
</span></span><span class=line><span class=cl>           <span class=na>send_interface=</span><span class=s>&#34;org.freedesktop.DBus.Monitoring&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/policy&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!-- If the Stats interface was enabled at compile-time, root may use it.
</span></span></span><span class=line><span class=cl><span class=c>       Copy this into system.local.conf or system.d/*.conf if you want to
</span></span></span><span class=line><span class=cl><span class=c>       enable other privileged users to view statistics and debug info --&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;policy</span> <span class=na>user=</span><span class=s>&#34;root&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;allow</span> <span class=na>send_destination=</span><span class=s>&#34;org.freedesktop.DBus&#34;</span>
</span></span><span class=line><span class=cl>           <span class=na>send_interface=</span><span class=s>&#34;org.freedesktop.DBus.Debug.Stats&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/policy&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!-- Include legacy configuration location --&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;include</span> <span class=na>ignore_missing=</span><span class=s>&#34;yes&#34;</span><span class=nt>&gt;</span>/etc/dbus-1/system.conf<span class=nt>&lt;/include&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!-- 包含的子配置文件. --&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;includedir&gt;</span>system.d<span class=nt>&lt;/includedir&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;includedir&gt;</span>/etc/dbus-1/system.d<span class=nt>&lt;/includedir&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!-- This is included last so local configuration can override what&#39;s 
</span></span></span><span class=line><span class=cl><span class=c>       in this standard file --&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;include</span> <span class=na>ignore_missing=</span><span class=s>&#34;yes&#34;</span><span class=nt>&gt;</span>/etc/dbus-1/system-local.conf<span class=nt>&lt;/include&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;include</span> <span class=na>if_selinux_enabled=</span><span class=s>&#34;yes&#34;</span> <span class=na>selinux_root_relative=</span><span class=s>&#34;yes&#34;</span><span class=nt>&gt;</span>contexts/dbus_contexts<span class=nt>&lt;/include&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;/busconfig&gt;</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=通过命令行发送dbus消息>通过命令行发送dbus消息<a hidden class=anchor aria-hidden=true href=#通过命令行发送dbus消息>#</a></h3><p>dbus支持通过命令发送一个dbus消息，如获取可用的dbus 服务。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dbus-send --session <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--dest<span class=o>=</span>org.freedesktop.DBus <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--type<span class=o>=</span>method_call <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--print-reply <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>/org/freedesktop/DBus <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>org.freedesktop.DBus.ListNames
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>method <span class=k>return</span> <span class=nv>time</span><span class=o>=</span>1631452206.288425 <span class=nv>sender</span><span class=o>=</span>org.freedesktop.DBus -&gt; <span class=nv>destination</span><span class=o>=</span>:1.29 <span class=nv>serial</span><span class=o>=</span><span class=m>3</span> <span class=nv>reply_serial</span><span class=o>=</span><span class=m>2</span>
</span></span><span class=line><span class=cl>   array <span class=o>[</span>
</span></span><span class=line><span class=cl>      string <span class=s2>&#34;org.freedesktop.DBus&#34;</span>
</span></span><span class=line><span class=cl>      string <span class=s2>&#34;org.freedesktop.login1&#34;</span>
</span></span><span class=line><span class=cl>      string <span class=s2>&#34;org.freedesktop.systemd1&#34;</span>
</span></span><span class=line><span class=cl>      string <span class=s2>&#34;org.fedoraproject.FirewallD1&#34;</span>
</span></span><span class=line><span class=cl>      string <span class=s2>&#34;org.freedesktop.PolicyKit1&#34;</span>
</span></span><span class=line><span class=cl>      string <span class=s2>&#34;:1.17&#34;</span>
</span></span><span class=line><span class=cl>      string <span class=s2>&#34;:1.0&#34;</span>
</span></span><span class=line><span class=cl>      string <span class=s2>&#34;:1.29&#34;</span>
</span></span><span class=line><span class=cl>      string <span class=s2>&#34;:1.18&#34;</span>
</span></span><span class=line><span class=cl>      string <span class=s2>&#34;:1.1&#34;</span>
</span></span><span class=line><span class=cl>   <span class=o>]</span></span></span></code></pre></td></tr></table></div></div></div></div><p>返回org.freedesktop.DBus service</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dbus-send --session <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--dest<span class=o>=</span>org.freedesktop.DBus <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--type<span class=o>=</span>method_call <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--print-reply <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>/org/freedesktop/DBus <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>org.freedesktop.DBus.Introspectable.Introspect</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=使用dbus-api操作linux防火墙>使用dbus api操作linux防火墙<a hidden class=anchor aria-hidden=true href=#使用dbus-api操作linux防火墙>#</a></h2><p>Firewalld是一个基于动态区域的防火墙守护进程，自 2009 年左右开始开发，目前为Fedora 18 以及随后的 RHEL7 和 CentOS 7 中的默认防火墙机制。</p><p><em>Firewalld</em>被配置为<em>systemd</em> D-Bus 服务。请注意下面的“Type=dbus”指令。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat /usr/lib/systemd/system/firewalld.service 
</span></span><span class=line><span class=cl><span class=o>[</span>Unit<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>Description</span><span class=o>=</span>firewalld - dynamic firewall daemon
</span></span><span class=line><span class=cl><span class=nv>Before</span><span class=o>=</span>network.target
</span></span><span class=line><span class=cl><span class=nv>Before</span><span class=o>=</span>libvirtd.service
</span></span><span class=line><span class=cl><span class=nv>Before</span><span class=o>=</span>NetworkManager.service
</span></span><span class=line><span class=cl><span class=nv>Conflicts</span><span class=o>=</span>iptables.service ip6tables.service ebtables.service
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>Service<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>EnvironmentFile</span><span class=o>=</span>-/etc/sysconfig/firewalld
</span></span><span class=line><span class=cl><span class=nv>ExecStart</span><span class=o>=</span>/usr/sbin/firewalld --nofork --nopid <span class=nv>$FIREWALLD_ARGS</span>
</span></span><span class=line><span class=cl><span class=nv>ExecReload</span><span class=o>=</span>/bin/kill -HUP <span class=nv>$MAINPID</span>
</span></span><span class=line><span class=cl><span class=c1># supress to log debug and error output also to /var/log/messages</span>
</span></span><span class=line><span class=cl><span class=nv>StandardOutput</span><span class=o>=</span>null
</span></span><span class=line><span class=cl><span class=nv>StandardError</span><span class=o>=</span>null
</span></span><span class=line><span class=cl><span class=nv>Type</span><span class=o>=</span>dbus
</span></span><span class=line><span class=cl><span class=nv>BusName</span><span class=o>=</span>org.fedoraproject.FirewallD1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>Install<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>WantedBy</span><span class=o>=</span>basic.target
</span></span><span class=line><span class=cl><span class=nv>Alias</span><span class=o>=</span>dbus-org.fedoraproject.FirewallD1.service</span></span></code></pre></td></tr></table></div></div></div></div><p>知道了<em>firewalld</em>服务是基于D-Bus的，就可以通过D-Bus来操作防火墙。</p><p>查看dbus注册的服务是否包含firewalld，这里需要注意的是，firewalld依赖dbus服务，每次启动firewalld时注册到dbus总线内。所以需要先启动<code>dbus-daemon</code>与 <code>firewalld </code>服务。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dbus-send --system --dest<span class=o>=</span>org.freedesktop.DBus --type<span class=o>=</span>method_call --print-reply <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>/org/freedesktop/DBus org.freedesktop.DBus.ListNames <span class=p>|</span> grep FirewallD</span></span></code></pre></td></tr></table></div></div></div></div><p>查看得知 <code>org.fedoraproject.FirewallD1</code> 为firewalld接口</p><p>查看接口所拥有的方法、属性、信号等信息</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dbus-send --system --dest<span class=o>=</span>org.fedoraproject.FirewallD1 --print-reply <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>/org/fedoraproject/FirewallD1 org.freedesktop.DBus.Introspectable.Introspect</span></span></code></pre></td></tr></table></div></div></div></div><p>获得zone</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>firewall-cmd --get-zones
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>dbus-send --system \
</span></span><span class=line><span class=cl>--dest=org.fedoraproject.FirewallD1 \
</span></span><span class=line><span class=cl>--print-reply \
</span></span><span class=line><span class=cl>--type=method_call /org/fedoraproject/FirewallD1 \
</span></span><span class=line><span class=cl>org.fedoraproject.FirewallD1.zone.getZones</span></span></code></pre></td></tr></table></div></div></div></div><p>查看zone内的条目信息</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ firewall-cmd --zone<span class=o>=</span>public --list-all
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>dbus-send --system --dest<span class=o>=</span>org.fedoraproject.FirewallD1 --print-reply --type<span class=o>=</span>method_call <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>/org/fedoraproject/FirewallD1 org.fedoraproject.FirewallD1.getZoneSettings string:<span class=s2>&#34;public&#34;</span></span></span></code></pre></td></tr></table></div></div></div></div><h2 id=reference-1>Reference<a hidden class=anchor aria-hidden=true href=#reference-1>#</a></h2><ul><li><p><a href=https://dbus.freedesktop.org/doc/dbus-specification.html#message-protocol-names-bus target=_blank rel="noopener nofollow noreferrer">bus name</a></p></li><li><p><a href=https://dbus.freedesktop.org/doc/dbus-tutorial.html target=_blank rel="noopener nofollow noreferrer">dbus-tutorial</a></p></li></ul></div><div class=pe-copyright><hr><blockquote><p>本文为原创内容，版权归作者所有。如需转载，请在文章中声明本文标题及链接。</p><p>文章标题：Linux高级IPC - DBus</p><p>文章链接：<a href=https://www.oomkill.com/2021/11/what-is-dbus/ target=_blank>https://www.oomkill.com/2021/11/what-is-dbus/</a></p><p>许可协议：<a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></p></blockquote></div><div class=comments-separator></div><h3 class=relatedContentTitle>相关阅读</h3><ul class=relatedContent><li><a href=/2021/11/firewalld-dbus-interface/><span>使用firewalld dbus接口配置iptables</span></a></li><li><a href=/2021/11/dbus-data-structure/><span>通俗易懂的dbus数据结构</span></a></li><li><a href=/2021/10/dbus-client-tutorial/><span>Linux dbus命令行套件</span></a></li><li><a href=/2020/09/centos7-dbus-troubleshooting/><span>Centos7 dbus问题总结</span></a></li></ul><div class=comments-separator></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.oomkill.com/tags/dbus/>Dbus</a></li></ul><nav class=paginav><a class=prev href=https://www.oomkill.com/2021/11/ch01-k8s-perpare/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></polyline></svg>&nbsp;</span>
<span>k8s开发环境准备 - 如何配置开发环境</span>
</a><a class=next href=https://www.oomkill.com/2021/11/firewalld-dbus-interface/><span class=title></span>
<span>使用firewalld dbus接口配置iptables&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span></a></nav></footer><div class=pe-comments-decoration><p class=pe-comments-title></p><p class=pe-comments-subtitle></p></div><div id=pe-comments></div><script src=/js/pe-go-comment.min.86a214102576ba5f9b7bdc29eed8d58dd56e34aef80b3c65c73ea9cc88443696.js integrity="sha256-hqIUECV2ul+be9wp7tjVjdVuNK74Czxlxz6pzIhENpY="></script><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const s={src:"https://giscus.app/client.js","data-repo":"cylonchau/cylonchau.github.io","data-repo-id":"R_kgDOIRlNSQ","data-category":"Announcements","data-category-id":"DIC_kwDOIRlNSc4CXy1U","data-mapping":"pathname","data-term":"posts/what is dbus","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"top","data-theme":getStoredTheme(),"data-lang":"zh-TW","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(s).forEach(([t,n])=>e.setAttribute(t,n)),document.querySelector("#pe-comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme);const n=document.querySelector("#theme-toggle-float");n&&n.addEventListener("click",setGiscusTheme)})</script></article></main><footer class=footer><span>&copy; 2024 <a href=https://www.oomkill.com/>Cylon's Collection</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> on
<a href=https://pages.github.com/ rel=noopener target=_blank>GitHub Pages</a> & Theme
        <a href=https://github.com/tofuwine/PaperMod-PE rel=noopener target=_blank>PaperMod-PE</a></span><div class=busuanzi-footer style="font-family:helvetica neue,Helvetica,Arial,sans-serif;text-align:center;padding:4px 0;color:#999"><span id=busuanzi_container_site_pv style=margin-right:8px;font-size:.85em>本站总访问量<span id=busuanzi_value_site_pv style=font-weight:500>0</span>次
</span><span id=busuanzi_container_site_uv style=font-size:.85em>本站访客数<span id=busuanzi_value_site_uv style=font-weight:500>0</span>人次</span></div></footer><div class=pe-right-sidebar><a href=javascript:void(0); id=theme-toggle-float class=pe-float-btn><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a href=#top class=pe-float-btn id=top-link><span id=pe-read-progress></span></a></div><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>